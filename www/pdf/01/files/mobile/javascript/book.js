// Created 02.11.2012 13:19:28
var Background=function(a){this.div=el.id(a.divID);this.setColor(a.color);this.setPlacement(a.placement);this.setImage(a.src)};Background.prototype.setColor=function(a){this.div.style.backgroundColor=a};Background.prototype.setImage=function(a){this.div.style.backgroundImage="url("+a+")"};Background.prototype.setPlacement=function(a){var b={fit:"contain",fill:"cover",scale:"100% 100%",single:"auto",tile:"auto"};this.div.style.backgroundSize=b[a];this.div.style.webkitBackgroundSize=b[a]};
Background.prototype.setPosition=function(a){this.div.style.backgroundPosition=a.vertical+" "+a.horisontal};
var bm={bmContent:{number:0,length:0,children:{},add:function(a){var b={};b.name=a.name;b.page=pageTable.getCaption(a.page);b.realID=a.page;this.children[this.number++]=b;this.length++;delete null},remove:function(a){for(var b in this.children)if(this.children[b].realID==a){delete this.children[b];break}this.length--;delete null}},checkLocalStorageSupports:function(){},isEmpty:function(){return!this.bmContent.length},isBookmark:function(a){for(var b in this.bmContent.children)if(this.bmContent.children[b].realID==
a)return!0;return!1},loadAllBmFromStorage:function(){var a=RegExp(publicationData.ident+"(\\d+)"),b;for(b in window.localStorage){var c=a.exec(b);c&&this.bmContent.add({page:c[1],name:window.localStorage.getItem(b)})}delete null;delete null},remBm:function(a){this.bmContent.remove(a);window.localStorage.removeItem(publicationData.ident+a);customEvents.fireEvent(REMOVE_BM)},addBm:function(a){this.bmContent.add({page:a.page,name:a.name});window.localStorage.setItem(publicationData.ident+a.page,a.name);
customEvents.fireEvent(ADD_BM)}},browser={name:"",version:"",platform:"",publisher:"",scale:1,detect:function(){var a=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),c=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],e="ie"==c[1]&&document.documentMode;browser.name="version"==c[1]?c[3]:c[1];browser.version=e||parseFloat("opera"==c[1]&&c[4]?c[4]:c[2]);browser.platform={name:a.match(/ip(?:ad|od|hone)/)?"ios":
a.match(/(?:msie 9)/)?"wphone":(a.match(/(?:webos|android|bada|symbian|palm|blackberry)/)||b.match(/mac|win|linux/)||["other"])[0]};browser.device=a.match(/ipad/)?"iPad":a.match(/iphone/)?"iPhone":a.match(/android/)?"android":!1;browser.publisher={};try{browser.publisher.deviceName=preview.get_Type(),browser.publisher.orientation=preview.get_Orientation(),browser.publisher.isOn=!0}catch(d){}browser[browser.name]=!0;browser[browser.name+parseInt(browser.version,10)]=!0;browser.platform[browser.platform.name]=
!0}},Button=function(a){"undefined"!=typeof a.able?this.able=a.able:this.able=!0;this.isVisible=!0;this.div=el.id(a.id);("undefined"==typeof this.div||null==this.div)&&console.log("DIV named "+a.id+" NOT FOUND IN DOM. please check your HTML file.");this.field=el.id(a.field);workspace.addCssClass(this.div,"button");"undefined"!=typeof a.fontImage&&workspace.addCssClass(this.div,"fontImage");"undefined"!=typeof a.cssClassName&&workspace.addCssClass(this.div,a.cssClassName);workspace.addCssClass(this.div,
a.id);setClickEvents(this.div,"dm");"undefined"!=typeof a.event&&this.addAction(a.event);a.pressing&&this.changePressingState(!0);this.able||this.makeDisable()};Button.prototype.makeAble=function(){if(!this.able)this.able=!0,workspace.delCssClass(this.div,"disable"),this.changePressingState(!0)};Button.prototype.makeDisable=function(){workspace.delCssClass(this.div,"active");workspace.addCssClass(this.div,"disable");this.able=!1;this.changePressingState(!1)};
Button.prototype.addAction=function(a,b){var c=this;if("undefined"==typeof b){var e=this.div.id;this.div.addEventListener(a,function(a){return!c.able?!1:buttonsActions[e+"Action"](a,c)},!1)}else this.div.addEventListener(a,function(a){if(!c.able)return!1;b(a)},!1)};
Button.prototype.changePressingState=function(a){a?(this.div.addEventListener(DOWN_EVENT,this.handlePressingStart,!1),this.div.addEventListener(MOVE_EVENT,this.handlePressingStop,!1),this.div.addEventListener(UP_EVENT,this.handlePressingStop,!1)):(this.div.removeEventListener(DOWN_EVENT,this.handlePressingStart,!1),this.div.removeEventListener(MOVE_EVENT,this.handlePressingStop,!1),this.div.removeEventListener(UP_EVENT,this.handlePressingStop,!1))};
Button.prototype.handlePressingStart=function(){workspace.addCssClass(this,"active")};Button.prototype.handlePressingStop=function(){workspace.delCssClass(this,"active")};Button.prototype.disablePressing=function(){this.div.removeEventListener("click",arguments.callee,!1)};Button.prototype.hide=function(){workspace.addCssClass(this.div,"invisible");this.isVisible=!1};Button.prototype.show=function(){workspace.delCssClass(this.div,"invisible");this.isVisible=!0};
Button.prototype.changeTextInsideButton=function(a){for(;0<this.div.childNodes.length;)this.div.removeChild(this.div.childNodes[0]);this.div.appendChild(document.createTextNode(a))};
Button.create=function(a){var b=workspace.createElement({type:a.type,id:a.id,parent:el.id(a.field),insertBefore:a.insertBefore});if("undefined"!=typeof a.text)b.innerHTML='<span class="'+a.id+'Text">'+a.text+"</span>";delete null;return new Button({id:a.id,field:a.field,fontImage:a.fontImage,pressing:a.pressing,cssClassName:a.cssClassName,able:a.able,event:a.event})};
var buttonsActions={closeButtonAction:function(){},listButtonAction:function(){with(workspace.popovers.tocPopover)workspace.popovers.tocPopover.twoTabs?"toc"==state?changeVisibility():changeState("toc"):changeVisibility()},tocOverTocButtonAction:function(){with(workspace.popovers.tocPopover)"toc"!=state&&changeState("toc")},tocOverBmButtonAction:function(){with(workspace.popovers.tocPopover)"bm"!=state&&changeState("bm")},searchButtonAction:function(){with(workspace.popovers.searchPopover)show()},
prevResultButtonAction:function(){var a=publicationData.rtlMode?popoverContent.search.getNextResultPageNumber(popoverContent.search.searchResults):popoverContent.search.getPrevResultPageNumber(popoverContent.search.searchResults);0!=a&&pageMediator.goToPage(a)},nextResultButtonAction:function(){var a=publicationData.rtlMode?popoverContent.search.getPrevResultPageNumber(popoverContent.search.searchResults):popoverContent.search.getNextResultPageNumber(popoverContent.search.searchResults);0!=a&&pageMediator.goToPage(a)},
closeResultButtonAction:function(){workspace.popovers.searchPopover.redrawContent();with(workspace.toolbars.list.searchToolbar)workspace.setText(resultCount.id),workspace.setText(currentResultNumber.id);with(workspace.toolbars)list.searchToolbar.isActive=!1,list.searchToolbar.hide(),workspace.delCssClass(list.pagerToolbar.div,"forSearch");customEvents.fireEvent(CANCEL_SEARCH)},infoButtonAction:function(){if("undefined"!=typeof workspace.popovers.helpOver){if(!0==workspace.popovers.helpOver.isVisible)return!1;
workspace.popovers.helpOver=null;delete workspace.popovers.helpOver}workspace.popovers.helpOver=new Popover({id:"helpOver",parent:"body",horisontalPosition:"center",state:"help",deleteAfterClose:!0});with(workspace.popovers.helpOver)addLabel({text:LOCALS.HELP,back:!1}),addContent(),"tablet"==DEV&&workspace.addCssClass(div,"tablet"),reposition();window.setTimeout(function(){workspace.popovers.helpOver.show()},100)},downloadButtonAction:function(){if("undefined"!=typeof workspace.popovers.downloadOver){if(!0==
workspace.popovers.downloadOver.isVisible)return!1;workspace.popovers.downloadOver=null;delete workspace.popovers.downloadOver}workspace.popovers.downloadOver=new Popover({parent:"body",id:"downloadOver",horisontalPosition:"left",state:"download",deleteAfterClose:!0});with(workspace.popovers.downloadOver)addLabel({text:LOCALS.DOWNLOAD,back:!1}),addContent();window.setTimeout(function(){workspace.popovers.downloadOver.show()},0)},shareButtonAction:function(){if("undefined"!=typeof workspace.popovers.shareOver){if(!0==
workspace.popovers.shareOver.isVisible)return!1;workspace.popovers.shareOver=null;delete workspace.popovers.shareOver}workspace.popovers.shareOver=new Popover({parent:"body",id:"shareOver",horisontalPosition:"left",state:"share",deleteAfterClose:!0});with(workspace.popovers.shareOver)addLabel({text:LOCALS.SHARE,back:!1}),addContent();window.setTimeout(function(){workspace.popovers.shareOver.show()},0)},moreButtonAction:function(){if("undefined"!=typeof workspace.popovers.moreOver){if(!0==workspace.popovers.moreOver.isVisible)return!1;
workspace.popovers.moreOver=null;delete workspace.popovers.moreOver}workspace.popovers.moreOver=new Popover({parent:"body",id:"moreOver",horisontalPosition:"left",state:"more",deleteAfterClose:!0});with(workspace.popovers.moreOver)addLabel({text:LOCALS.MORE,back:!1}),addContent();window.setTimeout(function(){workspace.popovers.moreOver.show()},0)},addButtonAction:function(){bm.isBookmark(pageMediator.page)?bm.remBm(pageMediator.page):setTimeout(function(){var a=!browser.publisher.isOn?prompt(LOCALS.BOOKMARK_ALERT,
LOCALS.BOOKMARK+" "+pageTable.getCaption(pageMediator.page)):a=LOCALS.BOOKMARK+" "+pageTable.getCaption(pageMediator.page);a&&bm.addBm({page:pageMediator.page,name:a})},50)},slideShowButtonAction:function(){workspace.slideShow.turnOnOff()},zoomInButtonAction:function(){customEvents.fireEvent(ZOOMIN_FROM_WORKSPACE)},zoomOutButtonAction:function(){customEvents.fireEvent(ZOOMOUT_FROM_WORKSPACE)}},SINGLE_CLICK="singleClick",DOUBLE_CLICK="doubleClick",WAIT_FOR_DOUBLE_CLICK_TIMEOUT=250,MS_CLICKED_ONCE=
"clickedOnce";
function setClickEvents(a,b,c){function e(a,b,d){b.changedTouches&&(b=b.changedTouches[0]);a.initMouseEvent(d,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null)}var c=c?c:!1,d=!1,f=!1;if(!0===b||!1===b)g=b;else var g=b?-1!=b.indexOf("d"):!1,l=b?-1!=b.indexOf("m"):!1,d=b?-1!=b.indexOf("s"):!1,f=b?-1!=b.indexOf("p"):!1;a.ondblclick=function(a){a.preventDefault();return!1};var k=function(b){function j(){a.removeEventListener(m,s,c);a.removeEventListener(o,p,
c);a.removeEventListener("touchcancel",q)}var m;if("touchstart"==b.type){a.removeEventListener("mousedown",k,c);var o="touchend";m="touchmove"}else o="mouseup",m="mousemove",a.removeEventListener("touchstart",k,c);if(a.mstate==MS_CLICKED_ONCE){window.clearTimeout(a.resetClickTimeout);a.mstate="";var n=function(b){var g=document.createEvent("MouseEvent");e(g,b,DOUBLE_CLICK);a.dispatchEvent(g);a.removeEventListener(o,n,c);j();f&&b.preventDefault();if(d)return b.stopPropagation(),!1};g&&a.addEventListener(o,
n,c);f&&b.preventDefault()}else{var p=function(b){a.removeEventListener(o,p,c);var f=document.createEvent("MouseEvent");e(f,b,SINGLE_CLICK);g?(a.mstate=MS_CLICKED_ONCE,a.resetClickTimeout=setTimeout(function(){a.dispatchEvent(f);j();a.mstate=""},WAIT_FOR_DOUBLE_CLICK_TIMEOUT)):(a.dispatchEvent(f),j(),a.mstate="");if(d)return b.stopPropagation(),!1};a.addEventListener(o,p,c);a.addEventListener("touchcancel",q,!1);var q=function(){j();a.mstate=""};if(l){var s=function(){j();a.mstate=""};a.addEventListener(m,
s,c)}}if(d)return b.stopPropagation(),!1};a.addEventListener(DOWN_EVENT,k,c)}
function mouseHandler(a){var b="";switch(a.type){case "mousedown":b="touchstart";break;case "mousemove":b="touchmove";break;case "mouseup":b="touchend";break;default:return}var c=[{screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY}],e=document.createEvent("MouseEvent");e.initMouseEvent(b,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,1,null);e.simulated=!0;e.touches=c;e.targetTouches=c;e.changedTouches=c;a.target.dispatchEvent(e);a.preventDefault();a.stopPropagation();
return!1}function redirectGlobalEvents(){}
function testCrossEvents(){redirectGlobalEvents();setClickEvents(document.getElementById("test"),!1);setClickEvents(document.getElementById("Div2"),!0);document.getElementById("Div2").addEventListener(DOUBLE_CLICK,function(a){document.getElementById("log").innerHTML+="btn"+a.type+a.screenX+a.currentTarget.id+"<br>";return!1});document.getElementById("test").addEventListener(SINGLE_CLICK,function(a){document.getElementById("log").innerHTML+="div"+a.type+a.screenX+"<br>";return!1});document.getElementById("test").addEventListener("touchstart",
function(a){document.getElementById("log").innerHTML+="touch "+a.touches+"<br>";return!1})}function initCrossEvents(){if(Modernizr){var a=Modernizr.touch;DOWN_EVENT=a?"touchstart":"mousedown";UP_EVENT=a?"touchend":"mouseup";MOVE_EVENT=a?"touchmove":"mousemove"}else console.log("Modernizr is undefined");window.fconsole=new FBConsole;window.showConsole=function(){window.fconsole.append()}}ADD_BM="addBm";REMOVE_BM="removeBm";START_SEARCH="startSearch";CANCEL_SEARCH="cancelSearch";
SHOW_SEARCH_RESULTS="showSearchResults";ZOOMIN_FROM_WORKSPACE="zoomInFromWorkspace";ZOOMOUT_FROM_WORKSPACE="zoomOutFromWorkspace";BOOK_FLIPPING_START="bookFlippingStart";BOOK_FLIPPING_END="bookFlippingEnd";CHANGE_BOOK_TYPE="changeBookType";SLIDER_TO_PAGER_CHANGE_LABEL="sliderToPagerChangeLabel";ROTATE_DEVICE="rotateDevice";IOS_LOAD_PAGE_START="iOSLoadPageStart";IOS_LOAD_VECTOR_END="iOSLoadVectorEnd";IOS_LOAD_BITMAP_END="iOSLoadBitmapEnd";ZOOM_ANIMATION_START="zoom_animation_start";
ZOOM_ANIMATION_END="zoom_animation_end";ZOOM_ANIMATION_END_TO_ONE="zoom_animation_end_to_one";ZOOM_ANIMATION_END_TO_TWO="zoom_animation_end_to_two";ZOOM_ZOOM_ANIMATION_END="ZOOM_ZOOM_ANIMATION_END";START_ZOOM_PRELOADER="startZoomPreloader";STOP_ZOOM_PRELOADER="stopZoomPreloader";ZOOM_LEVEL_CHANGED_FOR_WORKSPACE="zoom_level_changed_for_workspace";SEND_STATISTICS="send_statistics";function CustomEvents(){this._listeners={}}
CustomEvents.prototype={addEvent:function(){throw Error("obsolete function");},removeEvent:function(){throw Error("obsolete function");},addListener:function(a,b){void 0==this._listeners[a]&&(this._listeners[a]=[]);this._listeners[a].push(b);return!0},removeListener:function(a,b){if(void 0==this._listeners[a])return!1;var c=this._listeners[a].indexOf(b);if(-1!=c)this._listeners[a].splice(c,1);else return!1;return!0},fireEvent:function(a,b){if(void 0!=this._listeners[a])for(var c=0,e=this._listeners[a].length;c<
e;c++)this._listeners[a][c].call(this,{type:a,data:b})}};customEvents=new CustomEvents;
var device={width:function(){return window.innerWidth},height:function(){return"iPhone"==this.name()?416==window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight:416>window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight+60:250<window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight:250>window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight+60:window.innerHeight:window.innerHeight},
proportions:function(){return(this.width()/this.height()).toFixed(2)},name:function(){var a="other",a=browser.platform.ios&&"iPad"===browser.device?"iPad":"iPhone",a=!0==browser.platform.android?"android":a,a=!0==browser.platform.wphone?"wphone":a;return browser.publisher.isOn?browser.publisher.device:a}},dpiDetection={setMeta:function(){system.platform.android?this.createAndroidMeta():this.addMeta(this.create\u0421ontent())},delMeta:function(){for(var a=document.getElementsByTagName("meta"),b=0;b<
a.length;b++)"viewport"==a[b].name&&a[b].parentNode.removeChild(a[b])},needHighDpi:function(){return PUBL||"tablet"==DEV?!1:4==system.device.version&&("lg"==system.device.vendor||"htc"==system.device.vendor)?!0:!1},createAndroidMeta:function(){var a=this.needHighDpi()?"high-dpi":"medium-dpi";if("medium-dpi"==a)return this.addMeta(this.create\u0421ontent(a)),!1;this.delMeta();var b=this;window.setTimeout(function(){var c=b.create\u0421ontent(a);b.addMeta(c);var c=Math.sqrt(window.outerWidth*window.outerHeight)/
1E3,e=parseInt(document.defaultView.getComputedStyle(el.id("body"),null).getPropertyValue("font-size"));el.id("body").style.fontSize=Math.floor(7*e*(c/window.devicePixelRatio)*(c/window.devicePixelRatio))+"px"},200)},"create\u0421ontent":function(a){if(system.platform.ios)return"user-scalable=no, width=device-width, initial-scale="+1/(window.devicePixelRatio||1)+", maximum-scale="+1/(window.devicePixelRatio||1)+", user-scalable=no";switch(system.device.version){case 4:if("lg"==system.device.vendor||
"htc"==system.device.vendor||"apple"==system.device.vendor||"sony"==system.device.vendor){a="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width, target-densitydpi="+a;break}default:a="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0; target-densitydpi="+a+";"}return a},addMeta:function(a){var b=document.createElement("meta");b.name="viewport";b.content=a;document.getElementsByTagName("head")[0].appendChild(b)}};
function initDragger(a,b,c,e){var d,f,g,l,k,h,j,m;function o(a){a.ctrlKey&&b.sendPinch&&(b.startPinch&&b.startPinch(),b.sendPinch(B));a.altKey&&b.sendPinch&&(b.startPinch&&b.startPinch(),b.sendPinch(v));a.shiftKey&&b.handleDoubleClick();var d=a.currentTarget;d.removeEventListener(DOWN_EVENT,o,!1);d.addEventListener(MOVE_EVENT,n,!1);d.addEventListener(UP_EVENT,r,!1);d.addEventListener("mouseout",r,!1);Modernizr.touch&&d.addEventListener(DOWN_EVENT,p,!1);a=a.touches?a.touches[0]:a;d.pos={pageX:a.pageX,
pageY:a.pageY};f=(new Date).getTime();g=0;l=[];k=0;h=!1}function n(d){var e=d.touches?d.touches[0]:d,o=d.currentTarget.pos,n=e.pageX-o.pageX,o=e.pageY-o.pageY;d.currentTarget.pos={pageX:e.pageX,pageY:e.pageY};if(f){var e=(new Date).getTime(),p=e-f;g+=p;f=e;k+=Math.abs(n);l.push({dx:n,dy:o,time:p});c&&a.enableSmoothScrolling&&!j&&(m+=n,Math.abs(m)>u?(n=m/2,j=!0):n=0);if(!h&&75<g&&4<k){for(var r=l,q,s,E=s=q=p=e=0;E<r.length;E++){var G=r[E],e=e+G.dx,p=p+G.dy;q+=Math.abs(G.dx);s+=G.dy*G.dy}Math.sqrt(s);
r=Math.abs(e);q=Math.abs(r-q);fromRight=0>e;15>q&&7<r&&(0==p||1<r/Math.abs(p))?(b.sendDrag&&b.sendDrag(fromRight),e=!0):e=!1;e&&(h=!0)}}(n||o)&&b.sendMove&&b.sendMove(n,o);d.preventDefault()}function p(a){if(1<a.touches.length){var f=a.currentTarget,c=a.touches[0],a=a.touches[1];f.pos=center(c,a);f.startDist=distBetween(c,a);f.removeEventListener(UP_EVENT,r,!1);f.removeEventListener(MOVE_EVENT,n,!1);f.removeEventListener(DOWN_EVENT,p,!1);f.addEventListener(MOVE_EVENT,q,!1);f.addEventListener(UP_EVENT,
s,!1);b.startPinch&&b.startPinch();d=1}}function q(a){if(1<a.touches.length){var f=a.currentTarget,c=a.touches[0],g=a.touches[1],l=distBetween(c,g),c=center(c,g),g=l/f.startDist,k=c.pageX-f.pos.pageX+c.pageX*(1-g),h=c.pageY-f.pos.pageY+c.pageY*(1-g);e?d*=g:b.sendPinch&&b.sendPinch(g,k,h);f.startDist=l;f.pos=c}a.preventDefault()}function s(a){var f=a.currentTarget;if(2>a.touches.length)f.removeEventListener(MOVE_EVENT,q,!1),f.removeEventListener(UP_EVENT,s,!1),f.addEventListener(MOVE_EVENT,n,!1),f.addEventListener(UP_EVENT,
r,!1),a=a.touches?a.touches[0]:a,f.pos={pageX:a.pageX,pageY:a.pageY},e&&(b.sendPinch&&b.sendPinch(d),fconsole.log(d))}function r(a){var b=a.currentTarget;if(!Modernizr.touch||!a.touches||0==a.touches.length)b.removeEventListener(MOVE_EVENT,n,!1),b.removeEventListener(UP_EVENT,r,!1),b.removeEventListener("mouseout",r,!1),b.addEventListener(DOWN_EVENT,o,!1);m=0;setTimeout(function(){j=!1},w)}var B=1.15,v=0.8,u=35,w=2E3;a.addEventListener(DOWN_EVENT,o,!1);a.draggerResetState=function(){a.removeEventListener(DOWN_EVENT,
o,!1);a.removeEventListener(DOWN_EVENT,p,!1);a.removeEventListener(MOVE_EVENT,q,!1);a.removeEventListener(MOVE_EVENT,n,!1);a.removeEventListener(UP_EVENT,s,!1);a.removeEventListener(UP_EVENT,r,!1);a.removeEventListener("mouseout",r,!1);a.addEventListener(DOWN_EVENT,o,!1)};f=void 0;g=void 0;l=void 0;k=void 0;h=void 0;j=void 0;m=void 0;m=0;d=void 0}function distBetween(a,b){return Math.sqrt(Math.pow(a.pageX-b.pageX,2)+Math.pow(a.pageY-b.pageY,2))}
function center(a,b){return{pageX:(a.pageX+b.pageX)/2,pageY:(a.pageY+b.pageY)/2}}function createDiv(a,b){var c=document.createElement("div");c.setAttribute("id",a);c.style.position="absolute";if(b)c.style.overflow="hidden";return c}var FCONSOLE_MAX_ROWS=17,LINE_BR="<br>";
function FBConsole(){function a(){b.innerHTML=f+(g?"":LINE_BR+LINE_BR+d)}var b=createDiv("fconsole"),c=function(a,b){return'<font color="'+b+'">'+a+"</font>"};b.style.left="0px";b.style.top="100px";b.style.width="100";b.style.height="100";b.style.opacity="0.7";b.style.backgroundColor="#e0efee";b.style.color="#11111f";b.style.fontSize="14px";b.style.zIndex=100;b.style.webkitTransform="translate3d(0px,0px,500px)";b.addEventListener(UP_EVENT,function(){g?(g=!1,a()):(d=[],a(),g=!0)},!1);var e=[],d=[],
f="",g;this.append=function(){document.body.appendChild(b)};this.update=function(b,d){for(var g,j=0;j<e.length;j++)e[j].name==b&&(g=e[j]);"number"==typeof d&&(d=Math.round(1E4*d)/1E4);g?g.value=d:e.push({name:b,value:d});f="";for(j=0;j<e.length;j++)f+=c(e[j].name,"green")+": "+c(e[j].value,"blue")+(j==e.length-1?"":LINE_BR);a()};this.log=function(b){d.length>FCONSOLE_MAX_ROWS-1&&d.shift();for(var f="",g=0;g<arguments.length;g++){switch(typeof arguments[g]){case "number":f+=c(Math.round(1E4*arguments[g])/
1E4,"blue");break;default:f+=arguments[g]}g<arguments.length-1&&(f+=" ")}d.push(f+LINE_BR);a()}}function HighlightItem(a,b,c,e){this.word=a[0];"R"==a[1]?(this.rtl=!0,this.top=a[2]/10,this.left=a[3]/10,this.angle=a[4]/1E3,this.height=a[5]/10):(this.rtl=!1,this.top=a[1]/10,this.left=a[2]/10,this.angle=a[3]/1E3,this.height=a[4]/10);this.startPos=c;this.stopPos=c+(e-1);this.chars=b}
var highlight={active:!1,init:function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){a.show()});customEvents.addListener(CANCEL_SEARCH,function(){a.hide()})},show:function(a,b){a=a||-10;publicationData.page[a].videos&&video.inject(b,a);if(search.active&&search.pages[a]){if(-10==a)a=pageMediator.page;b=b||el.id("highlightCanvas"+a);this.process(a,b);this.active=!0}},hide:function(a,b){a=a||-10;-10==a?this.active=!1:this.claerPage(a,b);search.stop()},claerPage:function(a,b){b=
b||el.id("highlightCanvas"+a);b.getContext("2d").clearRect(0,0,b.width,b.height);this.active=!1},process:function(a,b){this.claerPage(a,b);var c=function(){for(var d=this.responseText.split("\n"),f=search.query.toLowerCase()||"",f=strUtils.split(f,publicationData.search.lim),c=1;c<d.length;c++){word=d[c];for(var l=0,e=0;e<f.length;e++){var h=f[e],j=word.split(String.fromCharCode(2));if(-1!=(l=j[0].toLowerCase().indexOf(h))){var m=word.split(String.fromCharCode(4));if(1<m.length){for(var j=[],o=[],
n=0;n<m.length;n++)j[n]=m[n].split(String.fromCharCode(2)),0<n&&j[n].unshift(j[0][0]),o[n]=j[n][5].split(String.fromCharCode(3));m=l;l+=h.length;for(h=0;h<j.length;h++)o[h].length<=m?(m-=o[h].length,l-=o[h].length):(l>o[h].length?(n=o[h].length,l-=o[h].length):(n=l,l=0),0<m&&(n-=m),n=new HighlightItem(j[h],o[h],m,n),m=0,highlight.light(n,b,a))}else o="R"==j[1]?j[6].split(String.fromCharCode(3)):j[5].split(String.fromCharCode(3)),n=new HighlightItem(j,o,l,h.length),highlight.light(n,b,a)}}}};if(PUBL)e=
new XMLHttpRequest,e.open("GET",ASSETS_FOLDER+"/search/search"+strUtils.getNum(a)+".xml?1&"+PS),e.onload=function(){var a=new XMLHttpRequest;a.open("GET",this.responseText);a.onload=c;a.onerror=function(){};a.send();delete a};else{var e=new XMLHttpRequest;e.open("GET",ASSETS_FOLDER+"/search/search"+strUtils.getNum(a)+".xml");e.onload=c}e.onerror=function(){};e.send();delete e},light:function(a,b,c){var e=b.getContext("2d");e.fillStyle="rgba("+strUtils.hexToRGB(publicationData.search.color)+",0.4)";
var d=b.width/(publicationData.page[c].width||publicationData.page.defaults.width),f=0===a.startPos?0:a.chars[a.startPos-1]/10*d,b=a.left*d,c=a.top*d+f,f=a.chars[a.stopPos]/10*d-f,d=a.height*d;a.rtl&&(c-=f);e.save();e.translate(c,b);e.rotate(a.angle);e.fillRect(0,0,f,d);e.restore();delete null}},HTML5lib={init:function(){switch(system.browser.name){case "safari":this.browserPrefix="webkit";break;case "firefox":this.browserPrefix="Moz";break;case "opera":this.browserPrefix="O";break;case "ie":this.browserPrefix=
"ms";break;case "chrome":this.browserPrefix="webkit"}},translate:function(a,b,c,e){b=b||0;c=c||0;a.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?"translate3d("+b+"px,"+c+"px,"+(e||0)+"px)":"translate("+b+"px,"+c+"px)"},duration:function(a,b){a.style[this.browserPrefix+"TransitionDuration"]=b+"ms"},perspective:function(a,b){a.style[this.browserPrefix+"Transform"]="perspective("+b+")"},scale:function(a,b,c){a=a||0;b=b||0;el.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?
"scale3d("+a+","+b+","+(c||0)+")":"scale("+a+","+b+")"},rotate:function(a,b,c){c=c||0;a.style[this.browserPrefix+"Transform"]=Modernizr.csstransforms3d?"rotate3d("+c+","+c+","+c+","+b+"deg)":"rotate("+b+"deg)"},backfaceVisibility:function(a,b){a.style[this.browserPrefix+"BackfaceVisibility"]=b},boxShadow:function(a,b){a.style[this.browserPrefix+"BoxShadow"]=b},getTransform:function(a){return a.style[this.browserPrefix+"Transform"]},transform:function(a,b,c){a.style[this.browserPrefix+"TransformOrigin"]=
"0px 0px";a.style[this.browserPrefix+"Transform"]="translate3d("+b+"px,"+c+"px,0px)"},getParseTranslate:function(a){a=a.style[this.browserPrefix+"Transform"].match(/-*\d+(?=px)|\d+\%/ig);null==a&&(a=[0,0,0]);return{x:a[0],y:a[1],z:a[2]}},changeOnlyScale:function(a,b,c,e){re=/translate3d\([A-Za-z0-9_, ]*\)/i;var d=a.style[this.browserPrefix+"Transform"].match(re);null===d&&(d="");a.style[this.browserPrefix+"Transform"]=d+" scale3d("+b+","+c+","+e+")"}};
function IOSBook(a,b){this.type=b||orientationObserver.getType();a=a||1;this.onePage=new OnePagePublication(a);this.twoPage=new TwoPagePublication(a);this.zoomBook=new ZoomIOSPublication(1);this.onePage.initSizes();this.twoPage.initSizes();this.touchTrigg=0;1==this.type?this.onePage.drawBook():2==this.type?this.twoPage.drawBook():3==this.type&&(this.zoomBook.initSizes(3.3),this.zoomBook.drawBook());this.goToPage=function(a){1==this.type?this.onePage.goToPage(a):2==this.type?this.twoPage.goToPage(a):
3==this.type&&this.zoomBook.goToPage(a)};var c=this,e=function(a){1==c.type&&c.onePage.goToZoom(a);if(2==c.type){var b=a.target.id.match(/\d+/i);c.twoPage.goToZoom(b)}3==c.type&&(2===orientationObserver.getType()?c.zoomBook.goToTwoPage(a):c.zoomBook.goToOnePage(a))};el.id("mainFrame").addEventListener("dblclick",e);el.id("mainFrame").addEventListener("touchend",function(){0===c.touchTrigg?(c.touchTrigg++,setTimeout(function(){c.touchTrigg=0},250)):!c.twoPage.gesture&&!c.onePage.gesture&&!c.zoomBook.gesture&&
e(event)});customEvents.addListener(ROTATE_DEVICE,function(a){if(2===a.data&&1===c.type)c.type=2,c.onePage.destroyBook(),setTimeout(function(){c.twoPage.initSizes();var a=pageTable.getUserIDFromFileID(pageMediator.page);c.twoPage.drawBook(a)},10);else if(1===a.data&&1===c.type)c.type=1,c.onePage.destroyBook(),setTimeout(function(){c.onePage.initSizes();c.onePage.drawBook(pageMediator.page)},10);else if(1===a.data&&2===c.type)c.type=1,c.twoPage.destroyBook(),setTimeout(function(){c.onePage.initSizes();
c.onePage.drawBook(pageMediator.page)},10);else if(2===a.data&&2===c.type)c.type=2,c.twoPage.destroyBook(),setTimeout(function(){c.twoPage.initSizes();c.twoPage.drawBook(pageMediator.page)},10)});customEvents.addListener(ZOOM_ANIMATION_START,function(){});customEvents.addListener(ZOOM_ANIMATION_END,function(a){c.type=3;customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:3});c.zoomBook.initSizes(a.data.zoomFactor,a.data.page);c.zoomBook.drawBook(a.data.page);if(GAEnable){var b=window.location.pathname.split("/");
_trackEvent(b[b.length-4]+"","Zooming","page"+a.data.page)}});customEvents.addListener(ZOOM_ANIMATION_END_TO_ONE,function(a){c.type=1;customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:1});c.onePage.initSizes();c.onePage.drawBook(a.data.page);if(GAEnable){var b=window.location.pathname.split("/");_trackEvent(b[b.length-4]+"","Zooming out","page"+a.data.page)}});customEvents.addListener(ZOOM_ANIMATION_END_TO_TWO,function(a){customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:2});c.type=2;c.twoPage.initSizes();
c.twoPage.drawBook(a.data.page);if(GAEnable){var b=window.location.pathname.split("/");_trackEvent(b[b.length-4]+"","Zooming out","page"+a.data.page)}});customEvents.addListener(ZOOM_ZOOM_ANIMATION_END,function(a){customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:3});c.type=3;c.zoomBook.initSizes(a.data.zoomFactor,a.data.page);c.zoomBook.drawBook(a.data.page,a.data.startPos)});el.id("mainFrame").addEventListener("gesturestart",function(){ZOOM_LOCK||(1===c.type?c.onePage.gesturestart(event):2===c.type?
c.twoPage.gesture||c.twoPage.gesturestart(event):3===c.type&&c.zoomBook.gesturestart(event))},!0);el.id("mainFrame").addEventListener("gesturechange",function(){ZOOM_LOCK||(1===c.type?c.onePage.gesturechange(event):2===c.type?c.twoPage.gesturechange(event):3===c.type&&c.zoomBook.gesturechange(event))},!0);el.id("mainFrame").addEventListener("gestureend",function(){ZOOM_LOCK||(1===c.type?c.onePage.gestureend(event):2===c.type?c.twoPage.gestureend(event):3===c.type&&c.zoomBook.gestureend(event))},!0);
customEvents.addListener(START_ZOOM_PRELOADER,function(a){ZOOM_LOCK=!0;var a=void 0!=a.data?a.data.shift:0,b=el.add("div");b.id="preloaderZOOM";b.style.position="absolute";b.style.left=window.innerWidth/2+a+"px";b.style.top=window.innerHeight/2+"px";b.style.width="10em";b.style.height="10em";b.style.margin="-3em 0 0 -5em";b.style.zIndex=1E7;b.style.webkitTransform="translateZ(150px)";workspace.preloader.add(b);el.id("mainFrame").appendChild(b);page=null});customEvents.addListener(STOP_ZOOM_PRELOADER,
function(){el.del("preloaderZOOM");setTimeout(function(){ZOOM_LOCK=!1},300)});var d=function(){1===c.type?c.onePage.touch(event):2===c.type?c.twoPage.touch(event):3===c.type&&c.zoomBook.touch(event)},f=function(){1===c.type?c.onePage.endmove(event):2===c.type?c.twoPage.endmove(event):3===c.type&&c.zoomBook.endmove(event)};Modernizr.touch?(el.id("mainFrame").addEventListener("touchstart",d,!0),el.id("mainFrame").addEventListener("touchend",f,!0)):(el.id("mainFrame").addEventListener("mousedown",d,
!0),el.id("mainFrame").addEventListener("mouseup",f,!0))}iosContent={};
(function(a,b){function c(a){if(""===f)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return f+a}var e=Math,d=b.createElement("div").style,f=function(){for(var a="t,webkitT,MozT,msT,OT".split(","),b,f=0,c=a.length;f<c;f++)if(b=a[f]+"ransform",b in d)return a[f].substr(0,a[f].length-1);return!1}(),g=f?"-"+f.toLowerCase()+"-":"",l=c("transform"),k=c("transitionProperty"),h=c("transitionDuration"),j=c("transformOrigin"),m=c("transitionTimingFunction"),o=c("transitionDelay"),n=/android/gi.test(navigator.appVersion),
p=/iphone|ipad/gi.test(navigator.appVersion),q=/hp-tablet/gi.test(navigator.appVersion),s=c("perspective")in d,r="ontouchstart"in a&&!q,B=!!f,v=c("transition")in d,u="onorientationchange"in a?"orientationchange":"resize",w=r?"touchstart":"mousedown",z=r?"touchmove":"mousemove",t=r?"touchend":"mouseup",C=r?"touchcancel":"mouseup",D="Moz"==f?"DOMMouseScroll":"mousewheel",F;F=!1===f?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[f];var y=
function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),x=a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout,A=s?" translateZ(0)":"",q=function(d,f){var c=this,e;c.wrapper="object"==typeof d?d:b.getElementById(d);
c.wrapper.style.overflow="hidden";c.scroller=c.wrapper.children[0];c.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:n,hideScrollbar:p,fadeScrollbar:p&&s,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,
onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(e in f)c.options[e]=f[e];c.x=c.options.x;c.y=c.options.y;c.options.useTransform=B&&c.options.useTransform;c.options.hScrollbar=c.options.hScroll&&c.options.hScrollbar;c.options.vScrollbar=c.options.vScroll&&c.options.vScrollbar;c.options.zoom=c.options.useTransform&&c.options.zoom;c.options.useTransition=v&&c.options.useTransition;c.options.zoom&&
n&&(A="");c.scroller.style[k]=c.options.useTransform?g+"transform":"top left";c.scroller.style[h]="0";c.scroller.style[j]="0 0";c.options.useTransition&&(c.scroller.style[m]="cubic-bezier(0.33,0.66,0.66,1)");c.options.useTransform?c.scroller.style[l]="translate("+c.x+"px,"+c.y+"px)"+A:c.scroller.style.cssText+=";position:absolute;top:"+c.y+"px;left:"+c.x+"px";if(c.options.useTransition)c.options.fixedScrollbar=!0;c.refresh();c._bind(u,a);c._bind(w);r||"none"!=c.options.wheelAction&&c._bind(D);if(c.options.checkDOMChanges)c.checkDOMTime=
setInterval(function(){c._checkDOMChanges()},500)};q.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case w:if(!r&&0!==a.button)break;this._start(a);break;case z:this._move(a);break;case t:case C:this._end(a);break;case u:this._resize();break;case D:this._wheel(a);break;case F:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==
this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(a){var d;if(this[a+"Scrollbar"]){if(!this[a+"ScrollbarWrapper"]){d=b.createElement("div");this.options.scrollbarClass?d.className=this.options.scrollbarClass+a.toUpperCase():d.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");
d.style.cssText+=";pointer-events:none;"+g+"transition-property:opacity;"+g+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(d);this[a+"ScrollbarWrapper"]=d;d=b.createElement("div");if(!this.options.scrollbarClass)d.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+g+"background-clip:padding-box;"+g+"box-sizing:border-box;"+("h"==a?
"height:100%":"width:100%")+";"+g+"border-radius:3px;border-radius:3px";d.style.cssText+=";pointer-events:none;"+g+"transition-property:"+g+"transform;"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+g+"transition-duration:0;"+g+"transform: translate(0,0)"+A;this.options.useTransition&&(d.style.cssText+=";"+g+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[a+"ScrollbarWrapper"].appendChild(d);this[a+"ScrollbarIndicator"]=d}"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=e.max(e.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=e.max(e.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(a,!0)}else this[a+"ScrollbarWrapper"]&&(B&&(this[a+"ScrollbarIndicator"].style[l]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},n?200:0)},_pos:function(a,
b){if(!this.zoomed)a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[l]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+A:(a=e.round(a),b=e.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(a,b){var d="h"==a?this.x:this.y;if(this[a+"Scrollbar"])d*=this[a+"ScrollbarProp"],0>d?(this.options.fixedScrollbar||(d=this[a+"ScrollbarIndicatorSize"]+e.round(3*
d),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px"),d=0):d>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?d=this[a+"ScrollbarMaxScroll"]:(d=this[a+"ScrollbarIndicatorSize"]-e.round(3*(d-this[a+"ScrollbarMaxScroll"])),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px",d=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-d))),this[a+"ScrollbarWrapper"].style[o]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[l]="translate("+("h"==a?d+"px,0)":"0,"+d+"px)")+A},_start:function(b){var d=r?b.touches[0]:b,f,c;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,b);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&r&&1<b.touches.length)c=e.abs(b.touches[0].pageX-b.touches[1].pageX),
f=e.abs(b.touches[0].pageY-b.touches[1].pageY),this.touchesDistStart=e.sqrt(c*c+f*f),this.originX=e.abs(b.touches[0].pageX+b.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=e.abs(b.touches[0].pageY+b.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,b);if(this.options.momentum&&(this.options.useTransform?(f=getComputedStyle(this.scroller,null)[l].replace(/[^0-9\-.,]/g,"").split(","),c=1*f[4],f=1*f[5]):(c=1*getComputedStyle(this.scroller,
null).left.replace(/[^0-9-]/g,""),f=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),c!=this.x||f!=this.y))this.options.useTransition?this._unbind(F):x(this.aniTime),this.steps=[],this._pos(c,f);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=d.pageX;this.pointY=d.pageY;this.startTime=b.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,b);this._bind(z,a);this._bind(t,a);this._bind(C,a)}},_move:function(a){var b=
r?a.touches[0]:a,d=b.pageX-this.pointX,f=b.pageY-this.pointY,c=this.x+d,g=this.y+f,k=a.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&r&&1<a.touches.length)c=e.abs(a.touches[0].pageX-a.touches[1].pageX),g=e.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=e.sqrt(c*c+g*g),this.zoomed=!0,b=1/this.touchesDistStart*this.touchesDist*this.scale,b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):
b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,c=this.originX-this.originX*this.lastScale+this.x,g=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[l]="translate("+c+"px,"+g+"px) scale("+b+")"+A,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=b.pageY;if(0<c||c<this.maxScrollX)c=this.options.bounce?this.x+d/2:0<=c||0<=this.maxScrollX?0:this.maxScrollX;if(g>this.minScrollY||
g<this.maxScrollY)g=this.options.bounce?this.y+f/2:g>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=d;this.distY+=f;this.absDistX=e.abs(this.distX);this.absDistY=e.abs(this.distY);if(!(6>this.absDistX&&6>this.absDistY)){if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)g=this.y,f=0;else if(this.absDistY>this.absDistX+5)c=this.x,d=0;this.moved=!0;this._pos(c,g);this.dirX=0<d?-1:0>d?1:0;this.dirY=0<f?-1:0>f?1:0;if(300<k-this.startTime)this.startTime=k,
this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,a)}}},_end:function(d){if(!(r&&0!==d.touches.length)){var f=this,c=r?d.changedTouches[0]:d,g,k,o={dist:0,time:0},j={dist:0,time:0},n=(d.timeStamp||Date.now())-f.startTime,m=f.x,p=f.y;f._unbind(z,a);f._unbind(t,a);f._unbind(C,a);f.options.onBeforeScrollEnd&&f.options.onBeforeScrollEnd.call(f,d);if(f.zoomed)m=f.scale*f.lastScale,m=Math.max(f.options.zoomMin,m),m=Math.min(f.options.zoomMax,m),f.lastScale=
m/f.scale,f.scale=m,f.x=f.originX-f.originX*f.lastScale+f.x,f.y=f.originY-f.originY*f.lastScale+f.y,f.scroller.style[h]="200ms",f.scroller.style[l]="translate("+f.x+"px,"+f.y+"px) scale("+f.scale+")"+A,f.zoomed=!1,f.refresh(),f.options.onZoomEnd&&f.options.onZoomEnd.call(f,d);else{if(f.moved){if(300>n&&f.options.momentum){o=m?f._momentum(m-f.startX,n,-f.x,f.scrollerW-f.wrapperW+f.x,f.options.bounce?f.wrapperW:0):o;j=p?f._momentum(p-f.startY,n,-f.y,0>f.maxScrollY?f.scrollerH-f.wrapperH+f.y-f.minScrollY:
0,f.options.bounce?f.wrapperH:0):j;m=f.x+o.dist;p=f.y+j.dist;if(0<f.x&&0<m||f.x<f.maxScrollX&&m<f.maxScrollX)o={dist:0,time:0};if(f.y>f.minScrollY&&p>f.minScrollY||f.y<f.maxScrollY&&p<f.maxScrollY)j={dist:0,time:0}}if(o.dist||j.dist){o=e.max(e.max(o.time,j.time),10);if(f.options.snap)j=m-f.absStartX,n=p-f.absStartY,e.abs(j)<f.options.snapThreshold&&e.abs(n)<f.options.snapThreshold?f.scrollTo(f.absStartX,f.absStartY,200):(j=f._snap(m,p),m=j.x,p=j.y,o=e.max(j.time,o));f.scrollTo(e.round(m),e.round(p),
o)}else f.options.snap?(j=m-f.absStartX,n=p-f.absStartY,e.abs(j)<f.options.snapThreshold&&e.abs(n)<f.options.snapThreshold?f.scrollTo(f.absStartX,f.absStartY,200):(j=f._snap(f.x,f.y),(j.x!=f.x||j.y!=f.y)&&f.scrollTo(j.x,j.y,j.time))):f._resetPos(200)}else{if(r)if(f.doubleTapTimer&&f.options.zoom)clearTimeout(f.doubleTapTimer),f.doubleTapTimer=null,f.options.onZoomStart&&f.options.onZoomStart.call(f,d),f.zoom(f.pointX,f.pointY,1==f.scale?f.options.doubleTapZoom:1),f.options.onZoomEnd&&setTimeout(function(){f.options.onZoomEnd.call(f,
d)},200);else if(this.options.handleClick)f.doubleTapTimer=setTimeout(function(){f.doubleTapTimer=null;for(g=c.target;1!=g.nodeType;)g=g.parentNode;if("SELECT"!=g.tagName&&"INPUT"!=g.tagName&&"TEXTAREA"!=g.tagName)k=b.createEvent("MouseEvents"),k.initMouseEvent("click",!0,!0,d.view,1,c.screenX,c.screenY,c.clientX,c.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,0,null),k._fake=!0,g.dispatchEvent(k)},f.options.zoom?250:0);f._resetPos(400)}f.options.onTouchEnd&&f.options.onTouchEnd.call(f,d)}}},_resetPos:function(a){var b=
0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&d==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)"webkit"==f&&(this.hScrollbarWrapper.style[o]="300ms"),this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)"webkit"==f&&(this.vScrollbarWrapper.style[o]=
"300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,d,a||0)},_wheel:function(a){var b=this,d,f;if("wheelDeltaX"in a)d=a.wheelDeltaX/12,f=a.wheelDeltaY/12;else if("wheelDelta"in a)d=f=a.wheelDelta/12;else if("detail"in a)d=f=3*-a.detail;else return;if("zoom"==b.options.wheelAction){f=b.scale*Math.pow(2,1/3*(f?f/Math.abs(f):0));if(f<b.options.zoomMin)f=b.options.zoomMin;if(f>b.options.zoomMax)f=b.options.zoomMax;f!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,
a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,f,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{d=b.x+d;f=b.y+f;if(0<d)d=0;else if(d<b.maxScrollX)d=b.maxScrollX;if(f>b.minScrollY)f=b.minScrollY;else if(f<b.maxScrollY)f=b.maxScrollY;0>b.maxScrollY&&b.scrollTo(d,f,0)}},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(F),this._startAni())},_startAni:function(){var a=this,b=a.x,d=a.y,f=Date.now(),c,g,l;if(!a.animating)if(a.steps.length){c=
a.steps.shift();if(c.x==b&&c.y==d)c.time=0;a.animating=!0;a.moved=!0;a.options.useTransition?(a._transitionTime(c.time),a._pos(c.x,c.y),a.animating=!1,c.time?a._bind(F):a._resetPos(0)):(l=function(){var k=Date.now();if(k>=f+c.time)a._pos(c.x,c.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();else if(k=(k-f)/c.time-1,g=e.sqrt(1-k*k),k=(c.x-b)*g+b,a._pos(k,(c.y-d)*g+d),a.animating)a.aniTime=y(l)},l())}else a._resetPos(400)},_transitionTime:function(a){a+="ms";
this.scroller.style[h]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[h]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[h]=a)},_momentum:function(a,b,d,f,c){var b=e.abs(a)/b,g=b*b/0.0012,l=0,l=0;0<a&&g>d?(d+=c/(6/(6.0E-4*(g/b))),b=b*d/g,g=d):0>a&&g>f&&(f+=c/(6/(6.0E-4*(g/b))),b=b*f/g,g=f);return{dist:g*(0>a?-1:1),time:e.round(b/6.0E-4)}},_offset:function(a){for(var b=-a.offsetLeft,d=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,d-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,d*=this.scale);
return{left:b,top:d}},_snap:function(a,b){var d,f,c;c=this.pagesX.length-1;for(d=0,f=this.pagesX.length;d<f;d++)if(a>=this.pagesX[d]){c=d;break}c==this.currPageX&&0<c&&0>this.dirX&&c--;a=this.pagesX[c];f=(f=e.abs(a-this.pagesX[this.currPageX]))?500*(e.abs(this.x-a)/f):0;this.currPageX=c;c=this.pagesY.length-1;for(d=0;d<c;d++)if(b>=this.pagesY[d]){c=d;break}c==this.currPageY&&0<c&&0>this.dirY&&c--;b=this.pagesY[c];d=(d=e.abs(b-this.pagesY[this.currPageY]))?500*(e.abs(this.y-b)/d):0;this.currPageY=
c;c=e.round(e.max(f,d))||200;return{x:a,y:b,time:c}},_bind:function(a,b,d){(b||this.scroller).addEventListener(a,this,!!d)},_unbind:function(a,b,d){(b||this.scroller).removeEventListener(a,this,!!d)},destroy:function(){this.scroller.style[l]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(u,a);this._unbind(w);this._unbind(z,a);this._unbind(t,a);this._unbind(C,a);this.options.hasTouch||this._unbind(D);this.options.useTransition&&this._unbind(F);this.options.checkDOMChanges&&
clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,d,f=0;b=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=e.round(this.scroller.offsetWidth*this.scale);this.scrollerH=e.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;
this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=
-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];d=this.scroller.querySelectorAll(this.options.snap);for(a=0,b=d.length;a<b;a++)f=this._offset(d[a]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[a]=f.left<this.maxScrollX?this.maxScrollX:f.left*this.scale,this.pagesY[a]=f.top<this.maxScrollY?this.maxScrollY:f.top*this.scale}else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[b]=f,f-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&
(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[b]=f,f-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[h]="0",this._resetPos(400))},scrollTo:function(a,b,d,f){var c=a;this.stop();
c.length||(c=[{x:a,y:b,time:d,relative:f}]);for(a=0,b=c.length;a<b;a++){if(c[a].relative)c[a].x=this.x-c[a].x,c[a].y=this.y-c[a].y;this.steps.push({x:c[a].x,y:c[a].y,time:c[a].time||0})}this._startAni()},scrollToElement:function(a,b){var d;if(a=a.nodeType?a:this.scroller.querySelector(a))d=this._offset(a),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=0<d.left?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:
d.top,b=void 0===b?e.max(2*e.abs(d.left),2*e.abs(d.top)):b,this.scrollTo(d.left,d.top,b)},scrollToPage:function(a,b,d){d=void 0===d?400:d;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=
this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,d)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(z,a);this._unbind(t,a);this._unbind(C,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(F):x(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,d,f){var c=d/this.scale;if(this.options.useTransform)this.zoomed=
!0,f=void 0===f?200:f,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*c+this.x,this.y=b-b*c+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[h]=f+"ms",this.scroller.style[l]="translate("+this.x+"px,"+this.y+"px) scale("+d+")"+A,this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};
d=null;"undefined"!==typeof exports?exports.iScroll=q:a.iScroll=q})(window,document);
function LinksLayer(a,b){a.removeAllListeners&&a.removeAllListeners();this.canvas=a;this.rectStore="";this.videoLight=this.light=!1;this.activeLink={};var c=void 0==publicationData.page[b].videos?!1:!0;if(void 0!=publicationData.page[b].links||c){c=a.width/(publicationData.page[b].width||publicationData.page.defaults.width);this.links=[];this.links.active=!0;var e=0;for(i in publicationData.page[b].links){var d=publicationData.page[b].links[i];this.links[e]={};this.links[e].width=1*(d.width*c).toFixed(0);
this.links[e].height=1*(d.height*c).toFixed(0);this.links[e].x=1*(d.x*c).toFixed(0);this.links[e].y=1*(d.y*c).toFixed(0);this.links[e].page=d.page||-10;this.links[e].url=d.urls?d.urls[0]:-10;this.links[e].zIndex=d.zindex;this.links[e].videoType=!1;e++}for(i in publicationData.page[b].videos)d=publicationData.page[b].videos[i],this.links[e]={},this.links[e].width=1*(d.width*c).toFixed(0),this.links[e].height=1*(d.height*c).toFixed(0),this.links[e].x=1*(d.x*c).toFixed(0),this.links[e].y=1*(d.y*c).toFixed(0),
this.links[e].videoId=d.id,this.links[e].zIndex=d.zindex,this.links[e].videoType=!0,e++;var f=this,g=function(b){var d,c;if(Modernizr.touch){var g=b.target.getBoundingClientRect();d=b.targetTouches[0].pageX-g.left;c=b.targetTouches[0].pageY-g.top;d*=a.width/g.width;c*=a.height/g.height}else d=b.offsetX,c=b.offsetY;for(li in f.links)if(g=f.links[li],d>=g.x&&d<=g.x+g.width&&c>=g.y&&c<=g.y+g.height){f.activeLink=g;g.videoType?f.videoLight=!0:(d=f.canvas.getContext("2d"),f.rectStore=d.getImageData(g.x-
2,g.y-2,g.width+4,g.height+4),f.light=!0,c=strUtils.hexToRGB(publicationData.linkcolor||"#000000"),d.fillStyle="rgba("+c+",0.3)",d.fillRect(g.x,g.y,g.width,g.height));b.preventDefault();break}},l=function(){if(f.light)f.canvas.getContext("2d").putImageData(f.rectStore,f.activeLink.x-2,f.activeLink.y-2),f.light=!1,-10!=f.activeLink.page?pageMediator.goToPage(f.activeLink.page):-10!=f.activeLink.url&&window.open(f.activeLink.url,"publisherLink");else if(f.videoLight)f.videoLight=!1,video.play(f.activeLink.videoId,
f.activeLink.width/f.activeLink.height)},k=function(){if(f.light)f.canvas.getContext("2d").putImageData(f.rectStore,f.activeLink.x-2,f.activeLink.y-2),f.light=!1;else if(f.videoLight)f.videoLight=!1};a.addEventListener(DOWN_EVENT,g);a.addEventListener(UP_EVENT,l);a.addEventListener(MOVE_EVENT,k);a.removeAllListeners=function(){a.removeEventListener(DOWN_EVENT,g);a.removeEventListener(UP_EVENT,l);a.removeEventListener(MOVE_EVENT,k)};this.links.sort(function(a,b){return a.zIndex<b.zIndex?1:a.zIndex>
b.zIndex?-1:0})}else this.links={},this.links.active=!1}ONLY_RASTER=!1;
function LoadManager(){function a(a){if(!a.waitingForImage&&!a.waitingForVector){if(a.onAllIsComplete)a.onAllIsComplete(a.image,a.vector);e.length?f():d="standby"}}function b(b,d){void 0!=window.fakeLoadComplete&&fconsole.log("error on fakeLoadComplete");window.fakeLoadComplete=function(b){window.loadBuffers[b]=window.loadBuffer;d.waitingForVector=!1;if(d.onJSLoadComplete)d.onJSLoadComplete(window.loadBuffers[b]);d.vector=window.loadBuffers[b];a(d);window.fakeLoadComplete=void 0};addScript(b)}function c(a,
b,d,f){if(!PUBL)return b?COMMON_FOLDER+"/page-substrates/"+("page"+fill4Zero(a))+"."+d:ASSETS_FOLDER+"/pages/"+("page"+fill4Zero(a))+(f?"_i2.":"_i1.")+d}var e=[],d="standby";window.loadBuffers=[];var f=function(){var a=e.shift();l(a.id,a.agent)},g=[],l=function(l,h){if(publicationData.getPageProperty(l,"stub"))console.log("loadManager error: attempt to draw stub"),e.length?f():d="standby";else{var j=h.quality&&!window.system.platform.blackberry,m=publicationData.getPageProperty(l,"format"),o=-1!=
m.indexOf("jpg")?"jpg":"png",n=-1!=m.indexOf("js")&&!ONLY_RASTER,m=c(l,n,o,j),p=new Image;h.waitingForImage=!0;p.onload=function(){h.image=p;h.waitingForImage=!1;h.onImageLoadComplete(p,n);a(h)};p.onerror=function(){h.waitingForImage=!1;var b=p.src;if(void 0!=h.onPageLoadError)h.onPageLoadError(l);else fconsole.log("load error ",b);a(h)};var q=h.onImageStartLoading;q&&q(p);if(n)if(q=PUBL?void 0:PAGES_JS_FOLDER+"/"+("page"+fill4Zero(l))+".js",-1!=g.indexOf(l)){h.waitingForVector=!1;h.vector=window.loadBuffers[l];
if(h.onJSLoadComplete)h.onJSLoadComplete(window.loadBuffers[l]);a(h)}else h.waitingForVector=!0,b(q,h);else h.waitingForVector=!1;PUBL?(j=ASSETS_FOLDER+"/pages/"+("page"+fill4Zero(l))+(j?"_i2.":"_i1.")+o,o=new XMLHttpRequest,o.open("GET",j+"?1&"+PS),o.onload=function(){p.src=this.responseText},o.onerror=function(){},o.send(),delete o):p.src=m}};this.addPageToQueue=function(a,b){e.push({id:a,agent:b});"standby"==d&&(d="loading",f())}}
function fill4Zero(a){return 1E3>a?Math.pow(10,4-a.toString().length).toString().slice(1)+a.toString():a.toString()}function addScript(a){fconsole.log("adding",a);var b=document.createElement("script");b.type="text/javascript";b.src=a;a=document.head;a.insertBefore(b,a.firstChild)}PT_DOCUMENT="document";PT_PHOTOALBUM="photo_album";PT_CATALOG="catalog";BOOK_FLIP_DURATION=0.5;PATH_TO_PROPERTIES=ASSETS_FOLDER+"/";ZOOM_LOCK=!1;
var main=function(){window.GAEnable||(GAEnable=!1);var a,b=function(){system.init();browser.detect();window.orientationObserver=new OrientationObserver;window.pageTable=new PageTable;HTML5lib.init();PUBL||(LOCALS=eval("("+this.responseText+")"));window.resources={};resources.MAIN_FRAME=el.id("mainFrame");publicationData.presentationMode=publicationData.type==PT_PHOTOALBUM||publicationData.type==PT_DOCUMENT;if(1<window.location.hash.length){RESTORE=!1;var b=window.location.hash.substring(1,window.location.hash.length),
e=parseInt(b)}else RESTORE=!0,e=1;e=pageTable.getFileIDFromUserID(e);void 0===e&&(e=1);pageMediator=new PageController(e,"single",publicationData.rtlMode);initCrossEvents();if(publicationData.collectStatistics){b=document.createElement("script");with(b)type="text/javascript",onload=function(){stat.init()},src="http://static.publ.com/mobile/2.4.0/statisticsm.js";document.getElementsByTagName("head")[0].appendChild(b)}setClickEvents(resources.MAIN_FRAME,"dmp");if(2==window.devicePixelRatio&&"ios"==
system.platform.name)el.id("body").style.fontSize="16px";if(browser.publisher.isOn)el.id("body").style.fontSize="5px";if(!system.platform.ios)window.WORKSPACE_ZOOM=!Modernizr.csstransforms3d||3!=window.system.device.version,fconsole.log("WORKSPACE_ZOOM",WORKSPACE_ZOOM);initSimpleUtils();workspace.init(resources.MAIN_FRAME);window.loadManager=new LoadManager;resources.BODY=document.body;publicationData.getPageProperty=function(a,b){var d=publicationData.page[a][b];return void 0==d?publicationData.page.defaults[b]:
d};window.PAGES_JS_FOLDER=ASSETS_FOLDER+"/pages/"+(system.platform.ios?"ios":"android");simpleLoadBook=function(){function b(d){a.setHighlight(d.type==SHOW_SEARCH_RESULTS)}function d(b){switch(b.type){case ZOOMIN_FROM_WORKSPACE:a.incZoom();break;case ZOOMOUT_FROM_WORKSPACE:a.decZoom()}}var c=el.id("mainFrame");a=new SimpleSwitcher(c);a.setPosition(e);initDragger(resources.MAIN_FRAME,a,publicationData.type!=PT_PHOTOALBUM&&publicationData.type!=PT_CATALOG,!CONTINIOUS_ZOOM);customEvents.addListener(ZOOMIN_FROM_WORKSPACE,
d);customEvents.addListener(ZOOMOUT_FROM_WORKSPACE,d);customEvents.addListener(SHOW_SEARCH_RESULTS,b);customEvents.addListener(CANCEL_SEARCH,b);DOUBLE_CLICK_TO_ZOOM&&resources.MAIN_FRAME.addEventListener(DOUBLE_CLICK,function(b){a.handleDoubleClick(b)})};browser.publisher.isOn?"android"==browser.publisher.deviceName?simpleLoadBook():a="ipad"==browser.publisher.deviceName&&"landscape"==browser.publisher.orientation&&!publicationData.presentationMode?new IOSBook(e,2):new IOSBook(e,1):system.platform.ios?
"ipad"===system.device.name?1==window.IPADVER?simpleLoadBook():a=new IOSBook(e):a=new IOSBook(e):simpleLoadBook();var d=function(){workspace.toolbars.isHide&&workspace.toolbars.toggle();d=null};customEvents.addListener(ZOOM_ANIMATION_END,d);customEvents.addListener(START_SEARCH,function(a){var b=function(){var b=eval("("+this.responseText+")");search.search(a.data.data,b.pages)};if(PUBL){var d=new XMLHttpRequest;d.open("GET",ASSETS_FOLDER+"/search/searchtext.js?1&"+PS);d.onload=function(){var a=new XMLHttpRequest;
a.open("GET",this.responseText);a.onload=b;a.onerror=function(){};a.send();delete a};d.onerror=function(){}}else d=new XMLHttpRequest,d.open("GET",ASSETS_FOLDER+"/search/searchtext.js"),d.onload=b,d.onerror=function(){document.write("Error: can`t load xml3")};d.send();delete d});window.book=a;pageMediator.addListener(function(b){a.goToPage(b,BOOK_FLIP_DURATION);workspace.buttons.pageTurnHandler(b)})};localPending=function(){b()};iPadDetectPending=function(){if(PUBL){var a=document.getElementsByTagName("head")[0],
e=document.createElement("script");e.id="formPrinter";e.type="text/javascript";e.src=LOCALS_FOLDER+"/"+publicationData.lang+"/textlang.js";a.appendChild(e)}else a=new XMLHttpRequest,a.open("GET",LOCALS_FOLDER+"/"+publicationData.lang+"/textlang.js"),a.onload=b,a.onerror=function(){document.write("Error: can`t load xml3")},a.send()};"undefined"!==typeof window.ondevicemotion&&-1!=navigator.platform.indexOf("iPad")?window.ondevicemotion=function(a){if(-1!=navigator.platform.indexOf("iPad"))window.IPADVER=
a.acceleration?2===window.devicePixelRatio?3:2:1,iPadDetectPending();window.ondevicemotion=null}:(window.IPADVER=0,iPadDetectPending());delete main};1<DEV.split("/").length?(PUBL=!0,DEV=DEV.split("/")[0],PUBLDOMAIN=document.referrer):PUBL=!1;PUBL?main():document.addEventListener("DOMContentLoaded",main,!1);
window.getBookRectangle=function(a){HORIZONTAL_MARGIN=VERTICAL_MARGIN=10;a=publicationData.size.width*(a?2:1)/publicationData.size.height;window.innerWidth/window.innerHeight>a?(bookHeight=window.innerHeight-2*VERTICAL_MARGIN,bookWidth=bookHeight*a,bookLeft=(window.innerWidth-bookWidth)/2,bookTop=VERTICAL_MARGIN):(bookWidth=window.innerWidth-2*HORIZONTAL_MARGIN,bookHeight=bookWidth/a,bookLeft=HORIZONTAL_MARGIN,bookTop=(window.innerHeight-bookHeight)/2);return{width:1*bookWidth.toFixed(0),height:1*
bookHeight.toFixed(0),top:1*bookTop.toFixed(0),left:1*bookLeft.toFixed(0)}};var el={id:function(a){return document.getElementById(a)},tag:function(a){return document.getElementsByTagName(a)[0]},tags:function(a){return document.getElementsByTagName(a)},add:function(a){return document.createElement(a)},del:function(a){browser.publisher.isOn?null!=document.getElementById(a)&&el.id(a).parentNode.removeChild(el.id(a)):el.id(a)&&el.id(a).parentNode.removeChild(el.id(a))},Class:function(){return document.getElementsByClassName(tag)}};
window.Modernizr=function(a,b,c){function e(a,b){for(var d in a){var f=a[d];if(!~(""+f).indexOf("-")&&k[f]!==c)return"pfx"==b?f:!0}return!1}function d(a,b,d){var f=a.charAt(0).toUpperCase()+a.slice(1),g=(a+" "+m.join(f+" ")+f).split(" ");if("string"===typeof b||"undefined"===typeof b)b=e(g,b);else{g=(a+" "+o.join(f+" ")+f).split(" ");a:{var a=g,l;for(l in a)if(f=b[a[l]],f!==c){b=!1===d?a[l]:"function"===typeof f?f.bind(d||b):f;break a}b=!1}}return b}var f={},g=b.documentElement,l=b.createElement("modernizr"),
k=l.style,h={}.toString,j=" -webkit- -moz- -o- -ms- ".split(" "),m="Webkit Moz O ms".split(" "),o="webkit moz o ms".split(" "),l={},n=[],p=n.slice,q,s=function(a,d,f,c){var e,l,k,h,j=b.createElement("div"),o=b.body,n=o||b.createElement("body");if(parseInt(f,10))for(;f--;)k=b.createElement("div"),k.id=c?c[f]:"modernizr"+(f+1),j.appendChild(k);return e=['&#173;<style id="smodernizr">',a,"</style>"].join(""),j.id="modernizr",(o?j:n).innerHTML+=e,n.appendChild(j),o||(n.style.background="",n.style.overflow=
"hidden",h=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),l=d(j,a),o?j.parentNode.removeChild(j):(n.parentNode.removeChild(n),g.style.overflow=h),!!l},r=function(){var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return function(d,f){f=f||b.createElement(a[d]||"div");d="on"+d;var g=d in f;return g||(f.setAttribute||(f=b.createElement("div")),f.setAttribute&&f.removeAttribute&&(f.setAttribute(d,""),g="function"===typeof f[d],"undefined"===
typeof f[d]||(f[d]=c),f.removeAttribute(d))),g}}(),B={}.hasOwnProperty,v;"undefined"!==typeof B&&"undefined"!==typeof B.call?v=function(a,b){return B.call(a,b)}:v=function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var d=p.call(arguments,1),f=function(){if(this instanceof f){var c=function(){};c.prototype=b.prototype;var c=new c,g=b.apply(c,d.concat(p.call(arguments)));
return Object(g)===g?g:c}return b.apply(a,d.concat(p.call(arguments)))};return f});l.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")};l.touch=function(){var d;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?d=!0:s(["@media (",j.join("touch-enabled),("),"modernizr){#modernizr{top:9px;position:absolute}}"].join(""),function(a){d=9===a.offsetTop}),d};l.postmessage=function(){return!!a.postMessage};l.hashchange=function(){return r("hashchange",
a)&&(b.documentMode===c||7<b.documentMode)};l.boxshadow=function(){return d("boxShadow")};l.textshadow=function(){return""===b.createElement("div").style.textShadow};l.cssanimations=function(){return d("animationName")};l.csstransforms=function(){return!!d("transform")};l.csstransforms3d=function(){var a=!!d("perspective");return a&&"webkitPerspective"in g.style&&s("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===
b.offsetHeight}),a};l.csstransitions=function(){return d("transition")};l.fontface=function(){var a;return s('@font-face {font-family:"font";src:url("https://")}',function(d,f){var c=b.getElementById("smodernizr"),c=(c=c.sheet||c.styleSheet)?c.cssRules&&c.cssRules[0]?c.cssRules[0].cssText:c.cssText||"":"";a=/src/i.test(c)&&0===c.indexOf(f.split(" ")[0])}),a};l.localstorage=function(){try{return localStorage.setItem("modernizr","modernizr"),localStorage.removeItem("modernizr"),!0}catch(a){return!1}};
l.webworkers=function(){return!!a.Worker};l.svg=function(){return!!b.createElementNS&&!!b.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect};l.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>","http://www.w3.org/2000/svg"==(a.firstChild&&a.firstChild.namespaceURI)};l.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(h.call(b.createElementNS("http://www.w3.org/2000/svg","clipPath")))};for(var u in l)v(l,u)&&(q=u.toLowerCase(),f[q]=l[u](),
n.push((f[q]?"":"no-")+q));f.addTest=function(a,b){if("object"==typeof a)for(var d in a)v(a,d)&&f.addTest(d,a[d]);else{a=a.toLowerCase();if(f[a]!==c)return f;b="function"==typeof b?b():b;"undefined"!=typeof enableClasses&&enableClasses&&(g.className+=" "+(b?"":"no-")+a);f[a]=b}return f};k.cssText="";return l=null,f._version="2.6.2",f._prefixes=j,f._domPrefixes=o,f._cssomPrefixes=m,f.hasEvent=r,f.testProp=function(a){return e([a])},f.testAllProps=d,f.testStyles=s,f}(this,this.document);
function OnePagePublication(a){this.HORIZONTAL_MARGIN=this.VERTICAL_MARGIN=10;this.bookLeft=this.bookTop=this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.active=this.block=!1;this.currentPage=a||1;this.pageBuff=1;this.flipSpeed=500;this.gesture=!1;this.loadBuffers={};this.initSizes=function(){var a=publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>a?(this.bookHeight=window.innerHeight-2*this.VERTICAL_MARGIN,this.bookWidth=this.bookHeight*
a,this.bookLeft=(window.innerWidth-this.bookWidth)/2,this.bookTop=this.VERTICAL_MARGIN):(this.bookWidth=window.innerWidth-2*this.HORIZONTAL_MARGIN,this.bookHeight=this.bookWidth/a,this.bookLeft=this.HORIZONTAL_MARGIN,this.bookTop=(window.innerHeight-this.bookHeight)/2);this.pageHeight=this.bookHeight;this.pageWidth=this.bookWidth;this.translateX=2*this.bookLeft+this.pageWidth};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active){highlight.show(a.currentPage);
for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.show(b)}});customEvents.addListener(CANCEL_SEARCH,function(){if(a.active){highlight.hide(a.currentPage);for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.hide(b)}});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});customEvents.addListener(IOS_LOAD_PAGE_START,function(a){if(1===
a.data.type){var a=a.data.page,b=el.add("div");b.id="preloader"+a;b.style.position="absolute";b.style.left="50%";b.style.top="50%";b.style.width="10em";b.style.height="10em";b.style.margin="-3em 0 0 -5em";workspace.preloader.add(b);publicationData.page[a].wide?el.id("widePage"+a).appendChild(b):el.id("divPage"+a).appendChild(b)}});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){1===a.data.type&&el.del("preloader"+a.data.page)});customEvents.addListener(IOS_LOAD_VECTOR_END,function(){})};
this.drawBook=function(a){this.active=!0;a=a||-10;if(-10!=a)this.currentPage=a;this.init();a=el.add("div");a.id="publicationDiv";a.style.width=this.bookWidth+"px";a.style.height=this.bookHeight+"px";a.style.top=this.bookTop+"px";a.style.left=this.bookLeft+"px";a.style.position="absolute";a.style.textAlign="center";a.style.opacity="1";el.id("mainFrame").appendChild(a);this.drawPage(this.currentPage);for(a=this.currentPage-this.pageBuff;a<=1*this.currentPage+this.pageBuff;a++)a!==this.currentPage&&
this.drawPage(a)};this.drawPage=function(a){if(publicationData.page[a]&&!el.id("divPage"+a)){var b=publicationData.page[a].wide;if(b){var c=el.add("div");c.id="divPage"+a;c.className="oneBook";c.style.width=this.pageWidth+"px";c.style.height=this.pageHeight+"px";c.style.position="absolute";c.style.backgroundColor="rgba(0,0,0,0)";c.style.color="black";c.style.left=publicationData.rtlMode?a>this.currentPage?-window.innerWidth+"px":a<this.currentPage?window.innerWidth+"px":"":a<this.currentPage?-window.innerWidth+
"px":a>this.currentPage?window.innerWidth+"px":"";var e=publicationData.rtlMode?publicationData.pageCount+a:publicationData.pageCount-a;c.style.zIndex=e+"";e=null;el.id("publicationDiv").appendChild(c)}var k=el.add("div");k.id=b?"widePage"+a:"divPage"+a;k.className="oneBook";k.style.width=this.pageWidth+"px";k.style.height=b?this.pageHeight/2+"px":this.pageHeight+"px";k.style.position="absolute";"photo_album"==publicationData.type||"document"==publicationData.type?k.style.backgroundColor="rgba(0,0,0,0)":
(k.style.backgroundColor=publicationData.page[a].BGColor||publicationData.page.defaults.BGColor,HTML5lib.boxShadow(k,"0px 0px 3px #000"));k.style.color="black";if(b)k.style.top=this.pageHeight/4+"px";if(publicationData.rtlMode)if(!b&&a>this.currentPage)k.style.left=-window.innerWidth+"px";else if(!b&&a<this.currentPage)k.style.left=window.innerWidth+"px";else{if(!b)k.style.left=""}else if(!b&&a<this.currentPage)k.style.left=-window.innerWidth+"px";else if(!b&&a>this.currentPage)k.style.left=window.innerWidth+
"px";else if(!b)k.style.left="";e=publicationData.rtlMode?publicationData.pageCount+a:publicationData.pageCount-a;k.style.zIndex=e+"";e=null;e=this.injectCanvas(k,a);b?c.appendChild(k):el.id("publicationDiv").appendChild(k);publicationData.page[a].stub?ZOOM_LOCK&&el.id("exPage"+a)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+a)},50)):(customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:a,type:1}),this.loadImage(e,a))}};this.injectCanvas=function(a,b){var c=publicationData.page[b].wide?
this.pageHeight/2:this.pageHeight,e=publicationData.page[b].width||publicationData.page.defaults.width,k=publicationData.page[b].height||publicationData.page.defaults.height,h=e/k;if(this.pageWidth/c>h)var j=c,m=j*h,h=(this.pageWidth-m)/2,c=0;else m=this.pageWidth,j=m/h,h=0,c=(c-j)/2;var o=el.add("canvas");o.id="substraitCanvas"+b;o.width=m;o.height=j;o.style.position="absolute";o.style.left=h+"px";o.style.top=c+"px";a.appendChild(o);var n=m/(2*e);("photo_album"==publicationData.type||"document"==
publicationData.type)&&HTML5lib.boxShadow(o,"0px 0px 3px #000");var p=publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===p||"js+png"===p)p=el.add("div"),p.id="contentDiv"+b,p.style.width=2*e+"px",p.style.height=2*k+"px",p.style.position="absolute",p.style.left=h+"px",p.style.top=c+"px",p.style.webkitTransformOrigin="0% 0%",p.style.webkitTransform="scale("+n+")",a.appendChild(p);var q=el.add("canvas");q.id="highlightCanvas"+b;q.width=m;q.height=j;q.style.position="absolute";
q.style.left=h+"px";q.style.top=c+"px";q.style.opacity=0;a.appendChild(q);new LinksLayer(q,b);highlight.show(b,q);customEvents.addListener(IOS_LOAD_BITMAP_END,function(){q.style.opacity=1});return o};this.destroyPage=function(a){el.id("divPage"+a)&&el.del("divPage"+a)};this.destroyBook=function(){el.del("publicationDiv");this.active=!1};this.goToPage=function(a){var b=this;if(a==this.currentPage+1){publicationData.rtlMode?this.shiftRight():this.shiftLeft();var c=this.currentPage-this.pageBuff;this.currentPage++;
this.drawPage(this.currentPage+this.pageBuff);setTimeout(function(){b.destroyPage(c)},this.slideDelay)}else if(a==this.currentPage-1)publicationData.rtlMode?this.shiftLeft():this.shiftRight(),c=this.currentPage+this.pageBuff,this.currentPage--,this.drawPage(this.currentPage-this.pageBuff),setTimeout(function(){b.destroyPage(c)},this.slideDelay);else if(a!=this.currentPage){if(1*a>1*this.currentPage){var e=1*this.currentPage+1;this.clearContent(e);publicationData.rtlMode?this.shiftRight():this.shiftLeft()}else e=
this.currentPage-1,this.clearContent(e),publicationData.rtlMode?this.shiftLeft():this.shiftRight();this.currentPage=a;var k=function(){b.destroyBook();b.drawBook(b.currentPage);delete k};window.setTimeout(k,b.flipSpeed);pageMediator.changePage(a)}};this.clearContent=function(a){if(el.id("divPage"+a))el.id("divPage"+a).style.backgroundColor="white",el.id("substraitCanvas"+a)&&el.del("substraitCanvas"+a),el.id("videoDiv"+a)&&el.del("videoDiv"+a),el.id("contentDiv"+a)&&el.del("contentDiv"+a),el.id("highlightCanvas"+
a)&&el.del("highlightCanvas"+a)};this.shiftLeft=function(){for(var a=this.currentPage-this.pageBuff;a<=this.currentPage+this.pageBuff;a++)if(el.id("divPage"+a)){var b=el.id("divPage"+a);HTML5lib.duration(b,this.flipSpeed);0==1*HTML5lib.getParseTranslate(b).x?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,-this.translateX,0,0)):1*HTML5lib.getParseTranslate(b).x==-this.translateX?HTML5lib.translate(b,2*-this.translateX,0,0):1*HTML5lib.getParseTranslate(b).x==2*this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),
HTML5lib.translate(b,this.translateX,0,0)):(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,0,0,0))}setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END)},this.flipSpeed)};this.shiftRight=function(){for(var a=this.currentPage-this.pageBuff;a<=this.currentPage+this.pageBuff;a++)if(el.id("divPage"+a)){var b=el.id("divPage"+a);HTML5lib.duration(b,this.flipSpeed);0==1*HTML5lib.getParseTranslate(b).x?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,this.translateX,
0,0)):1*HTML5lib.getParseTranslate(b).x==this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,2*this.translateX,0,0)):1*HTML5lib.getParseTranslate(b).x==2*-this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,-this.translateX,0,0)):(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,0,0,0))}setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END)},this.flipSpeed)};this.loadImage=function(a,b){var c=a.getContext("2d");c.fillStyle=
"rgb(255,255,255)";var e=publicationData.page[b].proportions||publicationData.page.defaults.proportions,k=publicationData.size.proportions,h=a.width,j=a.height,m=new Image,o=publicationData.page[b].format||publicationData.page.defaults.format;if(PUBL)"js+jpg"===o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".jpg?1&"+PS,this.loadContent(b,h)):"js+png"===o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png?1&"+PS,this.loadContent(b,h)):"jpg"===o?n=ASSETS_FOLDER+"/pages/page"+
this.getName(b)+"_i2.jpg?1&"+PS:"png"===o&&(n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.png?1&"+PS),o=new XMLHttpRequest,o.open("GET",n),o.onload=function(){m.src=this.responseText},o.onerror=function(){},o.send(),delete o;else{if("js+jpg"===o){var n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".jpg";this.loadContent(b,h)}else"js+png"===o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png",this.loadContent(b,h)):"jpg"===o?n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+
"_i2.jpg":"png"===o&&(n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.png");m.src=n}if(e>=k)var p=h,q=(p/e).toFixed(0),s=0,r=(j-q)/2;else q=j,p=(q*e).toFixed(0),s=(h-p)/2,r=0;m.onload=function(){ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+b)},50));c.drawImage(m,s,r,p,q);customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:b,type:1})}};this.addContentDiv=function(){};this.loadContent=function(a){var a=ASSETS_FOLDER+"/pages/ios/page"+
this.getName(a)+".js",b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.id="formPrinter";c.type="text/javascript";c.src=a;b.appendChild(c);window.fakeLoadComplete=function(a){window.loadBuffers[a]=window.loadBuffer;for(i in window.loadBuffers[a]){var b=el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*window.loadBuffers[a][i][4]+
"px";b.style.left=2*window.loadBuffers[a][i][5]+"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var d=document.createTextNode(window.loadBuffers[a][i][0]);b.appendChild(d);el.id("contentDiv"+a).appendChild(b);customEvents.fireEvent(IOS_LOAD_VECTOR_END,{page:a,type:1})}}};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};var b=this,c=-1,e=-1;this.touch=function(){!b.block&&!b.gesture&&!ZOOM_LOCK&&(c=Modernizr.touch?
event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){if(!b.block&&!b.gesture&&!ZOOM_LOCK&&(e=Modernizr.touch?event.changedTouches[0].pageX:event.pageX,-1!=c&&-1!=e)){var a=c-e;70<a?pageMediator.right():-70>a&&pageMediator.left();e=c=-1}};this.gesturestart=function(){b.gesture=!0;var a=b.currentPage;b.gestureDiv=el.id("divPage"+a);customEvents.fireEvent(ZOOM_ANIMATION_START);b.maxZoom=strUtils.getMaxZoom(b.pageWidth,b.pageHeight);b.gestureDiv.style.top=b.bookTop+"px";b.gestureDiv.style.left=
b.bookLeft+"px";b.gestureDiv.id="exPage"+b.currentPage;HTML5lib.boxShadow(b.gestureDiv,"");HTML5lib.duration(b.gestureDiv,0);b.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px)";el.id("mainFrame").appendChild(b.gestureDiv);if(el.id("videoDiv"+a))el.id("videoDiv"+a).style.opacity=0;b.destroyBook()};this.gesturechange=function(a){if(1<a.scale&&b.maxZoom>=a.scale)b.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+a.scale+","+a.scale+","+a.scale+")"};this.gestureend=function(a){var f=
b.currentPage;setTimeout(function(){b.gesture=!1},150);var c=b.maxZoom>a.scale?a.scale:b.maxZoom,a=function(){var a=b.pageWidth;publicationData.page[f].wide&&(a/=2);a=a*c/(publicationData.page[f].width||publicationData.page.defaults.width);customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:a,page:f})};1.2>c?(setTimeout(function(){HTML5lib.duration(b.gestureDiv,200);b.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d(1.2,1.2,1.2)"},
10),setTimeout(a,210),c=1.2):(b.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+c+","+c+","+c+")",a())};this.goToZoom=function(a){if(!this.block&&!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);if(el.id("videoDiv"+e))el.id("videoDiv"+e).style.opacity=0;var b=strUtils.getMaxZoom(this.pageWidth,this.pageHeight),c=this,e=this.currentPage,k=publicationData.page[e].wide,h=el.id("divPage"+this.currentPage);h.style.top=this.bookTop+"px";h.style.left=this.bookLeft+"px";h.style.webkitTransform=
"";h.id="exPage"+e;if(el.id("videoDiv"+e))el.id("videoDiv"+e).style.opacity=0;el.id("mainFrame").appendChild(h);a=1.5*window.innerWidth/this.pageWidth;a=a>b?b:a;setTimeout(function(){HTML5lib.duration(h,300);HTML5lib.changeOnlyScale(h,a,a,a)},10);var b=publicationData.page[e].width||publicationData.page.defaults.width,j=c.pageWidth;k&&(j/=2);var m=j*a/b;setTimeout(function(){c.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:m,page:e})},
360)}}}
function OrientationObserver(){that=this;this.zoom=!1;var a="onorientationchange"in window;this.prevWidth=window.innerWidth;this.prevHeight=window.innerHeight;this.getOrientation=function(){browser.publisher.isOn&&console.log(browser.publisher.orientation);if(window.innerWidth>window.innerHeight)return"landscape";if(window.innerWidth<window.innerHeight)return"portrait"};this.rotateDevice=function(){setTimeout(b,100)};this.getType=function(){if("photo_album"!=publicationData.type&&"document"!=publicationData.type&&
!publicationData.singlePageMode&&"ipad"===system.device.name&&"landscape"===that.getOrientation()||"photo_album"!=publicationData.type&&"document"!=publicationData.type&&!publicationData.singlePageMode&&browser.publisher.isOn&&"ipad"==browser.publisher.deviceName&&window.innerWidth>window.innerHeight)return that.typeBook=2;return that.typeBook=1};this.getType();var b=function(){that.prevWidth=window.innerWidth;that.prevHeight=window.innerHeight;that.getType();customEvents.fireEvent(ROTATE_DEVICE,
that.typeBook)},c=function(){browser.publisher.isOn?b():that.prevHeight>that.prevWidth&&window.innerWidth>=that.prevHeight?b():that.prevHeight<that.prevWidth&&window.innerWidth>=that.prevHeight&&window.innerWidth!=that.prevWidth&&b()};a&&!PUBL?window.addEventListener("orientationchange",b):browser.publisher.isOn||window.addEventListener("resize",c);system.device.iphone&&window.addEventListener("resize",function(){if(that.prevHeight!=window.innerHeight&&that.prevWidth==window.innerWidth)that.getType(),
customEvents.fireEvent(ROTATE_DEVICE,that.typeBook),that.prevWidth=window.innerWidth,that.prevHeight=window.innerHeight});customEvents.addListener(CHANGE_BOOK_TYPE,function(a){that.zoom=3==a.data.type?!0:!1})}
function PageController(a,b,c){this.page=a||1;this.changePage(this.page);this.rtl=c||!1;this._listeners=[];var e=this;if(0<this.page&&a<=publicationData.pageCount)PUBL?(window.location.hash="#"+pageTable.getUserIDFromFileID(this.page),parent.window.location=PUBLDOMAIN+window.location.hash):(GAEnable&&(a=window.location.pathname.split("/"),_trackPageview(a[a.length-4]+"-"+pageTable.getUserIDFromFileID(this.page))),window.location.hash="#"+pageTable.getUserIDFromFileID(this.page));this.hashChangeHandler=
function(){for(var a=/.*#(.*)/.exec(window.location.hash)[1],b=0,c=e._listeners.length;b<c;b++)e._listeners[b].call(e,pageTable.getFileIDFromUserID(a))};Modernizr.hashchange&&window.addEventListener("hashchange",function(){e.hashChangeHandler()})}
PageController.prototype={changePage:function(a){if("undefined"==typeof a)return!1;0==a&&(a=1);if(a>publicationData.pageCount)a=publicationData.pageCount;var b=strUtils.findArr(pageTable.doubleFlipList,a);0===a%2&&!publicationData.rtlmMde&&void 0==b?b=strUtils.findArr(pageTable.doubleFlipList,a+1):0!=a%2&&!publicationData.rtlmMde&&void 0==b?b=strUtils.findArr(pageTable.doubleFlipList,a-1):0===a%2&&publicationData.rtlmMde&&void 0==b?b=strUtils.findArr(pageTable.doubleFlipList,a-1):0!=a%2&&publicationData.rtlmMde&&
void 0==b&&(b=strUtils.findArr(pageTable.doubleFlipList,a+1));this.dubleCounter=b||0;this.page=a},addListener:function(a,b){b?this._listeners.unshift(a):this._listeners.push(a)},fire:function(){this.page=1>this.page?1:this.page;var a=this.page=this.page>publicationData.pageCount?publicationData.pageCount:this.page;if(0<a&&a<=publicationData.pageCount)PUBL?(window.location.hash="#"+pageTable.getUserIDFromFileID(this.page),parent.window.location=PUBLDOMAIN+window.location.hash):(GAEnable&&(a=window.location.pathname.split("/"),
_trackPageview(a[a.length-4]+"-"+pageTable.getUserIDFromFileID(this.page))),window.location.hash="#"+pageTable.getUserIDFromFileID(this.page));Modernizr.hashchange||this.hashChangeHandler()},removeListener:function(a){for(i in this._listeners)this._listeners[i].toString()==a.toString()&&this._listeners.splice(i,1)},right:function(){if(2==orientationObserver.typeBook&&!orientationObserver.zoom){if(this.dubleCounter<=pageTable.doubleFlipList.length-1)this.dubleCounter=this.rtl?1*this.dubleCounter-1:
1*this.dubleCounter+1;this.page=pageTable.doubleFlipList[this.dubleCounter]}else this.page=this.rtl?1*this.page-1:1*this.page+1;this.fire()},left:function(){if(2==orientationObserver.typeBook&&!orientationObserver.zoom){if(0<=this.dubleCounter)this.dubleCounter=this.rtl?1*this.dubleCounter+1:1*this.dubleCounter-1;this.page=pageTable.doubleFlipList[this.dubleCounter]}else this.page=this.rtl?1*this.page+1:this.page-1;this.fire()},goToPage:function(a){this.changePage(a);this.fire()},maxLeft:function(){this.page=
this.rtl?publicationData.pageCount:1;this.fire()},maxRight:function(){this.page=this.rtl?1:publicationData.pageCount;this.fire()},isLast:function(){return 2==orientationObserver.typeBook&&!orientationObserver.zoom?1*this.dubleCounter===pageTable.doubleFlipList.length-1?!0:!1:this.page===publicationData.pageCount?!0:!1}};
var PagerLite=function(a){this.div=a.pagerDiv;this.currentPageDiv=a.currentPageDiv;this.lastPageDiv=a.lastPageDiv;this.currentPageDiv.innerHTML=pageTable.getCaption(pageMediator.page);this.lastPageDiv.innerHTML=" / "+publicationData.pageUserCount;var b=this;pageMediator.addListener(function(a){b.changeLabel(a)});!0==a.connectSlider&&customEvents.addListener(SLIDER_TO_PAGER_CHANGE_LABEL,function(a){b.changeLabel(a.data.page)})};
PagerLite.prototype.changeLabel=function(a){this.currentPageDiv.firstChild.data=pageTable.getCaption(a)};
PagerLite.create=function(a){var b=workspace.createElement({id:a.parent.id+"PagerField",cssClassName:"pagerField",parent:a.parent,insertBefore:a.insertBefore}),c=workspace.createElement({id:a.parent.id+"PagerCurrentPage",cssClassName:"pagerFont",parent:b}),e=workspace.createElement({id:a.parent.id+"PagerLastPage",cssClassName:"pagerFont",parent:b});return new PagerLite({pagerDiv:b,currentPageDiv:c,lastPageDiv:e,connectSlider:a.connectSlider})};
function PageTable(){var a=0;this.captionToID=[];this.IDToDoubleCaption=[];this.IDToCaption=[];this.userIDToFileID=[];this.fileIDTouserID=[];this.doubleFlipList=[];publicationData.pageUserCount=publicationData.pageCount;var b=1,c=1;for(page in publicationData.page)if("defaults"!=page){var e=1*page+a;publicationData.page[page].wide&&(this.userIDToFileID[1*page+a]=1*page,this.fileIDTouserID[1*page+a]=1*page,a++,e=1*page+a-1+"-"+(1*page+a));this.userIDToFileID[1*page+a]=1*page;this.fileIDTouserID[1*
page]=1*page+a;this.captionToID[e]=1*page;this.IDToCaption[page]="one"!=publicationData.wideas?e:page;1==page?(this.IDToDoubleCaption[1]=1,this.doubleFlipList.push(page)):1==b?(c++,e=c,publicationData.page[page].wide?"one"!=publicationData.wideas&&(c++,e=e+"-"+c):(c++,e=e+"-"+c),this.IDToDoubleCaption[page]=e,publicationData.page[page].wide?b=1:b++,this.doubleFlipList.push(page)):(this.IDToDoubleCaption[page]=this.IDToDoubleCaption[page-1],b=1)}"one"!=publicationData.wideas&&(publicationData.pageUserCount+=
a);1!=this.IDToDoubleCaption[publicationData.pageCount]&&1*this.IDToDoubleCaption[publicationData.pageCount].split("-")[1]>publicationData.pageUserCount&&(this.IDToDoubleCaption[publicationData.pageCount]=this.IDToDoubleCaption[publicationData.pageCount].split("-")[0]);this.getCaption=function(a){if(orientationObserver.zoom||1===orientationObserver.getType())return publicationData.rtlMode?(this.IDToCaption[a]+"").split("-").reverse().join("-"):this.IDToCaption[a];if(2===orientationObserver.getType())return publicationData.rtlMode?
(this.IDToDoubleCaption[a]+"").split("-").reverse().join("-"):this.IDToDoubleCaption[a]};this.getFileID=function(a){return this.captionToID[a]};this.getFileIDFromUserID=function(a){return this.userIDToFileID[a]};this.getUserIDFromFileID=function(a){return this.fileIDTouserID[a]}}
var Popover=function(a){this.isVisible=!1;this.shiftLevel=0;this.state=a.state;this.horisontalPosition=a.horisontalPosition||"center";this.deleteAfterClose=a.deleteAfterClose||!1;this.submenuList=[];if("undefined"!=typeof a.horisontalPosition)this.div=workspace.createElement({type:"div",id:a.id,cssClassName:"popover",parent:el.id(a.parent)});outerDiv=workspace.createElement({type:"div",id:a.id+"ContentOuter",cssClassName:"contentOuter",parent:this.div});"tablet"==DEV&&(workspace.addCssClass(this.div,
"fixedWidth"),"help"!=this.state&&"notify"!=this.state&&workspace.addCssClass(this.div,"fixedHeightForToolbar"));this.contentDiv=workspace.createElement({type:"div",id:a.id+"ContentInner",cssClassName:"contentInner",parent:outerDiv});"mobile"==DEV&&workspace.addCssClass(this.div,"topAnimation");"tablet"==DEV&&("center"!=a.horisontalPosition?workspace.addCssClass(this.div,"leftAnimation"):workspace.addCssClass(this.div,"topAnimation"));"center"==a.horisontalPosition&&(workspace.addCssClass(this.div,
"centered"),this.reposition());"mobile"==DEV&&"undefined"==typeof a.noCloseButton&&this.addCloseButton();a=/android 4.*galaxy nexus/i;a.test(navigator.userAgent);a=/android 3.*sony tablet s/i;if(a.test(navigator.userAgent))this.div.style.WebkitTransitionDuration="0s"};
Popover.prototype.addCloseButton=function(){this.closeButton=Button.create({id:this.div.id+"CloseButton",text:LOCALS.CLOSE_BUTTON,cssClassName:"closeButton",field:this.div.id,pressing:!0,insertBefore:this.div.firstChild});var a=this;this.closeButton.addAction(DOWN_EVENT,function(){});this.closeButton.addAction(SINGLE_CLICK,function(){a.hide()});setClickEvents(this.div,"dm");this.contentDiv.addEventListener(DOWN_EVENT,function(b){b.target.id!=a.closeButton.div.id&&a.closeButton.hide()},!1);this.contentDiv.addEventListener(UP_EVENT,
function(){a.closeButton.show()},!1);this.contentDiv.addEventListener("touchcancel",function(){a.closeButton.show()},!1);this.contentDiv.addEventListener("mouseout",function(){a.closeButton.show()},!1)};
Popover.prototype.addBlackOutDiv=function(){var a=this;this.blackout=workspace.createElement({id:"popoverBlackout",cssClassName:"popoverBlackout",parent:el.id("body"),insertBefore:el.id("mainFrame").nextSibling});"help"==this.state&&workspace.addCssClass(this.blackout,"dark");setClickEvents(a.blackout,"dm");this.blackout.addEventListener(UP_EVENT,function(){a.delBlackOutDiv();a.hide()})};
Popover.prototype.delBlackOutDiv=function(){if("undefined"!=typeof this.blackout)el.del(this.blackout.id),this.blackout=null,delete this.blackout};Popover.prototype.del=function(){var a=["transitionend","OTransitionEnd","webkitTransitionEnd"],b=this.div.id,c;for(c in a)this.div.addEventListener(a[c],function(){el.del(b)},!1);delete null};
Popover.prototype.changeLabel=function(a,b){"toc"==a&&(workspace.addCssClass(this.label.tocButton.div,"opened"),this.label.tocButton.changeTextInsideButton(b),workspace.delCssClass(this.label.bmButton.div,"opened"),workspace.delCssClass(this.label.bmButton.div,"active"),workspace.addCssClass(this.label.bmButton.div,"bmButton"),workspace.delCssClass(this.label.tocButton.div,"tocButton"));"bm"==a&&(workspace.delCssClass(this.label.tocButton.div,"opened"),workspace.delCssClass(this.label.tocButton.div,
"active"),this.label.bmButton.changeTextInsideButton(b),workspace.addCssClass(this.label.bmButton.div,"opened"),workspace.addCssClass(this.label.tocButton.div,"tocButton"),workspace.delCssClass(this.label.bmButton.div,"bmButton"));this.label.firstChild.data={share:LOCALS.SHARE,more:LOCALS.MORE}[a]||b};Popover.prototype.changeState=function(a){this.state=a;this.changeLabel(a,{toc:LOCALS.TOC,bm:LOCALS.BOOKMARKS}[a]);this.delContent();this.addContent();!1==this.isVisible&&this.show()};
Popover.prototype.addLabel=function(a){this.label=el.add("h3");this.label.setAttribute("id",this.div.id+"Label");this.label.className="buttonsField contentLabel";workspace.addCssClass(this.div,"withLabel");this.div.insertBefore(this.label,this.contentDiv.parentNode);setClickEvents(this.label,"p");if("undefined"!=typeof a.twoTabs&&a.twoTabs){this.twoTabs=!0;this.label.tocButton=Button.create({id:this.div.id+"TocButton",cssClassName:this.div.id+"LabelButton opened",text:LOCALS.TOC,field:this.label.id,
pressing:!0,able:!0});this.label.tocButton.addAction(DOWN_EVENT);this.label.bmButton=Button.create({id:this.div.id+"BmButton",cssClassName:this.div.id+"LabelButton bmButton",field:this.label.id,pressing:!0,able:!bm.isEmpty()});this.label.bmButton.addAction(DOWN_EVENT);var b=this.label.bmButton;customEvents.addListener(ADD_BM,function(){b.makeAble()});customEvents.addListener(REMOVE_BM,function(){bm.isEmpty()&&b.makeDisable()})}else this.twoTabs=!1,"undefined"!=typeof a.text&&this.label.appendChild(document.createTextNode(a.text));
delete this;this.hasLabel=!0};Popover.prototype.show=function(){workspace.popovers.oneOfPopoversIsVisible=!0;document.activeElement.blur();"tablet"==DEV&&"notify"!=this.state&&this.addBlackOutDiv();workspace.delCssClass(this.div,"hide");workspace.addCssClass(this.div,"show");this.isVisible=!0;system.platform.android&&"tablet"!=DEV&&workspace.addCssClass(resources.MAIN_FRAME,"invisible")};
Popover.prototype.hide=function(){system.platform.android&&"tablet"!=DEV&&workspace.delCssClass(resources.MAIN_FRAME,"invisible");workspace.popovers.oneOfPopoversIsVisible=!1;document.activeElement.blur();!0==this.deleteAfterClose&&this.del();workspace.delCssClass(this.div,"show");workspace.addCssClass(this.div,"hide");this.isVisible=!1};Popover.prototype.changeVisibility=function(){!0==this.isVisible?this.hide():this.show()};
Popover.prototype.showForAWhile=function(a){this.show();var b=this;window.setTimeout(function(){b.hide()},a)};Popover.prototype.reposition=function(){this.div.style.marginLeft=~~(-this.div.offsetWidth/2)+"px"};
Popover.prototype.SubMenu=function(a){a.scroll="undefined"==typeof a.scroll?!0:a.scroll;a.scroll?(a.parent.submenuList[a.parent.submenuNumber]=this,this.div=workspace.createElement({type:"div",id:a.parent.div.id+"SubMenuField"+a.parent.submenuNumber,cssClassName:"subMenu",parent:a.parent.contentDiv}),this.ul=workspace.createElement({type:"ul",id:a.parent.div.id+"SubMenuUl"+a.parent.submenuNumber,cssClassName:"buttonsField subMenuUl",parent:this.div}),this.div.style[HTML5lib.browserPrefix+"Transform"]=
"translate3d(0"+100*a.parent.submenuNumber+"%, 0px, 200px)"):this.ul=workspace.createElement({type:"ul",id:a.parent.div.id+"SubMenuUl"+a.parent.submenuNumber,cssClassName:"buttonsField subMenuUl",parent:a.parent.contentDiv});a.parent.submenuNumber++;1<a.parent.submenuNumber&&this.addSubMenuElement({content:{name:""},i:0,rightElement:"arrowL",foo:function(){a.parent.shiftSubmenus("back")}});var b=this;a.scroll&&window.setTimeout(function(){b.scroll=new iScroll(b.div.id,{hScrollbar:!1,vScrollbar:!1,
shrinkScrollbar:!1,checkDOMChanges:!1,fadeScrollbar:!1})},0);"undefined"!=typeof a.limit?(this.limitedContent=this.separateContent(a.content,a.limit),!1!=this.limitedContent?(a.content=this.limitedContent[0],this.limitedContent.currUL=0,this.addULContent({parent:a.parent,content:this.limitedContent[this.limitedContent.currUL],rightElement:a.rightElement}),this.addSubMenuElement({content:{name:LOCALS.SEARCH_NEXT},i:"0next",cssClass:"limitationElement",foo:function(){b.showNextLimited({parent:a.parent,
rightElement:a.rightElement})}})):this.addULContent({parent:a.parent,content:a.content,rightElement:a.rightElement})):this.addULContent({parent:a.parent,content:a.content,rightElement:a.rightElement});a.scroll&&window.setTimeout(function(){b.scroll.refresh()},0)};
Popover.prototype.SubMenu.prototype.addULContent=function(a){var b=1,c=this;if("undefined"!=typeof a.content)for(var e in a.content.children)"undefined"!=typeof a.content.children[e].children?this.addSubMenuElement({content:a.content.children[e],i:b++,rightElement:"arrowR",foo:function(b,f){var g=new a.parent.SubMenu({parent:a.parent,rightElement:a.rightElement,content:b});"undefined"!=typeof c.pressedElementID&&workspace.delCssClass(el.id(c.pressedElementID),"pressed");c.pressedElementID=f;a.parent.shiftSubmenus("forvard");
delete null}}):this.addSubMenuElement({content:a.content.children[e],i:b++,rightElement:a.rightElement,foo:function(){"undefined"!=typeof c.pressedElementID&&workspace.delCssClass(el.id(c.pressedElementID),"pressed");a.parent.delBlackOutDiv();a.parent.hide()}})};
Popover.prototype.SubMenu.prototype.addSubMenuElement=function(a){if("undefined"==typeof a.ulID)a.ulID=this.ul.id;if("undefined"==typeof a.type)a.type="li";var b=Button.create({type:a.type,id:a.ulID+"el"+a.i,field:a.ulID,pressing:!0,cssClassName:"subMenuElement",text:a.content.name});if("undefined"!=typeof a.rightElement){workspace.addCssClass(b.div,"withRightField");var c=workspace.createElement({type:"div",id:this.ul.id+"el"+a.i+"Right",cssClassName:"subMenuElementRightField",parent:b.div});c.innerHTML=
"page"==a.rightElement?LOCALS.PAGE_NUMBER+" "+a.content[a.rightElement]:"undefined"!=typeof a.content[a.rightElement]?a.content[a.rightElement]:"";"arrowR"==a.rightElement&&workspace.addCssClass(c,"arrowR");"arrowL"==a.rightElement&&workspace.addCssClass(c,"arrowL");delete c}if("undefined"!=typeof a.leftElement)workspace.addCssClass(b.div,"withLeftField"),c=workspace.createElement({type:"div",id:this.ul.id+"el"+a.i+"Left",cssClassName:"subMenuElementLeftField",parent:b.div}),c.innerHTML="undefined"!=
typeof a.content[a.leftElement]?a.content[a.leftElement]:"","image"==a.leftElement&&workspace.addCssClass(c,"image"),"undefined"!=typeof a.css&&workspace.addCssClass(c,a.css),delete c;if("a"==a.type)return a.foo(b.div),!1;"undefined"!=typeof a.foo&&b.addAction(SINGLE_CLICK,function(b){a.foo(a.content,b.target.id)});if("undefined"!=typeof a.content.page&&"undefined"==typeof a.content.children){var e="undefined"!=typeof a.content.realID?a.content.realID:pageTable.getFileIDFromUserID(a.content.page);
b.addAction(SINGLE_CLICK,function(){window.setTimeout(function(){pageMediator.goToPage(e)},500)});delete e}"undefined"!=typeof a.cssClass&&workspace.addCssClass(b.div,a.cssClass);delete null};Popover.prototype.SubMenu.prototype.clear=function(){for(;this.ul.hasChildNodes();)this.ul.removeChild(this.ul.lastChild);var a=this.div.childNodes,b;for(b in a)"object"==typeof a[b]&&-1==a[b].id.indexOf("SubMenu")&&this.div.removeChild(a[b])};
Popover.prototype.SubMenu.prototype.showNextLimited=function(a){for(var b=this;this.ul.hasChildNodes();)this.ul.removeChild(this.ul.lastChild);this.limitedContent.currUL+=1;this.addSubMenuElement({content:{name:LOCALS.SEARCH_PREV},i:this.limitedContent.currUL+"prev",cssClass:"limitationElement",foo:function(){b.showPrevLimited({parent:a.parent,rightElement:a.rightElement})}});this.addULContent({parent:a.parent,content:this.limitedContent[this.limitedContent.currUL],rightElement:a.rightElement});"undefined"!=
typeof this.limitedContent[this.limitedContent.currUL+1]&&this.addSubMenuElement({content:{name:LOCALS.SEARCH_NEXT},i:this.limitedContent.currUL+"next",cssClass:"limitationElement",foo:function(){b.showNextLimited({parent:a.parent,rightElement:a.rightElement})}});window.setTimeout(function(){b.scroll.refresh();b.scroll.scrollTo(0,1,50)},200)};
Popover.prototype.SubMenu.prototype.showPrevLimited=function(a){for(var b=this;this.ul.hasChildNodes();)this.ul.removeChild(this.ul.lastChild);this.limitedContent.currUL-=1;0<this.limitedContent.currUL&&this.addSubMenuElement({content:{name:LOCALS.SEARCH_PREV},i:this.limitedContent.currUL+"prev",cssClass:"limitationElement",foo:function(){b.showPrevLimited({parent:a.parent,rightElement:a.rightElement})}});this.addULContent({parent:a.parent,content:this.limitedContent[this.limitedContent.currUL],rightElement:a.rightElement});
this.addSubMenuElement({content:{name:LOCALS.SEARCH_NEXT},i:this.limitedContent.currUL+"next",cssClass:"limitationElement",foo:function(){b.showNextLimited({parent:a.parent,rightElement:a.rightElement})}});window.setTimeout(function(){b.scroll.scrollToPage(0,30,50);b.scroll.refresh()},200)};
Popover.prototype.SubMenu.prototype.separateContent=function(a,b){var c={},e=Object.keys(a.children).length;if(e<b)return!1;c.countUL=(e-e%b)/b;for(var d=0;d<c.countUL;d++){c[d]={children:{}};for(var f=b*d;f<b*(d+1);f++)c[d].children[f]=a.children[f]}c[c.countUL]={children:{}};for(f=b*d;f<e;f++)c[c.countUL].children[f]=a.children[f];this.countUL++;return c};
Popover.prototype.shiftSubmenus=function(a){var b=this;switch(a){case "forvard":this.shiftLevel++;"undefined"!=typeof b.submenuList[b.shiftLevel-1].pressedElementID&&workspace.addCssClass(el.id(b.submenuList[b.shiftLevel-1].pressedElementID),"pressed");window.setTimeout(function(){if(0<b.shiftLevel)b.submenuList[b.shiftLevel-1].div.style.visibility="hidden"},1E3);break;case "back":this.shiftLevel--;this.deleteLastSubmenu();"more"==this.state&&this.changeLabel(this.state);this.submenuList[this.shiftLevel].div.style.visibility=
"visible";break;case "home":this.shiftLevel=0}translation=100*-this.shiftLevel;this.contentDiv.style[HTML5lib.browserPrefix+"Transform"]="translate3d("+translation+"%, 0px, 0px)"};
Popover.prototype.deleteLastSubmenu=function(a){if(0>this.submenuList.length)return!1;var b=this,a="undefined"!=typeof a&&"undefined"!=typeof a.delay?a.delay:400;window.setTimeout(function(){b.submenuList[b.submenuList.length-1].scroll.destroy();b.submenuList[b.submenuList.length-1].scroll=null;el.del(b.submenuList[b.submenuList.length-1].div.id);b.submenuList.splice(-1,1)},a);this.submenuNumber--;delete a};
Popover.prototype.deleteTheOnlySubmenu=function(){this.submenuList[this.submenuList.length-1].scroll.destroy();this.submenuList[this.submenuList.length-1].scroll=null;el.del(this.submenuList[this.submenuList.length-1].div.id);this.submenuList.splice(-1,1);this.submenuNumber--};Popover.prototype.getSubmenuList=function(){var a=this.contentDiv.childNodes,b=[],c;for(c in a)"object"==typeof a[c]&&-1!=a[c].id.indexOf("SubMenuField")&&b.push(a[c].id);return b};Popover.prototype.addContent=function(){popoverContent[this.state](this)};
Popover.prototype.delContent=function(){for("undefined"!=typeof this.subMenu&&0<this.shiftLevel&&this.shiftSubmenus("home");this.contentDiv.hasChildNodes();)this.contentDiv.removeChild(this.contentDiv.lastChild);for(;1<this.contentDiv.parentNode.childNodes.length;)this.contentDiv.parentNode.removeChild(this.contentDiv.parentNode.firstChild);workspace.delCssClass(this.contentDiv.parentNode,"withSearch");this.submenuNumber=0;this.subMenu=null;delete this.subMenu};
Popover.prototype.redrawContent=function(){this.delContent();this.addContent()};
var popoverContent={help:function(a){var b={"0":{category:LOCALS.GESTURES_HELP_LABEL,caption:LOCALS.SLIDE_HELP_LABEL,explanation:LOCALS.SLIDE_HELP_TEXT,image:STYLES_FOLDER+"/info/slide.png"},1:{caption:LOCALS.SINGLETAP_HELP_LABEL,explanation:LOCALS.SINGLETAP_HELP_TEXT,image:STYLES_FOLDER+"/info/singletapside.png",relyOn:!0},2:{caption:LOCALS.CENTERTAP_HELP_LABEL,explanation:LOCALS.CENTERTAP_HELP_TEXT,image:STYLES_FOLDER+"/info/singletapcenter.png"},3:{caption:LOCALS.DOUBLETAP_HELP_LABEL,explanation:LOCALS.DOUBLETAP_HELP_TEXT,
image:STYLES_FOLDER+"/info/doubletap.png",relyOn:!0==system.platform.ios||DOUBLE_CLICK_TO_ZOOM},4:{caption:LOCALS.PINCH_HELP_LABEL,explanation:LOCALS.PINCH_HELP_TEXT,image:STYLES_FOLDER+"/info/pinch.png",relyOn:!workspace.needZoomTolbar()},5:{caption:LOCALS.MOVE_HELP_LABEL,explanation:LOCALS.MOVE_HELP_TEXT,image:STYLES_FOLDER+"/info/move.png"},6:{caption:LOCALS.ROTATE_HELP_LABEL,explanation:LOCALS.ROTATE_HELP_TEXT,image:STYLES_FOLDER+"/info/rotate.png"},7:{category:LOCALS.TOOLBAR_HELP_LABEL,explanation:LOCALS.VIEW_TOC_HELP_LABEL,
fontImage:"tocButton",relyOn:publicationData.visibility.toc||publicationData.visibility.bookmarks},8:{explanation:LOCALS.ADD_BOOKMARK_HELP_LABEL,fontImage:"addButton",relyOn:publicationData.visibility.bookmarks},9:{explanation:LOCALS.SEARCH_BY_KEY_HELP_LABEL,fontImage:"searchButton",relyOn:publicationData.visibility.search},10:{explanation:LOCALS.START_SLIDESHOW_HELP_LABEL,fontImage:"slideShowButton",relyOn:publicationData.visibility.slideshow},11:{explanation:LOCALS.DOWNLOAD_HELP_LABEL,fontImage:"downloadButton",
relyOn:publicationData.visibility.downloads},12:{explanation:LOCALS.SHARE_HELP_LABEL,fontImage:"shareButton",relyOn:publicationData.visibility.share},13:{explanation:LOCALS.MORE_HELP_LABEL,fontImage:"moreButton",relyOn:!!workspace.buttons.list.moreButton}};a.submenuNumber=0;a.subMenu=new a.SubMenu({parent:a,scroll:!0});for(var c in b)"undefined"!=typeof b[c].relyOn&&!b[c].relyOn&&!system.platform.publisher&&delete b[c];for(c in b){if("undefined"!=typeof b[c].category){var e=workspace.createElement({type:"h4",
id:a.div.id+"HelpCategory"+c,cssClassName:"helpCategory",parent:a.subMenu.ul});e.innerHTML=b[c].category}e=workspace.createElement({type:"figure",id:a.div.id+"HelpElement"+c,cssClassName:"helpElement",parent:a.subMenu.ul});if("undefined"!=typeof b[c].fontImage){var d=workspace.createElement({type:"div",id:a.div.id+"HelpImg"+c,cssClassName:"helpImg button",parent:e});workspace.addCssClass(d,"fontImage "+b[c].fontImage)}if("undefined"!=typeof b[c].image)d=workspace.createElement({type:"img",id:a.div.id+
"HelpImg"+c,cssClassName:"helpImg",parent:e}),d.src=b[c].image;if("undefined"!=typeof b[c].caption)e=workspace.createElement({type:"figurecaption",id:a.div.id+"HelpCaption"+c,cssClassName:"helpCaption",parent:e}),e.innerHTML=b[c].caption+":<br/>";e=workspace.createElement({type:"div",id:a.div.id+"HelpExplanation"+c,cssClassName:"helpExplanation",parent:e});e.innerHTML=b[c].explanation}window.setTimeout(function(){a.subMenu.scroll.refresh()},2E3);delete null;delete null;delete null;delete null},toc:function(a){a.submenuNumber=
0;a.subMenu=new a.SubMenu({parent:a,content:publicationData.toc})},bm:function(a){a.subMenu=new a.SubMenu({parent:a,content:bm.bmContent,rightElement:"page"})},search:function(a){arguments.callee.handleSearchStart=function(){a.subMenu.clear();workspace.preloader.add(a.contentDiv);e.blur()};arguments.callee.getNextResultPageNumber=function(a){for(var b in a)if(a[b].realID==pageMediator.page&&"undefined"!=typeof a[1*b+1])return a[1*b+1].realID;return a[0].realID};arguments.callee.getPrevResultPageNumber=
function(a){for(var b in a)if(a[b].realID==pageMediator.page&&"undefined"!=typeof a[1*b-1])return a[1*b-1].realID;return a[Object.keys(a).length-1].realID};arguments.callee.handleSearchResults=function(b){popoverContent.search.searchResults=b.data.children;workspace.preloader.del(a.contentDiv);var f=system.platform.ios?70:15;LOCALS.SEARCH_PREV=LOCALS.SEARCH_PREV.replace("{0}",f);LOCALS.SEARCH_NEXT=LOCALS.SEARCH_NEXT.replace("{0}",f);a.deleteTheOnlySubmenu();a.subMenu=new a.SubMenu({parent:a,content:b.data,
rightElement:"page",limit:f});if("undefined"==typeof b.data.children[0]){workspace.createElement({type:"span",id:"noResultsText",cssClassName:"searchMessage",text:LOCALS.SEARCH_EMPTY_TEXT,parent:a.subMenu.div});with(workspace.toolbars)list.searchToolbar.isActive=!1,list.searchToolbar.hide(),workspace.delCssClass(list.pagerToolbar.div,"forSearch")}else with(workspace.toolbars)workspace.addCssClass(list.pagerToolbar.div,"forSearch"),list.searchToolbar.isActive=!0,list.searchToolbar.show();var c=function(a,
b){for(var d in a)if(a[d].realID==b)return 1*d+1;return 0};with(workspace.toolbars.list.searchToolbar)workspace.setText(resultCount.id,Object.keys(b.data.children).length),workspace.setText(currentResultNumber.id,c(b.data.children,pageMediator.page));pageMediator.addListener(function(a){workspace.setText(currentResultNumber.id,c(b.data.children,a))})};workspace.addCssClass(a.contentDiv.parentNode,"withSearch");var b=function(){document.activeElement.blur();e.blur();window.focus();window.blur();e.focus();
e.select();document.activeElement.blur();e.blur();return e.value.length<publicationData.search.lim?(LOCALS.SEARCH_NOTE_TEXT=LOCALS.SEARCH_NOTE_TEXT.replace("3",publicationData.search.lim),a.subMenu.clear(),workspace.createElement({type:"span",id:"noResultsText",cssClassName:"searchMessage",text:LOCALS.SEARCH_NOTE_TEXT,parent:a.subMenu.div}),!1):!0},c=workspace.createElement({type:"div",id:a.div.id+"startSearchField",cssClassName:"buttonsField startSearchField",parent:a.contentDiv.parentNode,insertBefore:a.contentDiv});
Button.create({id:"startSearchButton",text:LOCALS.FIND_BUTTON,field:c.id,pressing:!0,able:!0}).addAction(UP_EVENT,function(){b()&&customEvents.fireEvent(START_SEARCH,{data:e.value})});var e=workspace.createElement({type:"input",id:a.div.id+"inputSearch",cssClassName:"inputSearch ableSelectText ableEditText ",parent:c});e.setAttribute("type","search");e.setAttribute("placeholder",LOCALS.SEARCH_TEXT+"..");e.addEventListener("keydown",function(){var a=event;a.target=a.target?a.target:a.srcElement;window.focus();
e.focus();13==a.keyCode&&b()&&customEvents.fireEvent(START_SEARCH,{data:e.value})});a.submenuNumber=0;a.subMenu=new a.SubMenu({parent:a,rightElement:"page"})},download:function(a,b){var c=0,e="undefined"!=typeof workspace.buttons.list.moreButton?"image":void 0;a.submenuNumber=0;a.subMenu=new a.SubMenu({parent:a,scroll:b||!1});var d=function(a){var b=" "+LOCALS.BYTE;1024<a&&(a=(a/1024).toFixed(1),b=" "+LOCALS.KILO_BYTE,1024<a&&(a=(a/1024).toFixed(1),b=" "+LOCALS.MEGA_BYTE,1024<a&&(a=(a/1024).toFixed(1),
b=" "+LOCALS.GIGA_BYTE)));return a+b},f=function(a,b){var d=new XMLHttpRequest;with(d)open("GET",b),onload=function(){b=this.responseText;a.setAttribute("href",b);a.setAttribute("target","_blank")},onerror=function(){},send();delete d};if(!0==publicationData.downloads.publicationDownload){var g=COMMON_FOLDER+"/../"+publicationData.downloads.url;a.subMenu.addSubMenuElement({content:{name:"download"==a.state?LOCALS.DOWNLOAD_PUBLICATION:LOCALS.MORE_DOWNLOAD_PUBLICATION,size:d(publicationData.downloads.size)},
i:c++,rightElement:"size",leftElement:e,css:"fontImage downloadButton",type:"a",foo:function(a){PUBL?f(a,g):(a.setAttribute("href",g),a.setAttribute("target","_blank"))}})}if(!0==publicationData.downloads.pageDownload){var l="undefined"!=typeof book&&2==book.type&&publicationData.page[pageMediator.page].wide;if("undefined"!=typeof book&&2==book.type&&!l){var l=pageTable.getFileIDFromUserID(book.twoPage.currentPage.left),k=pageTable.getFileIDFromUserID(book.twoPage.currentPage.right);if(0<l&&publicationData.downloads.page[l]){var h=
COMMON_FOLDER+"/../"+publicationData.downloads.page[l].url;a.subMenu.addSubMenuElement({content:{name:"download"==a.state?LOCALS.DOWNLOAD_CURRENT_LEFT_PAGE:LOCALS.MORE_DOWNLOAD_CURRENT_LEFT_PAGE,size:d(publicationData.downloads.page[l].size)},i:c++,rightElement:"size",leftElement:e,css:"fontImage downloadButton",type:"a",foo:function(a){PUBL?f(a,h):(a.setAttribute("href",h),a.setAttribute("target","_blank"))}})}if(k<=publicationData.pageCount&&publicationData.downloads.page[k]){var j=COMMON_FOLDER+
"/../"+publicationData.downloads.page[k].url;a.subMenu.addSubMenuElement({content:{name:"download"==a.state?LOCALS.DOWNLOAD_CURRENT_RIGHT_PAGE:LOCALS.MORE_DOWNLOAD_CURRENT_RIGHT_PAGE,size:d(publicationData.downloads.page[k].size)},i:c++,rightElement:"size",leftElement:e,css:"fontImage downloadButton",type:"a",foo:function(a){PUBL?f(a,j):(a.setAttribute("href",j),a.setAttribute("target","_blank"))}})}}else if(!publicationData.page[pageMediator.page].stub){var m=COMMON_FOLDER+"/../"+publicationData.downloads.page[pageMediator.page].url;
a.subMenu.addSubMenuElement({content:{name:"download"==a.state?LOCALS.DOWNLOAD_CURRENT_PAGE:LOCALS.MORE_DOWNLOAD_CURRENT_PAGE,size:d(publicationData.downloads.page[pageMediator.page].size)},i:c++,rightElement:"size",leftElement:e,css:"fontImage downloadButton",type:"a",foo:function(a){PUBL?f(a,m):(a.setAttribute("href",m),a.setAttribute("target","_blank"))}})}}},shareList:function(a,b){var c=!PUBL?window.location.href:PUBLDOMAIN+window.location.hash;PUBL||(c=c.replace(RegExp("^(.*)(/"+FILES_FOLDER+
"?).*(#.*)","i"),"$1$3"));b||(c=/(.*)#.*/.exec(c)[1]);var c=encodeURIComponent(c),e=encodeURIComponent(publicationData.name),d={"0":{name:LOCALS.EMAIL,fontImage:"mailShare",url:"mailto:?subject="+e+"&body="+c},1:{name:LOCALS.TWITTER,fontImage:"twitterShare",url:"https://twitter.com/home?status="+e+" "+c},2:{name:LOCALS.FACEBOOK,fontImage:"facebookShare",url:"https://m.facebook.com/sharer.php?u="+c,disable:workspace.isLocal},3:{name:LOCALS.TUMBLR,fontImage:"tumblrShare",url:"http://www.tumblr.com/share/link?url="+
c+"&name="+e+"&description="},4:{name:LOCALS.LINKEDIN,fontImage:"linkedinShare",url:"http://www.linkedin.com/shareArticle?mini=true&url="+c+"&title="+e+"&summary="+e+"&source="+c},5:{name:LOCALS.BLOGGER,fontImage:"bloggerShare",url:"http://www.blogger.com/blog_this.pyra?u="+c+"&t="+e+"&n=publication"}},c=1;a.changeLabel("share");a.subMenu=new a.SubMenu({parent:a,scroll:!0});for(var f in d)d[f].disable||a.subMenu.addSubMenuElement({content:{name:d[f].name},i:c++,leftElement:"image",type:"a",foo:function(a){a.setAttribute("href",
d[f].url);a.setAttribute("target","_blank");workspace.addCssClass(a.lastChild,"fontImage shareImage "+d[f].fontImage)}})},share:function(a){var b=1;a.submenuNumber=0;a.subMenu=new a.SubMenu({parent:a,scroll:!0});var c=this;a.subMenu.addSubMenuElement({content:{name:LOCALS.SHARE_PUBLICATION},i:b++,rightElement:"arrowR",leftElement:"image",css:"fontImage shareButton",foo:function(){c.shareList.call(c,a,!1);a.shiftSubmenus("forvard")}});a.subMenu.addSubMenuElement({content:{name:LOCALS.SHARE_CURRENT_PAGE},
i:b++,rightElement:"arrowR",leftElement:"image",css:"fontImage shareButton",foo:function(){c.shareList.call(c,a,!0);a.shiftSubmenus("forvard")}})},more:function(a){var b=10;publicationData.visibility.downloads?this.download(a,!0):(a.submenuNumber=0,a.subMenu=new a.SubMenu({parent:a,scroll:!0}));if(publicationData.visibility.share){var c=this;a.subMenu.addSubMenuElement({content:{name:LOCALS.MORE_SHARE_PUBLICATION},i:b++,rightElement:"arrowR",leftElement:"image",css:"fontImage shareButton",foo:function(){c.shareList.call(c,
a,!1);a.shiftSubmenus("forvard")}});a.subMenu.addSubMenuElement({content:{name:LOCALS.MORE_SHARE_CURRENT_PAGE},i:b++,rightElement:"arrowR",leftElement:"image",css:"fontImage shareButton",foo:function(){c.shareList.call(c,a,!0);a.shiftSubmenus("forvard")}})}publicationData.visibility.slideshow&&a.subMenu.addSubMenuElement({content:{name:"object"!=typeof workspace.buttons.list.slideShowButton?LOCALS.SHOW_SLIDESHOW_BUTTON:LOCALS.HIDE_SLIDESHOW_BUTTON},i:b++,leftElement:"image",css:"fontImage slideShowButton",
foo:function(){a.hide();"object"!=typeof workspace.buttons.list.slideShowButton?workspace.slideShow.addSlideShowButton():workspace.slideShow.delSlideShowButton()}})}};function SearchResult(a,b,c,e,d,f){this.id=pageTable.getCaption(a);search.pages[a]=!0;this.realID=a;this.text=b;this.relevant=c;this.startPos=e;this.stopPos=d;this.fullText=f}
var search={active:!1,result:[],pages:{},query:"",maxTextResultLength:90,getBold:function(a,b){for(var c=a.toLowerCase(),b=b.toLowerCase(),e=b.length,d=-1;0<=(d=c.indexOf(b,d+1));)a=a.substr(0,d)+"<b>"+a.substr(d,e)+"</b>"+a.substr(1*d+e),d+=3;delete c;return a},buildSearchText:function(a,b,c){c=c||[];b-=this.maxTextResultLength/2;a=a.substr(0>b?0:b,1*this.maxTextResultLength+6);a="..."+a+"...";if(0<c.length)for(b=0;b<c.length;b++)a=search.getBold(a,c[b]);else a=search.getBold(a,search.query);return a},
buildIndexes:function(a,b,c){for(var e=[],d=0;d<b;d++){for(var f=[],g=a[d],l=-publicationData.search.lim;-1!=l;)l=c.indexOf(g,l+publicationData.search.lim),-1!=l&&f.push(l);0<f.length&&e.push(f)}return e},searchFullCoincidence:function(a,b,c,e){for(var d=-1,f=-1,g=b.toLowerCase();0<=(d=g.indexOf(a,d+1));)if(f=d,!(0<d&&d<g.length-1&&(!strUtils.isSplitter(g.charAt(d-1))||!strUtils.isSplitter(g.charAt(d+a.length)))))return this.result.push(new SearchResult(c,this.buildSearchText(b,d),e?0:1,d,d+a.length,
e)),!0;if(0<=f&&!publicationData.search.exactMatch)return this.result.push(new SearchResult(c,this.buildSearchText(b,f),e?2:3,f,f+a.length,e)),!0;delete null;return!1},searchPartiallyCoincidence:function(a,b,c,e){var d=b.toLowerCase(),d=this.buildIndexes(a,e,d);if(null==d||0==d.length)return!1;for(var f=0,g=Array(d.length),l=0;l<d.length;l++)g[l]=d[l][0];for(l=0;l<d.length-1;l++){var k=1E3,h=d[l],j=d[l+1];if(null==h||null==j)break;for(var m=h.length,o=j.length,n=0;n<m;n++)for(var p=0;p<o;p++){var q=
h[n],s=j[p],r=(s>q?s-q:q-s)*(s>q?1:2);r<k&&(g[l]=q,g[l+1]=s,k=r)}f+=k}l=1E4;for(h=k=0;null!=g&&h<g.length;h++)l=Math.min(l,g[h]),k=Math.max(k,g[h]);f+=1E3*(e-d.length);delete null;this.result.push(new SearchResult(c,this.buildSearchText(b,l,a),f+4,l,k,!1))},search:function(a,b){this.active&&search.stop();this.result=[];this.query=a=a.toLowerCase();var c=strUtils.split(a,publicationData.search.lim);queryArrayLength=c.length;for(page in b.page)page=b.page[page],null==page["#text"]||search.searchFullCoincidence(a,
page["#text"],page["@ID"],!0)||publicationData.search.exactMatch||(1<queryArrayLength?this.searchPartiallyCoincidence(c,page["#text"],page["@ID"],queryArrayLength,a.length):1===queryArrayLength&&this.searchFullCoincidence(c[0],page["#text"],page["@ID"],!1));this.result.sort(this.sortFunc);search.active=!0;c={name:"searchTest",children:{}};for(i in search.result){var e=search.result[i];c.children[i]={};c.children[i].name=e.text;c.children[i].page=e.id;c.children[i].realID=e.realID}customEvents.fireEvent(SHOW_SEARCH_RESULTS,
{data:c})},sortFunc:function(a,b){return a.relevant<b.relevant?-1:a.relevant>b.relevant?1:a.id<b.id?-1:a.id>b.id?1:0},clear:function(){this.query=""},stop:function(){this.active=!1;this.query="";search.result=[]}},strUtils={SPLITTERS:[",",";","."," ","?","!","'",'"',"",String.fromCharCode(10),String.fromCharCode(13),String.fromCharCode(8211),String.fromCharCode(8212),String.fromCharCode(8722),String.fromCharCode(8209),String.fromCharCode(8208)],split:function(a,b){for(var c=a.split(" "),e=[],d=0;d<
c.length;d++)c[d].length>=b&&e.push(c[d]);return e},isSplitter:function(a){for(var b=0;b<this.SPLITTERS.length;b++)if(a==this.SPLITTERS[b])return!0;return!1},getNum:function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b},hexToRGB:function(a){function b(a){return"#"==a.charAt(0)?a.substring(1,7):a}var c=parseInt(b(a).substring(0,2),16),e=parseInt(b(a).substring(2,4),16),a=parseInt(b(a).substring(4,6),16);return c+","+e+","+a},findArr:function(a,b){for(i in a)if(1*a[i]===
1*b)return i},getMaxZoom:function(a,b){return Math.sqrt(52E5/(a*b))}},DEFAULT_FLIP_DURATION=0.5,MAX_FLIPPERS=3;
function SimpleBook(a){var b=new ChildrenDepthManager,c=publicationData.rtlMode,e=function(a,b){var d=b.contentCanvas,f=b.topCanvas,c=getPageContentRect(a,l,k);publicationData.getPageProperty(a,"wide");var g=d.getContext("2d");sizeCanvas(d,l,k);sizeCanvas(f,l,k);fillCanvas(d,publicationData.getPageProperty(a,"BGColor"));publicationData.getPageProperty(a,"stub")||(showPreloader(),window.loadManager.addPageToQueue(a.toString(),{quality:!1,onImageStartLoading:void 0,onImageLoadComplete:function(a){g.drawImage(a,
c.x,c.y,c.width,c.height)},onAllIsComplete:function(d,g){applyRectToCanvas(f,c);highlight.show(a,f);new LinksLayer(f,a);if(g){var e=parseVectorizedContentToDiv(g,b.vectorDiv,!1);scaleAndPositionPageContent(a,e,c)}hidePreloader()}}))},d=0,f,g=createDiv("simpleBook"+a.id);this.sendDrag=function(a){flipPage(a)};this.setHighlight=function(a){var b=m.getContentObject();a?highlight.show(d,b.topCanvas):highlight.hide(d,b.topCanvas)};a.style.borderWidth="1px";a.style.borderColor="rgba(0,0,0,0.45)";this.set=
function(b){a.style.overflow="hidden";a.style.borderStyle="solid";a.appendChild(g);d=b;j();g.style.webkitTransformStyle="preserve-3d"};this.clear=function(){a.style.borderStyle=null;a.removeChild(g)};var l=400,k=500,h=[];this.isReady=function(){return!0};var j=function(){function j(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:d})}function p(a){o==a&&(o=null);a.getFadeout()||(a=a.getNextFlipper());b.depthsHide(a);a.clearContent()}for(;g.firstChild;)g.removeChild(g.firstChild);f=window.getBookRectangle(!1);
l=a.w||f.width;k=a.h||f.height;sizeDiv(a,l,k);void 0==a.w&&setElementPosition(a,f);for(var q=MAX_FLIPPERS-1;0<=q;q--){var s=new SoftPlainFlipElements(a.id+q,g,l,k,p,c,j);h[q]=s}q=h[0];m&&b.depthsHide(m);b.depthsSetTop(q);e(d,q.getContentObject());m=q},m;this.resize=function(){d&&j()};this.setPosition=function(a){d!==a&&(d=a,j())};var o;this.goToPage=function(a,f){if(a!=d){var c=a>d,f=f||DEFAULT_FLIP_DURATION;d=a;for(var g=null,l=MAX_FLIPPERS-1;0<=l;l--){var k=h[l];if(k.isFree()&&!b.depthsContainsMe(k)){g=
k;break}}cnt=0;o&&o.getFadeout()!=c?e(d,m.getContentObject()):g?(c?(e(d,g.getContentObject()),b.depthsAddToBottom(g),g.reset(),m.startAnimation(f*_slow,!0,!0,null),o=m):(e(d,g.getContentObject()),b.depthsAddToTop(g,!0),g.startAnimation(f*_slow,!1,!0,m),o=g),m=g):e(d,m.getContentObject())}}}
function SimpleDoubleBook(a,b){var c=function(){},e=0,d,f=createDiv("simpleBook"+b.id),g,l;this.set=function(a){b.style.overflow="hidden";b.appendChild(f);e=a;j();f.style.webkitTransformStyle="preserve-3d"};this.clear=function(){b.removeChild(f)};var k=400,h=500;this.isReady=function(){return!0};var j=function(){function a(){}for(;f.firstChild;)f.removeChild(f.firstChild);d=getBookRectangle(!0);k=d.width/2;h=d.height;sizeDiv(b,d.width,h);setElementPosition(b,d);var j={from:{flipDiv:k,contentObject:0,
backgroundDiv:k,nextShadow:2*k},to:{flipDiv:0,contentObject:k,backgroundDiv:0,nextShadow:k}};g=new SoftPlainFlipElements(b.id+"l",f,k,h,a,{from:{flipDiv:-k,contentObject:0,backgroundDiv:-k,nextShadow:-2*k},to:{flipDiv:0,contentObject:-k,backgroundDiv:0,nextShadow:-k}});l=new SoftPlainFlipElements(b.id+"r",f,k,h,a,j);l.setDepth(g.getDepth()+10,!0);c(e,g.getContentObject());c(e+1,l.getContentObject())};this.resize=function(){e&&j()};this.setPosition=function(a){e!==a&&(e=a,j())};this.goToPage=function(a,
b){a!=e&&(b=b||DEFAULT_FLIP_DURATION,e=a,l.getBGCanvas(),l.reset(),l.startAnimation(b*_slow,!0,!0,null))}}
function ChildrenDepthManager(){this.children=[];this.depthsAddToTop=function(a,b){a.setDepth(this.children[0].getDepth()+Z_STEP,b);this.children.splice(0,0,a)};this.depthsAddToBottom=function(a){a.setDepth(this.children[this.children.length-1].getDepth()-Z_STEP);this.children.push(a)};this.depthsSetTop=function(a){this.children=[a];a.setDepth(FIRST_Z)};this.depthsContainsMe=function(a){return-1!=this.children.indexOf(a)};this.depthsHide=function(a){this.children.splice(this.children.indexOf(a),1);
a.setDepth(LAST_Z)}}
function SimpleSwitcher(a){function b(a,b,c){1<a?d(b,c):f(b,c)}function c(b,d,f){1<b&&!j?(q(),a.draggerResetState()):p.sendPinch&&p.sendPinch(b,d,f)&&!publicationData.presentationMode&&(s(),a.draggerResetState())}function e(){CONTINIOUS_ZOOM||customEvents.fireEvent(ZOOM_LEVEL_CHANGED_FOR_WORKSPACE,{isSmallest:l(),isLargest:g()})}function d(a,b){j?n.getIsLargest()||(n.incZoom(a,b),e()):q(e())}function f(a,b){j&&(n.getIsSmallest()?s():n.decZoom(a,b),e())}function g(){return j?n.getIsLargest():!1}function l(){return publicationData.presentationMode?
n.getIsSmallest():!j}a.style.position="absolute";var k,h;window.addEventListener("resize",function(){fconsole.log(k,h,window.innerWidth,window.innerHeight);if(void 0==k)k=window.innerWidth,h=window.innerHeight;p.resize()});this.setPosition=function(b){m=b;p?p.setPosition(b,a):(p=(b=publicationData.presentationMode)?n:o,j=b,p.set(m),k=window.innerWidth,h=window.innerHeight)};this.goToPage=function(a,b){p.goToPage(a,b);m=a};var j=!1,m=0,o=new SimpleBook(a),n=new SimpleZoomer(a,e),p;fconsole.log(publicationData.type);
this.toggleZoom=function(){j?s():q();e()};var q=function(a){o.clear();n.set(m,a);p=n;j=!0;fconsole.update("zoom",j);customEvents.fireEvent(ZOOM_ANIMATION_END)};this.zoomIn=q;var s=function(){n.clear();o.set(m);p=o;j=!1;fconsole.update("zoom",j)};this.zoomOut=s;this.sendMove=function(a,b){p.sendMove&&p.sendMove(a,b)};this.sendDrag=function(a){p.sendDrag&&p.sendDrag(a)};this.sendPinch=CONTINIOUS_ZOOM?c:b;this.incZoom=d;this.decZoom=f;this.getIsLargest=g;this.getIsSmallest=l;this.setHighlight=function(a){p.setHighlight&&
p.setHighlight(a)};this.startPinch=function(){j&&n.startPinch.apply(n,arguments)};this.handleDoubleClick=function(){publicationData.presentationMode?n.toggleScale():this.toggleZoom()}}var _slow=1;function initSimpleUtils(){CONTINIOUS_ZOOM=(DEV_3D=Modernizr.csstransforms3d)&&3==window.system.device.version;DOUBLE_CLICK_TO_ZOOM=!0;UP_SCALE=3;fconsole.log("3D:",DEV_3D);fconsole.log("CONTINIOUS:",CONTINIOUS_ZOOM)}
var DEBUG_SHOW_FOLD_SHADOW=!1,TUNE_FOLD_SCALE_ENABLE=!0,TUNE_MINIMUM_FOLD_SCALE=0.25,TUNE_FOLD_SHADOW_ALPHA=!0,TUNE_FOLD_SHADOW_KOEFF=0.35,TIMEOUT_TO_DO_PRETRANSFORM=60*_slow,TIMEOUT_TO_SET_TRANSITION=60*_slow,TIMEOUT_TO_DO_POSTTRANSFORM=60*_slow,TIMEOUT_AFTER_ALL=60*_slow,TUNE_ZINDEX_SINGLE_CANVAS=-100,Z_INDEX_ADD=350,LAST_Z=-300,Z_STEP=5,FIRST_Z=-100,_debugNC=!1,getBookLength=function(){return publicationData.pageCount};
function SoftPlainFlipElements(a,b,c,e,d,f,g){function l(b,d){w+=1;var f=function(){this.style.webkitTransitionProperty="";this.style.webkitTransitionDuration="";this.removeEventListener("webkitTransitionEnd",f,!1);var b=this;setTimeout(function(){d&&d(b);_debugNC&&console.log(a+times()+"timeout",w,b.id);(w-=1)||setTimeout(function(){g&&g(n);u=!1},TIMEOUT_AFTER_ALL)},TIMEOUT_TO_DO_POSTTRANSFORM)};b.addEventListener("webkitTransitionEnd",f,!1)}function k(){startTime=(new Date).getTime();_debugNC&&
console.log(a+times()+"applyDestinationListen",w);l(C,function(){d&&d(n)});j(C,B.flipDiv);l(D);j(D,B.contentObject,z+2);l(y);j(y,B.backgroundDiv,z+4);if(x)l(x,function(){}),j(x,B.nextShadow),x.style.opacity="0";A&&p&&(h(A,"end"),l(A,function(){h(A,"start")}))}function h(a,b){var d="start"==b,g=d?TUNE_MINIMUM_FOLD_SCALE:1,e=f?0:c-t,l=dev_translate((d?t*g:0)*(f?-1:1),0,8),g=TUNE_FOLD_SCALE_ENABLE?dev_scale(g<TUNE_MINIMUM_FOLD_SCALE?TUNE_MINIMUM_FOLD_SCALE:g):"";if(TUNE_FOLD_SHADOW_ALPHA)a.style.opacity=
d?"0":"1";a.style.left=e+"px";a.style.webkitTransformOrigin=""+(f?0:t)+"px 0px";a.style.webkitTransform=g+" "+l}function j(a,b,d){var f=void 0==d?a.zOffset||0:d;if(void 0!=d)a.zOffset=d;a.xOffset=b;translate(a,b,f)}function m(a,b){a.zOffset=b;translate(a,a.xOffset||0,b)}function o(){var a={};f?p?(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=-c,a.nextShadow=-s):(a.flipDiv=0,a.contentObject=c,a.backgroundDiv=-c,a.nextShadow=-c):p&&q?(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=c,a.nextShadow=c):
q?(a.flipDiv=0,a.contentObject=-c,a.backgroundDiv=c,a.nextShadow=c):(a.flipDiv=-c,a.contentObject=0,a.backgroundDiv=-c,a.nextShadow=-2*c);return a}this.id=a;var n=this,p=!0,q=!0,s=0.6*c,r=o(),B,v,u,w=0,z=LAST_Z--,t=c*TUNE_FOLD_SHADOW_KOEFF,C=createDiv("flipd"+a,!0);C.style.webkitTransformStyle="flat";b.appendChild(C);sizeDiv(C,c,e);m(C,z);var D=createDiv("div"+a);sizeDiv(D,c,e);var F=createCanvas("cc"+a,c,e);D.appendChild(F);D.contentCanvas=F;F=createDiv("vd"+a,c,e);D.appendChild(F);D.vectorDiv=F;
F=createCanvas("tc"+a,c,e);D.appendChild(F);D.topCanvas=F;C.appendChild(D);j(D,r.contentObject,z+2);var y=createBackgroundDiv("backd"+a);sizeDiv(y,c,e);C.appendChild(y);j(y,r.backgroundDiv,z+4);var x=createShadowOnNextDiv("nextsh"+a,f);x&&(b.appendChild(x),sizeDiv(x,s,e),j(x,r.nextShadow,z));var A=createFoldShadow("foldsh"+a,t,e,f);A&&(C.appendChild(A),h(A,"start"));this.flipDiv=C;this.backgroundDiv=y;var E=function(b,d,f){_debugNC&&console.log(a+"prepare",b.id,w);b.style.webkitTransitionProperty=
"-webkit-transform "+(f||"");b.style.webkitTransitionTimingFunction="cubic-bezier(0.9,0.05,0.95,1)";b.style.webkitTransitionDuration=""+d*_slow+"s"};this.id=a;var G=function(){r=o();var a={};if(f)if(p&&q)a.flipDiv=c,a.contentObject=-c,a.backgroundDiv=0,a.nextShadow=c-s;else{if(q)a.flipDiv=0,a.contentObject=0,a.backgroundDiv=-c,a.nextShadow=-c}else p&&q?(a.flipDiv=-c,a.contentObject=c,a.backgroundDiv=0,a.nextShadow=0):q?(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=c+1,a.nextShadow=c):(a.flipDiv=
0,a.contentObject=-c,a.backgroundDiv=0,a.nextShadow=-c);B=a;j(C,r.flipDiv,z);j(D,r.contentObject,z+2);j(y,r.backgroundDiv,z+4);A&&h(A,"start");if(x)j(x,r.nextShadow,z),x.style.opacity="1"},H=function(a){E(C,a);E(D,a);E(y,a);x&&E(x,a,"opacity");A&&p&&E(A,a,TUNE_FOLD_SHADOW_ALPHA?"opacity":"")};this.startAnimation=function(a,b,d,f){u=!0;v=f;p=b;q=d;G();setTimeout(function(){H(a);setTimeout(function(){k()},TIMEOUT_TO_SET_TRANSITION)},TIMEOUT_TO_DO_PRETRANSFORM)};this.reset=function(){p=!0;G()};this.getContentObject=
function(){return D};this.getFlipDiv=function(){return C};this.getNextFlipper=function(){return v};this.getFadeout=function(){return p};this.getDepth=function(){return z};this.getBGDiv=function(){return y};this.setNextFlipper=function(a){v=a};this.setDepth=function(a,b){z=a;C.style.zIndex=Z_INDEX_ADD+a;D.style.zIndex=Z_INDEX_ADD+a+1;y.style.zIndex=Z_INDEX_ADD+a+3;if(x)x.style.zIndex=Z_INDEX_ADD+a;if(A)A.style.zIndex=Z_INDEX_ADD+a+4;!0!=b&&(m(C,z),m(D,z+2),m(y,z+4),x&&j(x,r.nextShadow,z))};this.isFree=
function(){return!u};this.clearContent=function(){D.contentCanvas.width=c;D.topCanvas.width=0;deleteAllChildren(D.vectorDiv)};var I;this.setBackgroundContent=function(a){I=a;deleteAllChildren(y);y.appendChild(I)};this.getBGCanvas=function(){I||(I=createFECanvas(a+"bgCont",c,e),y.appendChild(I));return I}}function createFECanvas(a,b,c){a=createCanvas(a);if(a.width!=b||a.height!=c)a.width=b,a.height=c;return a}
var createBackgroundDiv=function(a){a=createDiv(a);a.style.backgroundColor="#dddddf";return a},createShadowOnNextDiv=function(a,b){var c=createDiv(a);c.style.backgroundImage="-webkit-gradient(linear,"+(b?"right bottom,left bottom":"left bottom,right bottom")+", color-stop(1.00, rgba(0,0,0,0)),color-stop(0.00, rgba(0,0,0,0.6)) )";return c},createFoldShadow=function(a,b,c,e){a=createCanvas(a);a.width=b;a.height=c;var d=a.getContext("2d"),e=e?d.createLinearGradient(b,0,0,0):d.createLinearGradient(0,
0,b,0);e.addColorStop(0,"rgba(0, 0, 0, 0)");e.addColorStop(0.72,"rgba(0, 0, 0, 0.2)");e.addColorStop(0.89,"rgba(0, 0, 0, 0.4)");e.addColorStop(1,"rgba(0, 0, 0, 0)");DEBUG_SHOW_FOLD_SHADOW?(d.lineWidth=16,d.strokeStyle="red",d.strokeRect(16,16,b-32,c-32)):(d.fillStyle=e,d.fillRect(0,0,b,c));return a},times=function(){return" "+((new Date).getTime()-startTime)+" "},sizeDim="px";
function sizeDiv(a,b,c){if(void 0==b&&void 0==c)b=window.innerWidth,c=window.innerHeight;a.style.width=Math.ceil(b)+sizeDim;a.style.height=Math.ceil(c)+sizeDim}function createDiv(a,b){var c=document.createElement("div");c.setAttribute("id",a);c.style.position="absolute";if(b)c.style.overflow="hidden";return c}function createCanvas(a,b,c){var e=document.createElement("canvas");e.setAttribute("id",a);e.style.position="absolute";void 0!=b&&void 0!=c&&sizeCanvas(e,b,c);return e}
function sizeCanvas(a,b,c){a.width=b;a.height=c}function setElementPosition(a,b){a.style.left=(""+b.left).concat("px");a.style.top=(""+b.top).concat("px")}function translate(a,b,c){a.style.webkitTransform="translate3d("+b+sizeDim+",0px,"+(""+c)+sizeDim+")"}function dev_scale(a,b,c){return prepare_xyz("scale",a,b,c)}function dev_translate(a,b,c){return prepare_xyz("translate",a,b,c)}function dev_rotateXY(a){return"rotate"+(DEV_3D?"":"")+"("+a.toString()+"deg)"}
function prepare_xyz(a,b,c,e){var d="scale"==a,f=d?1:0,d=d?"":sizeDim;void 0==b&&(b=f);void 0==c&&(c=f);void 0==e&&(e=f);return a+(DEV_3D?"3d("+b+d+","+c+d+","+e+d+")":"("+b+d+","+c+d+")")}var startTime;function centerRect(a,b,c,e){return{x:(a-c)/2,y:(b-e)/2}}function traceChildren(a){for(var b="",c=0;c<a.length;c++)b+=a[c].id+" ";console.log(b)}function deleteAllChildren(a){for(;a.firstChild;)a.removeChild(a.firstChild)}
function parseVectorizedContentToDiv(a,b,c){for(var b=b||createDiv(),e=0;e<a.length;e++){var d=a[e],f=0,g=d[f++].toString(),l=d[f++].toString(),k=parseFloat(d[f++]);parseFloat(d[f++]);var h=parseFloat(d[f++]),j=parseFloat(d[f++]),m=parseFloat(d[f++]),o=d[f++].toString(),d=parseFloat(d[f++]),n=f=document.createElement("p");n.style.position="absolute";f.innerText=g;f.style.fontFamily=l;n.style.top=px(UP_SCALE*h);n.style.left=px(UP_SCALE*j);f.style.fontSize=px(m*UP_SCALE);f.style.color=o;b.appendChild(n);
if(c)for(;f.offsetWidth>k&&1<m;)m-=1,f.style.fontSize=px(m);f.style.webkitTransform=d?dev_rotateXY(d):"";f.style.webkitTransformOrigin=d?"0 0":""}return b}function px(a){return a.toString()+"px"}
function scaleAndPositionPageContent(a,b,c){var e=UP_SCALE*parseFloat(publicationData.getPageProperty(a,"width")),d=UP_SCALE*parseFloat(publicationData.getPageProperty(a,"height"));sizeDiv(b,e,d);if(void 0!=c)b.style.left=px(c.x),b.style.top=px(c.y),c=c.width/e,b.style.webkitTransform=dev_scale(c,c),b.style.webkitTransformOrigin="0 0",fconsole.log("page ",a," scale is ",c," srcWidth ",e)}
function getPageContentRect(a,b,c){var e=parseFloat(publicationData.getPageProperty(a,"proportions")),a={};a.width=Math.min(e*c,b);a.height=a.width/e;b=centerRect(b,c,a.width,a.height);a.x=b.x;a.y=b.y;return a}function applyRectToCanvas(a,b){a.width=b.width;a.height=b.height;a.style.left=px(b.x);a.style.top=px(b.y)}function fillCanvas(a,b,c){var e=a.getContext("2d");e.fillStyle=void 0!=b?b:"red";c?e.fillRect(c.x,c.y,c.width,c.height):e.fillRect(0,0,a.width,a.height)}
function showPreloader(){if(!window.preloaderIsShown)window.preloaderIsShown=!0,workspace.preloader.add()}function hidePreloader(){if(window.preloaderIsShown)workspace.preloader.del(),window.preloaderIsShown=!1}function flipPage(a){a?pageMediator.right():pageMediator.left()}function getIsPortrait(){return innerHeight>innerWidth}function getIsAlbum(){return publicationData.type==ALBUM}var RESOLUTION_BOUND=1677721.6,ZOOMOUT_SIZE_KOEFF=0.9;
function SimpleZoomBook(a,b){function c(){var a;getIsAlbum()?(a=getPageContentRect(m,innerWidth,innerHeight),h.fbScale=a.width/d,h.fbX=a.x,h.fbY=a.y):(h.fbX=getIsPortrait()?0:(innerWidth-d*h.fbScale)/2,h.fbY=0);e()}function e(){fconsole.log("trans",h.fbX);if(h.fbScale){var a=0.93<h.fbScale&&1.07>h.fbScale?1:h.fbScale;fconsole.update("rscale",a);var a=dev_scale(a,a),b=dev_translate((h.fbX/h.fbScale).toFixed(0),(h.fbY/h.fbScale).toFixed(0),0);h.style.webkitTransform=a+" "+b}else fconsole.log("fbScale warning")}
var d,f,g=function(b){CANVAS_GRID?h.clear():h.width=0;deleteAllChildren(h.vectorContent);publicationData.getPageProperty(b,"stub")?(sizeDiv(l),l.style.backgroundColor=publicationData.getPageProperty(b,"BGColor"),l.parentElement||a.appendChild(l),o=!1):(showPreloader(),l.parentElement&&l.parentElement.removeChild(l),window.loadManager.addPageToQueue(b.toString(),{quality:!0,onlyRaster:ONLY_RASTER,onImageLoadComplete:function(a){d=a.width;f=a.height;h.currentImageResolution=d*f;o||customEvents.fireEvent(BOOK_FLIPPING_END,
{page:m});o&&(o=!1);c();if(CANVAS_GRID)h.checkToSwitchGrid(),h.drawLoadedImage(a);else{var b=j.getContext("2d");sizeCanvas(j,d,f);b.drawImage(a,0,0,a.width,a.height,0,0,d,f)}},onAllIsComplete:function(a,c){sizeCanvas(k,d,f);highlight.show(b,k);new LinksLayer(k,b);if(c){var g=parseVectorizedContentToDiv(c);sizeDiv(h.vectorContent,a.width,a.height);scaleAndPositionPageContent(b,g,{x:0,y:0,width:a.width});h.vectorContent.appendChild(g)}hidePreloader()}}))};this.setHighlight=function(a){a?highlight.show(m,
k):highlight.hide(m,k)};var l=createDiv(),k=createCanvas("szTopping"),h=createDiv("vsZoomContent",!1);h.vectorContent=createDiv("vsZoomVector",!0);h.vectorContent.style.webkitTransform=dev_translate(0,0,1E3);var j;CANVAS_GRID?appendCanvasGrid(h):(j=createCanvas("zoomCanvRaster"),h.appendChild(j));h.appendChild(h.vectorContent);h.appendChild(k);var m=0;this.set=function(b){a.appendChild(h);a.style.overflow="";setElementPosition(a,{left:0,top:0});sizeDiv(a,innerWidth,innerHeight);m=b;o=!0;h.fbScale=
1;CANVAS_GRID?h.clear():h.width=0;g(m)};this.clear=function(){a.removeChild(h)};h.style.webkitTransformOrigin="0px 0px";var o;this.sendMove=function(a,b){void 0==h.fbX?fconsole.log("fbX except zoom"):(h.fbX+=a,h.fbY+=b,e())};this.sendPinch=function(a,c,g){void 0==c&&(c=innerWidth/2*(1-a),g=innerHeight/2*(1-a));var l=h.fbScale*a;1>a&&d*l<innerWidth*ZOOMOUT_SIZE_KOEFF&&f*l<innerHeight*ZOOMOUT_SIZE_KOEFF?b():(g-=h.fbY*(1-a),h.fbX+=c-h.fbX*(1-a),h.fbY+=g,h.fbScale=l,CANVAS_GRID&&h.checkToSwitchGrid(),
e())};this.resize=function(){sizeDiv(a,innerWidth,innerHeight);c()};var n=function(a){m!==a&&(m=a,g(m))};this.setPosition=n;this.goToPage=function(a){n(a)}}
function appendCanvasGrid(a){function b(a){for(var b=0;b<c;b++)for(var d=0;d<e;d++)a(b,d)}var c=4,e=4;a.canvases=[];a.setSingle=function(d){var c=function(d){b(function(b,f){a.canvases[b][f].style.display=d})};fconsole.update("grid",!d);d?c("none"):c("block");a.singleMode=d};a.singleMode=!0;a.drawLoadedImage=function(d){var g=d.width,l=d.height,k=a.canvases,h=Math.ceil(g/e),j=Math.ceil(l/c),m=Math.ceil(d.width/e),o=Math.ceil(d.height/c),n=g/d.width,p=a.singleCanvas;p.width=g/2;p.height=l/2;p.getContext("2d").drawImage(d,
0,0,d.width,d.height,0,0,g/2,l/2);var p=function(a,b){var c=k[a][b];c.width=h;c.height=j;var c=c.getContext("2d"),g=d.width-b*m>m?m:d.width-b*m,e=d.height-a*o>o?o:d.height-a*o;c.drawImage(d,b*m,a*o,g,e,0,0,g*n,e*n)},q=function(a,b){k[a][b].style.webkitTransform=dev_translate(b*h,a*j,0)};a.currentImageResolution>RESOLUTION_BOUND?(b(p),b(q)):(b(function(a,b){var d=k[a][b];d.style.webkitTransform=dev_translate(0,0,0);d.width=0;d.height=0}),p=k[c-1][e-1],p.width=g,p.height=l,p.getContext("2d").drawImage(d,
0,0))};var d=createCanvas("single");a.singleCanvas=d;d.style.webkitTransformOrigin="0px 0px";d.style.zIndex=TUNE_ZINDEX_SINGLE_CANVAS;d.style.webkitTransform=dev_scale(2,2,1)+" "+dev_translate(0,0,-10);a.appendChild(a.singleCanvas);b(function(b,d){var c=createCanvas("b_"+b+"_"+d),e=a.canvases;c.style.webkitTransform=dev_translate(0,0,0);a.appendChild(c);e[b]||(e[b]=[]);e[b][d]=c});a.checkToSwitchGrid=function(){if(a.currentImageResolution&&a.fbScale)if(a.currentImageResolution<RESOLUTION_BOUND)a.singleMode&&
a.setSingle(!1);else{var b=a.fbScale,b=a.currentImageResolution*b*b,d=getScreenSquare()*ZOOM_GRID_KOEFF;!a.singleMode&&b<=d?a.setSingle(!0):a.singleMode&&b>d&&a.setSingle(!1)}};a.setSingle(!0);a.clear=function(){b(function(b,d){a.canvases[b][d].width=0});a.singleCanvas.width=0};a.fillWhite=function(b,d){sizeDiv(a,b,d);a.style.backgroundColor="white"};a.clearBG=function(){a.style.backgroundColor=null}}function checkHorizontalMiddle(a,b){b.width<window.innerWidth||checkHorizontalMovement(a,b)}
function SimpleZoomer(a,b){function c(b){u=b;a.enableSmoothScrolling=j()<innerWidth*B;r&&E.checkToSwitchGrid(u,w.width*w.height);t.setLimiters()}function e(a){c(t.scaleMap[a])}function d(){var a=getPageContentRect(v,innerWidth,innerHeight).width/w.width,b=innerWidth/w.width,d=b/0.8,c,g,e,l;if((N||M)&&!(getBookRectangle().width>=w.width))g=M?[a]:[b],g[0]!=b&&g.push(b),e=Math.sqrt(d/b),g=g.concat([b*e,d]),c=N?2:0,l=7;else if(L||getBookRectangle().width>=w.width)g=[a],e=1.5,c=0,l=100;for(;Math.pow(g[g.length-
1]*e,2)*w.width*w.height<s&&g.length<l;)g[g.length]=g[g.length-1]*e;f(g,0.25,e);f(g,0.5,e);f(g,1,e);fconsole.log("map:",g.map(function(a){return a.toFixed(4)}).toString());t.scaleMap=g;t.defaultScalePos=c}function f(a,b,d){for(var f=Math.abs(a[0]-b),c=1,g=0;c<a.length;){var e=Math.abs(a[c]-b);e<f&&(f=e,g=c);c++}(b+f)/(b-f)<d&&0!=g&&(a[g]=b)}function g(){z={};z.x=(innerWidth/2-y)/j();z.y=(innerHeight/2-x)/m()}function l(){C?I.parentElement&&I.parentElement.removeChild(I):(r?E.clear():G.width=0,H.width=
0)}function k(b,d){C=publicationData.getPageProperty(v,"stub");Q=!1;C?(sizeDiv(I),I.style.backgroundColor=publicationData.getPageProperty(v,"BGColor"),I.parentElement||a.appendChild(I),b&&setTimeout(function(){b()},30)):(showPreloader(),setTimeout(function(){loadManager.addPageToQueue(v,{quality:!0,onImageLoadComplete:function(a){CONTINIOUS_ZOOM&&(r?E.drawLoadedImage(a,1):(sizeCanvas(G,a.width,a.height),G.getContext("2d").drawImage(a,0,0)));var b=!w||a.width!=w.width||a.height!=w.height;w=a;getBookRectangle();
void 0==t&&J.setup();t.onImageIsCome(b);d&&d()},onAllIsComplete:function(){hidePreloader();CONTINIOUS_ZOOM?(sizeCanvas(H,w.width/2,w.height/2),H.style.webkitTransform=dev_scale(2,2),new LinksLayer(H,v),highlight.show(v,H)):Q=!0;n();b&&b()}})},250))}function h(){var a=j(),b=m();CONTINIOUS_ZOOM?(fconsole.update("scale",u),a=dev_scale(u,u),b=dev_translate((y/u).toFixed(0),(x/u).toFixed(0),0),E.style.webkitTransform=a+" "+b):(r?E.drawLoadedImage(w,u):(sizeCanvas(G,a,b),G.getContext("2d").drawImage(w,
0,0,w.width,w.height,0,0,a,b)),sizeCanvas(H,a,b),Q&&(new LinksLayer(H,v),highlight.show(v,H)),A||sizeDiv(E,a,b));fconsole.update("scale",u)}function j(){return w.width*u}function m(){return w.height*u}function o(){var a=j()>innerWidth,b=m()>innerHeight;a?(y=0<y?0:y,y=j()+y<innerWidth?innerWidth-j():y):y=innerWidth/2-j()/2;b?(x=0<x?0:x,x=x+m()<innerHeight?innerHeight-m():x):x=innerHeight/2-m()/2}function n(a){CONTINIOUS_ZOOM?h():(a||h(),E.style.webkitTransform=dev_translate(Math.round(y),Math.round(x),
0))}function p(a,b){for(var d=0;d<a.length;d++){var f=a[d];if(0==d){if(b<=f||1==a.length)return 0}else{if(d==a.length-1)return a.length-1;if(b<a[d])return b<=(a[d-1]+a[d])/2?d-1:d;if(b<=(a[d]+a[d+1])/2)return d}}}function q(a){var b=p(t.scaleMap,u),b=b+(a?1:-1);if(0>b||b>t.scaleMap.length-1)throw Error("invalid scale change");e(b)}var s=414E4,r=CONTINIOUS_ZOOM,B=3,v,u,w,z,t,C,D,F,y=0,x=0,A=!1;fconsole.log("RESEARCH_CANVAS_ONLY",A);var E=A?createCanvas():createDiv("vsZoomContent",!1);E.style.webkitTransformOrigin=
"0px 0px";createDiv("vectorDiv");if(r)appendCanvasGrid(E);else if(A)var G=E;else G=createCanvas("cZoomCanvas"),E.appendChild(G);var H=createCanvas("cZoomTopCanvas");H.style.webkitTransformOrigin="0px 0px";A||E.appendChild(H);var I=createDiv(),L=publicationData.type==PT_PHOTOALBUM,M=publicationData.type==PT_DOCUMENT,N=!L&&!M,S=publicationData.presentationMode,K=function(){return this},P=function(){fconsole.log("state error")},T=function(){};K.prototype.incZoom=P;K.prototype.decZoom=P;K.prototype.setup=
P;K.prototype.sendMove=T;K.prototype.sendPinch=T;K.prototype.resize=function(){z=null;this.arrange(!0)};K.prototype.onImageIsCome=function(a){a&&this.arrange(!0)};var J=new K;J.sendMove=function(a,b){y+=a;x+=b;o();n(!0)};J.arrange=function(a,b){z?(b||(y=innerWidth/2-z.x*j()),x=innerHeight/2-z.y*m()):(b||(y=L?(innerWidth-j())/2:publicationData.rtlMode?innerWidth-j():0),x=L?(innerHeight-m())/2:0);o();a&&n()};J.setLimiters=function(){D=u==t.scaleMap[0];F=u==t.scaleMap[t.scaleMap.length-1];b()};J.setup=
function(a){t=J;if(a)throw Error("absolete");fconsole.log("custom",u)};var O;J.sendPinch=function(a,b,d){if(O)return!1;void 0==b&&(b=innerWidth/2*(1-a),d=innerHeight/2*(1-a));var f=u*a;1<=f&&1>u&&(O=!0,f=1);10.2<f&&(f=10.2,a=1,d=b=0);d-=x*(1-a);y+=b-y*(1-a);x+=d;o();if(S&&1>a&&f<=t.scaleMap[0])e(0);else if(N&&1>a&&f<=t.scaleMap[0]){if(R)return R=!1,!0;R=O=!0;e(0)}else c(f);n()};var R=!1;J.resize=function(){d();u<t.scaleMap[0]&&e(0);u>t.scaleMap[t.scaleMap.length-1]&&e(t.scaleMap.length-1);z=null;
this.arrange(!0)};J.onImageIsCome=function(a){a?(d(),e(t.defaultScalePos)):L&&e(t.defaultScalePos);z=null;this.arrange(!0,!a&&(N||M))};J.incZoom=function(){g();q(!0);o();this.arrange(!0)};J.decZoom=function(){g();q(!1);o();this.arrange(!0)};this.goToPage=function(a){a!=v&&(l(),v=a,k(function(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:v})}))};this.set=function(b,d){A?a.appendChild(G):a.appendChild(E);a.style.overflow="hidden";setElementPosition(a,{left:0,top:0});sizeDiv(a,innerWidth,innerHeight);
l();v=b;t=null;k(void 0,d)};this.clear=function(){l();w=null;a.removeChild(E)};var Q;this.startPinch=function(){O=!1};this.sendDrag=function(a){(j()<=innerWidth||C)&&flipPage(a)};this.sendMove=function(a,b){try{return t?t.sendMove(a,b):!1}catch(d){fconsole.log(t,d,t.sendMove)}};this.sendPinch=function(a,b,d){CONTINIOUS_ZOOM||console.log("pinch error");return t.sendPinch(a,b,d)};this.incZoom=function(a,b){t.incZoom(a,b)};this.decZoom=function(){t.decZoom()};this.getIsSmallest=function(){return D};
this.getIsLargest=function(){return F};this.resize=function(){sizeDiv(a,innerWidth,innerHeight);w?t.resize():fconsole.log("strange situation")};this.setHighlight=function(a){a?highlight.show(v,H):(H.width=0,highlight.hide(v,H))};this.toggleScale=function(){if(S){g();if(p(t.scaleMap,u)!=t.defaultScalePos)e(t.defaultScalePos);else{var a=Math.min(2,t.scaleMap.length-1);e(a)}t.arrange(!0)}}}
function appendCanvasGrid(a){function b(a){for(var b=0;b<c;b++)for(var d=0;d<e;d++)a(b,d)}var c=3,e=3;a.canvases=[];a.setSingle=function(d){var c=function(d){b(function(b,f){a.canvases[b][f].style.display=d})};fconsole.update("grid",!d);d?c("none"):c("block");a.singleMode=d};a.singleMode=!0;a.drawLoadedImage=function(d,g){var g=g||1,l=d.width*g,k=d.height*g,h=a.canvases,j=Math.ceil(l/e),m=Math.ceil(k/c),o=Math.ceil(d.width/e),n=Math.ceil(d.height/c),p=l/d.width,q=a.singleCanvas;q.width=l/2;q.height=
k/2;q.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,l/2,k/2);b(function(a,b){var c=h[a][b];c.width=j;c.height=m;var c=c.getContext("2d"),g=d.width-b*o>o?o:d.width-b*o,e=d.height-a*n>n?n:d.height-a*n;c.drawImage(d,b*o,a*n,g,e,0,0,g*p,e*p)});b(function(a,b){h[a][b].style.webkitTransform=dev_translate(b*j,a*m,0)})};var d=createCanvas("single");a.singleCanvas=d;d.style.webkitTransformOrigin="0px 0px";d.style.zIndex=TUNE_ZINDEX_SINGLE_CANVAS;d.style.webkitTransform=dev_scale(2,2,1)+" "+dev_translate(0,
0,-10);a.appendChild(a.singleCanvas);b(function(b,d){var c=createCanvas("b_"+b+"_"+d),e=a.canvases;c.style.webkitTransform=dev_translate(0,0,0);a.appendChild(c);e[b]||(e[b]=[]);e[b][d]=c});a.checkToSwitchGrid=function(b,d){var c=d*b*b,e=1.1*getScreenSquare();!a.singleMode&&c<=e?a.setSingle(!0):a.singleMode&&c>e&&a.setSingle(!1)};a.setSingle(!0);a.clear=function(){b(function(b,d){a.canvases[b][d].width=0});a.singleCanvas.width=0};a.fillWhite=function(b,d){sizeDiv(a,b,d);a.style.backgroundColor="white"};
a.clearBG=function(){a.style.backgroundColor=null}}function getScreenSquare(){return innerWidth*innerHeight}
var Slider=function(a,b,c,e){this.bar=el.id(a);this.p=el.id(b);this.pDelta=this.p.offsetWidth/2;this.pCorrection=0;this.barWidth=this.bar.offsetWidth;this.off=Math.round(7+this.p.offsetWidth/2);this.speed=220;this.stepAnimation=system.platform.android&&/^3|4$/.test(system.device.version)?!0:!1;this.needLastStep=!0;system.platform.android&&/^3|4$/.test(system.device.version)?(this.animationSpeed=400,workspace.addCssClass(this.p,"slow")):(this.animationSpeed=system.platform.ios?10:5,workspace.addCssClass(this.p,
"fast"));if(this.isPagerInsideSlider=c)this.sliderLabel=el.id(e);this.isDraggingNow=!1;this.localTouchCoordinateX=this.getNewCoordinateFromPageNumber(pageMediator.page);var d=this;setClickEvents(this.bar);with(this.bar.parentNode)Modernizr.touch?(addEventListener("touchstart",function(){d.handleTouchStart(event)},!1),addEventListener("touchmove",function(){d.handleTouchMove(event)},!1),addEventListener("touchend",function(){d.handleTouchEnd(event)},!1)):(addEventListener("mousedown",function(){d.handleTouchStart(event)},
!1),addEventListener("mouseup",function(){d.handleTouchEnd(event)},!1),addEventListener("mousemove",function(){d.handleTouchMove(event)},!1),addEventListener("mouseout",function(){d.handleTouchEnd(event)},!1),addEventListener("mouseleave",function(){d.handleTouchEnd(event)},!1));d.stepAnimation?pageMediator.addListener(function(a){d.doPagerTranslate(d.getNewCoordinateFromPageNumber(a))}):pageMediator.addListener(function(a){!d.needLastStep?d.needLastStep=!0:d.doPagerTranslate(d.getNewCoordinateFromPageNumber(a))});
this.handleResize()};
Slider.prototype.handleTouchStart=function(a){var a=a||window.event,b=this;this.isDraggingNow=!0;a="mousedown"!=a.type&&"mouseout"!=a.type?a.touches[0].pageX:a.pageX;this.clientX=Math.round(a);this.barWidth=this.bar.offsetWidth;this.pCorrection=this.localTouchCoordinateX;this.localTouchCoordinateX=this.clientX-this.bar.parentNode.offsetLeft;this.pCorrection-=this.localTouchCoordinateX;Math.abs(this.pCorrection)>this.pDelta?this.pCorrection=0:this.clientX+=this.pCorrection;this.changeDestinationByTimer.active=!0;
this.timeout=window.setTimeout(b.changeDestinationByTimer(),b.speed);window.setTimeout(function(){b.animationByInterval.call(b)},0);b.interval=window.setInterval(function(){b.animationByInterval.call(b)},b.animationSpeed);delete null};Slider.prototype.handleTouchMove=function(a){if(!this.isDraggingNow)return!1;a=a||window.event;this.clientX=a="touchmove"==a.type?a.touches[0].pageX:a.pageX;0<Math.abs(this.pCorrection)&&(this.clientX+=this.pCorrection);delete null;delete null};
Slider.prototype.animationByInterval=function(){this.localTouchCoordinateX=this.clientX-this.bar.parentNode.offsetLeft;var a=Math.round(this.p.offsetWidth/2+7);if(this.localTouchCoordinateX<a)this.localTouchCoordinateX=a;else if(this.localTouchCoordinateX>=this.barWidth-a)this.localTouchCoordinateX=this.barWidth-1-a;if(this.stepAnimation){a=this.getDestinationPageNumber();if(a==this.prevDestinationPage)return!1;this.doPagerTranslate(this.getNewCoordinateFromPageNumber(a));this.prevDestinationPage=
a}else this.doPagerTranslate(this.localTouchCoordinateX)};Slider.prototype.handleTouchEnd=function(){if(!this.isDraggingNow)return!1;window.clearTimeout(this.timeout);this.changeDestinationByTimer.active=!1;window.clearInterval(this.interval);this.needLastStep=!1;pageMediator.goToPage(this.getDestinationPageNumber());this.isDraggingNow=!1};
Slider.prototype.doPagerTranslate=function(a){this.p.style.webkitAnimationPlayState="paused";a="undefined"!=typeof a?Math.round(a):0;this.p.style[HTML5lib.browserPrefix+"Transform"]="translate3d("+a+"px, 0px, 0px)";if(this.isPagerInsideSlider){var b=Math.round(this.sliderLabel.offsetWidth/3);this.sliderLabel.style[HTML5lib.browserPrefix+"Transform"]=0>a-b?"translate3d("+b+"px, 0px, 0px)":a>this.barWidth-b?"translate3d("+-b+"px, 0px, 0px)":"translate3d(0px, 0px, 0px)"}this.p.style.webkitAnimationPlayState=
"running";delete null};Slider.prototype.getDestinationPageNumber=function(){var a=(this.barWidth-2*this.off)/publicationData.pageCount,b=this.localTouchCoordinateX-this.off,a=Math.round((b-b%a)/a+1);if(a>publicationData.pageCount)a=publicationData.pageCount;return publicationData.rtlMode?publicationData.pageCount-a+1:a};
Slider.prototype.getNewCoordinateFromPageNumber=function(a){"undefined"!=typeof a||(a=pageMediator.page);var b=(this.barWidth-2*this.off)/(publicationData.pageCount-1);return publicationData.rtlMode?a==publicationData.pageCount&&b>this.off?this.off:1==a&&b>this.off?this.barWidth-this.off:~~(this.barWidth-(this.off+(a-1)*b)):a==publicationData.pageCount&&b>this.off?this.barWidth-this.off:1==a&&b>this.off?this.off:~~(this.off+(a-1)*b)};
Slider.prototype.handleResize=function(){this.barWidth=this.bar.offsetWidth;this.doPagerTranslate(this.getNewCoordinateFromPageNumber())};Slider.prototype.changeDestinationByTimer=function(){var a=this.getDestinationPageNumber();customEvents.fireEvent(SLIDER_TO_PAGER_CHANGE_LABEL,{page:a});var b=this;window.clearTimeout(b.timeout);if(this.changeDestinationByTimer.active)this.timeout=window.setTimeout(function(){b.changeDestinationByTimer.call(b)},b.speed);delete null};
system={ua:"",isInit:!1,isMobile:!1,browser:{},platform:{},device:{},features:{},init:function(){this.ua=navigator.userAgent.toLowerCase();var a=navigator.platform.toLowerCase(),b=this.ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];this.browser.name="version"==b[1]?b[3]:b[1];this.browser[this.browser.name]=!0;mode="ie"==b[1]&&document.documentMode;this.browser.version=mode||parseFloat("opera"==b[1]&&b[4]?b[4]:b[2]);this.platform.name=
this.ua.match(/ip(?:ad|od|hone)/)?"ios":(this.ua.match(/(?:android)/)||this.ua.match(/(?:blackberry)/)||a.match(/mac|win|linux/)||["other"])[0];this.platform[this.platform.name]=!0;if(this.platform.ios)b=document.createElement("link"),b.rel="apple-touch-icon",b.href=ASSETS_FOLDER+"/pages/page0001_i1."+(publicationData.page["1"].format||publicationData.page.defaults.format),document.getElementsByTagName("head")[0].appendChild(b),delete b;this.device.name=this.ua.match(/ipad/)?"ipad":this.ua.match(/ipad/)?
"ipad":this.ua.match(/iphone/)?"iphone":this.ua.match(/android/)?"android":a.match(/mac|win|linux/)?"pc":"other";if("unknown"==this.browser.name&&"ios"==this.platform.name)this.browser.name="safari",this.browser[this.browser.name]=!0;this.device[this.device.name]=!0;this.device.vendor=this.ua.match(/sony/)?"sony":this.ua.match(/htc/)?"htc":this.ua.match(/samsung/)?"samsung":this.ua.match(/lg/)?"lg":this.ua.match(/apple/)?"apple":"other";this.device.version="android"===this.device.name&&this.ua.match(/android 2/)?
2:"android"===this.device.name&&this.ua.match(/android 3/)?3:"android"===this.device.name&&this.ua.match(/android 4/)?4:0;dpiDetection.setMeta();this.device.width=window.innerWidth;this.device.height=window.innerHeight;var c=this;customEvents.addListener(ROTATE_DEVICE,function(){c.device.width=window.innerWidth;c.device.height=window.innerHeight});if(this.platform.android){if(window.innerWidth>window.innerHeight)this.device.orientation="landscape";if(window.innerWidth<window.innerHeight)this.device.orientation=
"portrait"}else if(this.platform.ios){if(window.innerWidth>window.innerHeight)this.device.orientation="landscape";if(window.innerWidth<window.innerHeight)this.device.orientation="portrait"}else this.device.orientation=!1;this.features.flash={};this.features.localStorage=window.localStorage?!0:!1;this.isInit=!0;if(system.platform.ios||system.platform.android||system.platform.publisher)this.isMobile=!0},route:function(){this.isInit||this.init()}};
timer={state:!0,blockTime:0,endFX:0,startTime:Date.now(),setBlockTime:function(a,b){this.endFX=b||a;this.blockTime=a;this.startTime=Date.now()},check:function(a){a=a||"standart";if("standart"==a)return Date.now()-this.startTime>this.blockTime?!0:!1;if("high"==a)return!0;if("fx"==a)return Date.now()-this.startTime>this.endFX?!0:!1}};var Toolbar=function(a){this.isVisible=!1;this.div=el.id(a.divID);this.isActive="undefined"!=typeof a.isActive?a.isActive:!1;setClickEvents(this.div,"dp")};
Toolbar.prototype.show=function(){workspace.delCssClass(this.div,"hidden");this.isVisible=!0};Toolbar.prototype.hide=function(){workspace.addCssClass(this.div,"hidden");this.isVisible=!1};Toolbar.prototype.toggle=function(){workspace.changeCssClass(this.div,"hidden");this.isVisible=!this.isVisible};
Toolbar.create=function(a){var b=workspace.createElement({type:"aside",id:a.divID,cssClassName:"toolbar",parent:el.id("body")});("top"==a.position||"bottom"==a.position)&&workspace.addCssClass(b,"horizontalToolbar");("left"==a.position||"right"==a.position)&&workspace.addCssClass(b,"verticalToolbar");workspace.addCssClass(b,a.position+"Toolbar "+a.divID+" hidden");return new Toolbar({divID:a.divID,isActive:a.isActive})};
function TwoPagePublication(a){a=pageTable.getUserIDFromFileID(a||1);this.HORIZONTAL_MARGIN=this.VERTICAL_MARGIN=30;this.bookLeft=this.bookTop=this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.pageBuff=3;this.currentPage={left:0,right:0};this.flipSpeed=1E3;this.loadBuffers={};this.active=this.gesture=this.block=!1;var b=this;this.doubleClick=0;this.currentPage.minus=function(){this.left-=2;this.right-=2};this.currentPage.plus=function(){this.left=1*this.left+2;this.right=1*this.right+
2};this.initSizes=function(){var a=2*publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>a?(this.bookHeight=window.innerHeight-2*this.VERTICAL_MARGIN,this.bookWidth=this.bookHeight*a,this.bookLeft=(window.innerWidth-this.bookWidth)/2,this.bookTop=this.VERTICAL_MARGIN):(this.bookWidth=window.innerWidth-2*this.HORIZONTAL_MARGIN,this.bookHeight=this.bookWidth/a,this.bookLeft=this.HORIZONTAL_MARGIN,this.bookTop=(window.innerHeight-this.bookHeight)/2);this.pageHeight=
this.bookHeight;this.pageWidth=this.bookWidth/2};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active)if(publicationData.rtlMode)for(var b=a.currentPage.right-a.pageBuff;b<=1*a.currentPage.left+a.pageBuff;b++)highlight.show(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b));else for(b=a.currentPage.left-a.pageBuff;b<=1*a.currentPage.right+a.pageBuff;b++)highlight.show(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b))});customEvents.addListener(CANCEL_SEARCH,
function(){if(a.active)if(publicationData.rtlMode)for(var b=a.currentPage.right-a.pageBuff;b<=1*a.currentPage.left+a.pageBuff;b++)highlight.hide(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b));else for(b=a.currentPage.left-a.pageBuff;b<=1*a.currentPage.right+a.pageBuff;b++)highlight.hide(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b))});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});
customEvents.addListener(IOS_LOAD_PAGE_START,function(a){if(2===a.data.type){var a=a.data.page,b=el.add("div");b.id="preloader"+a;b.style.position="absolute";b.style.left="50%";b.style.top="50%";b.style.width="10em";b.style.height="10em";b.style.margin="-3em 0 0 -5em";workspace.preloader.add(b);el.id("pageDiv"+a).appendChild(b)}});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){2===a.data.type&&el.del("preloader"+a.data.page)});customEvents.addListener(IOS_LOAD_VECTOR_END,function(){})};
this.drawBook=function(a){this.active=!0;a=a||-10;-10!=a&&this.pageConverter(a);pageMediator.changePage(pageTable.getFileIDFromUserID(this.currentPage.left));this.initSizes();this.init();a=document.createElement("div");a.id="publicationDiv";a.style.webkitPerspective="3000";a.style.width=this.bookWidth+"px";a.style.height=this.bookHeight+"px";a.style.top=this.bookTop+"px";a.style.left=this.bookLeft+"px";a.style.textAlign="center";a.style.position="absolute";a.style.opacity="1";a.style.zIndex="1000";
el.id("mainFrame").appendChild(a);if(publicationData.rtlMode)for(a=this.currentPage.right-this.pageBuff;a<=1*this.currentPage.left+this.pageBuff;a++)this.drawPage(a);else for(a=this.currentPage.left-this.pageBuff;a<=1*this.currentPage.right+this.pageBuff;a++)this.drawPage(a);1==this.currentPage.right||1==this.currentPage.left?this.drawBookShadow("first"):this.currentPage.left==publicationData.pageUserCount&&!publicationData.rtlMode?this.drawBookShadow("last"):this.currentPage.right==publicationData.pageUserCount&&
publicationData.rtlMode?this.drawBookShadow("last"):this.drawBookShadow("std")};this.drawPage=function(a){if(0<a&&a<=publicationData.pageUserCount){var b=0!=a%2?a+"x"+(1*a+1):a-1+"x"+a;if(el.id(b))c=el.id(b);else{var c=el.add("div");c.id=b;c.style.width=this.pageWidth+"px";c.style.height=this.pageHeight+"px";c.style.position="absolute";c.style.webkitTransformStyle="preserve-3d";c.style.webkitTransition="-webkit-transform "+this.flipSpeed+"ms";if(publicationData.rtlMode)if(a>=this.currentPage.left)c.style.left=
0,c.style.zIndex=publicationData.pageCount-a,c.style.webkitTransform="rotate3d(0, 1, 0, 0deg)",c.style.webkitTransformOrigin="100% 100%";else{if(a<=this.currentPage.right)c.style.left=this.pageWidth+"px",c.style.zIndex=a,c.style.webkitTransform="rotate3d(0, -1, 0, 0deg)",c.style.webkitTransformOrigin="0% 0%"}else if(a<=this.currentPage.left)c.style.left=0,c.style.zIndex=a,c.style.webkitTransform="rotate3d(0, 1, 0, 0deg)",c.style.webkitTransformOrigin="100% 100%";else if(a>=this.currentPage.right)c.style.left=
this.pageWidth+"px",c.style.zIndex=publicationData.pageCount-a,c.style.webkitTransform="rotate3d(0, -1, 0, 0deg)",c.style.webkitTransformOrigin="0% 0%"}b=el.add("div");b.id="pageDiv"+a;b.style.position="absolute";b.style.width=this.pageWidth+"px";b.style.height=this.pageHeight+"px";b.style.overflow="hidden";b.className="page";b.style.webkitBackfaceVisibility="hidden";b.style.backgroundColor=publicationData.page[pageTable.getFileIDFromUserID(a)].BGColor||publicationData.page.defaults.BGColor;if(publicationData.rtlMode)if(a>=
this.currentPage.left&&0==a%2){b.style.zIndex="-1";var e=-1;b.style.webkitTransform="rotateY(180deg)"}else if(a>=this.currentPage.left&&0!=a%2)b.style.zIndex="1",e=1;else if(a<=this.currentPage.right&&0==a%2)b.style.zIndex="1",e=1;else{if(a<=this.currentPage.right&&0!=a%2)b.style.zIndex="-1",e=-1,b.style.webkitTransform="rotateY(180deg)"}else if(a<=this.currentPage.left&&0==a%2)b.style.zIndex="1",e=1;else if(a<=this.currentPage.left&&0!=a%2)b.style.zIndex="-1",b.style.webkitTransform="rotateY(180deg)",
e=-1;else if(a>=this.currentPage.right&&0==a%2)b.style.zIndex="-1",b.style.webkitTransform="rotateY(180deg)",e=-1;else if(a>=this.currentPage.right&&0!=a%2)b.style.zIndex="1",e=1;c.appendChild(b);this.drawPageContent(b,a,e);el.id("publicationDiv").appendChild(c);if(publicationData.page[pageTable.getFileIDFromUserID(a)].stub){var k=pageTable.getFileIDFromUserID(a);ZOOM_LOCK&&el.id("exPage"+k)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+k)},50))}else customEvents.fireEvent(IOS_LOAD_PAGE_START,
{page:a,type:2})}};this.drawPageContent=function(a,b,c){var e=pageTable.getFileIDFromUserID(b),k=this.pageHeight,h=publicationData.page[e].wide?2*this.pageWidth:this.pageWidth,j=publicationData.page[e].width||publicationData.page.defaults.width,m=publicationData.page[e].height||publicationData.page.defaults.height,o=j/m;if(h/k>o)var n=k,p=n*o,h=(h-p)/2,k=0;else p=h,n=p/o,h=0,k=(k-n)/2;h=publicationData.rtlMode?0==b%2&&publicationData.page[e].wide?h-this.pageWidth:h:0!=b%2&&publicationData.page[e].wide?
h-this.pageWidth:h;o=el.add("canvas");o.id="substraitCanvas"+b;o.width=p;o.height=n;o.style.position="absolute";o.style.left=h+"px";o.style.top=k+"px";o.style.zIndex=c;o.style.webkitBackfaceVisibility="hidden";a.appendChild(o);var q=p/(2*j),s=publicationData.page[pageTable.getFileIDFromUserID(b)].format||publicationData.page.defaults.format;if("js+jpg"===s||"js+png"===s)s=el.add("div"),s.id="contentDiv"+b,s.style.width=2*j+"px",s.style.height=2*m+"px",s.style.position="absolute",s.style.left=h+"px",
s.style.top=k+"px",s.style.webkitTransformOrigin="0% 0%",s.style.webkitTransform="scale("+q+")",s.style.zIndex=c,a.appendChild(s);if(1!=b){j=el.add("canvas");j.id="shadow"+b;j.width=100;j.height=this.pageHeight;j.style.position="absolute";j.style.zIndex=c;if(0==b%2){if(0==b%2&&b!=publicationData.pageUserCount)publicationData.rtlMode?(j.style.left="0px",this.drawRightShadow(j)):(j.style.left=this.pageWidth-100+"px",this.drawLeftShadow(j))}else publicationData.rtlMode?(j.style.left=this.pageWidth-100+
"px",this.drawLeftShadow(j)):(j.style.left="0px",this.drawRightShadow(j));a.appendChild(j)}j=el.add("canvas");j.id="highlightCanvas"+b;j.width=p;j.height=n;j.style.position="absolute";j.style.left=h+"px";j.style.top=k+"px";j.style.zIndex=c;a.appendChild(j);highlight.show(pageTable.getFileIDFromUserID(b),j);new LinksLayer(j,pageTable.getFileIDFromUserID(b));if(publicationData.page[e].stub){var r=pageTable.getFileIDFromUserID(b);ZOOM_LOCK&&el.id("exPage"+r)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),
setTimeout(function(){el.del("exPage"+r)},50),ZOOM_LOCK=!1)}else this.loadImage(o,e,b)};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};this.loadImage=function(a,b,c){var e=a.getContext("2d");e.fillStyle="rgb(255,255,255)";var k=publicationData.page[b].proportions||publicationData.page.defaults.proportions,h=publicationData.size.proportions,j=a.width,a=a.height,m=new Image,o=publicationData.page[b].format||publicationData.page.defaults.format;if(PUBL)"js+jpg"===
o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".jpg?1&"+PS,this.loadContent(c,j)):"js+png"===o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png?1&"+PS,this.loadContent(c,j)):"jpg"===o?n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.jpg?1&"+PS:"png"===o&&(n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.png?1&"+PS),o=new XMLHttpRequest,o.open("GET",n),o.onload=function(){m.src=this.responseText},o.onerror=function(){},o.send(),delete o;else{if("js+jpg"===o){var n=COMMON_FOLDER+
"/page-substrates/page"+this.getName(b)+".jpg";this.loadContent(c,j)}else"js+png"===o?(n=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png",this.loadContent(c,j)):"jpg"===o?n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.jpg":"png"===o&&(n=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.png");m.src=n}if(k>=h)var p=j,q=(p/k).toFixed(0),s=0,r=(a-q)/2;else q=a,p=(q*k).toFixed(0),s=(j-p)/2,r=0;m.onload=function(){ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),
setTimeout(function(){el.del("exPage"+b)},50));fileID=null;e.drawImage(m,s,r,p,q);customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:c,type:2})}};this.loadContent=function(a){var a=pageTable.getFileIDFromUserID(a),a=ASSETS_FOLDER+"/pages/ios/page"+this.getName(a)+".js",b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.id="formPrinter";c.type="text/javascript";c.src=a;b.appendChild(c);window.fakeLoadComplete=function(a){window.loadBuffers[a]=window.loadBuffer;for(i in window.loadBuffers[a]){var b=
el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*window.loadBuffers[a][i][4]+"px";b.style.left=2*window.loadBuffers[a][i][5]+"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var d=document.createTextNode(window.loadBuffers[a][i][0]);b.appendChild(d);d=pageTable.getUserIDFromFileID(a);el.id("contentDiv"+
d).appendChild(b)}}};this.destroyPage=function(a){el.del(a)};this.clearPage=function(a){el.id("substraitCanvas"+a)&&el.del("substraitCanvas"+a);el.id("contentDiv"+a)&&el.del("contentDiv"+a);el.id("highlightCanvas"+a)&&el.del("highlightCanvas"+a)};this.goToPage=function(a){a=pageTable.getUserIDFromFileID(a);if(publicationData.rtlMode)if(a>=this.currentPage.right-2&&a<this.currentPage.right){var b=1*this.currentPage.right+3+"x"+(1*this.currentPage.left+3);el.id(b)&&this.destroyPage(b);this.shiftLeft();
this.currentPage.minus();this.drawPage(1*this.currentPage.left-this.pageBuff);this.drawPage(1*this.currentPage.right-this.pageBuff)}else if(a<=1*this.currentPage.left+2&&a>this.currentPage.left)b=1*this.currentPage.right-3+"x"+(1*this.currentPage.left-3),el.id(b)&&this.destroyPage(b),this.shiftRight(),this.currentPage.plus(),this.drawPage(1*this.currentPage.left+this.pageBuff),this.drawPage(1*this.currentPage.right+this.pageBuff);else{if(a!=this.currentPage.left&&a!=this.currentPage.right){a<this.currentPage.right?
(this.clearPage(1*this.currentPage.right-1),this.clearPage(1*this.currentPage.right-2),this.shiftLeft()):(this.clearPage(1*this.currentPage.left+1),this.clearPage(1*this.currentPage.left+2),this.shiftRight());this.pageConverter(a);var c=this;setTimeout(function(){c.destroyBook();c.drawBook(a)},this.flipSpeed)}}else a<=this.currentPage.right+2&&a>this.currentPage.right?(this.shiftLeft(),b=1*this.currentPage.left-3+"x"+(1*this.currentPage.right-3),this.currentPage.plus(),el.id(b)&&this.destroyPage(b),
this.drawPage(1*this.currentPage.left+this.pageBuff),this.drawPage(1*this.currentPage.right+this.pageBuff)):a>=this.currentPage.left-2&&a<this.currentPage.left?(this.shiftRight(),b=1*this.currentPage.left+3+"x"+(1*this.currentPage.right+3),this.currentPage.minus(),el.id(b)&&this.destroyPage(b),this.drawPage(1*this.currentPage.left-this.pageBuff),this.drawPage(1*this.currentPage.right-this.pageBuff)):a!=this.currentPage.left&&a!=this.currentPage.right&&(a>this.currentPage.right?(this.clearPage(1*this.currentPage.right+
1),this.clearPage(1*this.currentPage.right+2),this.shiftLeft()):(this.clearPage(1*this.currentPage.left-1),this.clearPage(1*this.currentPage.left-2),this.shiftRight()),this.pageConverter(a),c=this,setTimeout(function(){c.destroyBook();c.drawBook(a)},this.flipSpeed)),setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END)},this.flipSpeed)};this.shiftLeft=function(){if(publicationData.rtlMode)var a=1*this.currentPage.right-1+"x"+this.currentPage.right,b=publicationData.pageCount-this.currentPage.right,
c=89999+this.currentPage.right;else a=this.currentPage.right+"x"+(1*this.currentPage.right+1),b=this.currentPage.right,c=1E5-this.currentPage.right;var e=el.id(a);customEvents.fireEvent(BOOK_FLIPPING_START);e.style.webkitTransform="rotate3d(0, -1, 0, 0deg)"==e.style.webkitTransform?"rotate3d(0, -1, 0, 179."+c+"deg)":"rotate3d(0, 1, 0, 0deg)";var k=this;setTimeout(function(){e.style.zIndex=b;for(var a=e.getElementsByTagName("*"),c=0;c<a.length;c++){var d=a[c].style.zIndex;a[c].style.zIndex=1==d?-1:
100==d?-100:-100==d?100:1}},this.flipSpeed/3);var k=this,h=k.currentPage.right;publicationData.rtlMode?(2==h&&k.drawBookShadow("first"),a=function(){h==publicationData.pageUserCount&&k.drawBookShadow("std");customEvents.fireEvent(BOOK_FLIPPING_END)}):(h==publicationData.pageUserCount-1&&k.drawBookShadow("last"),a=function(){1==h&&k.drawBookShadow("std");customEvents.fireEvent(BOOK_FLIPPING_END)});setTimeout(a,this.flipSpeed)};this.shiftRight=function(){var a=this;if(publicationData.rtlMode)var b=
this.currentPage.left+"x"+(1*this.currentPage.left+1),c=this.currentPage.left,e=1E5-this.currentPage.left;else b=1*this.currentPage.left-1+"x"+this.currentPage.left,c=publicationData.pageCount-this.currentPage.left,e=89999+this.currentPage.right;var k=el.id(b);customEvents.fireEvent(BOOK_FLIPPING_START);k.style.webkitTransform="rotate3d(0, 1, 0, 0deg)"==k.style.webkitTransform?"rotate3d(0, 1, 0, 179."+e+"deg)":"rotate3d(0, -1, 0, 0deg)";a=this;setTimeout(function(){for(var a=k.getElementsByTagName("*"),
b=0;b<a.length;b++){var d=a[b].style.zIndex;a[b].style.zIndex=1==d?-1:100==d?-100:-100==d?100:1}k.style.zIndex=c},this.flipSpeed/3);var h=a.currentPage.left;publicationData.rtlMode?(h==publicationData.pageUserCount-1&&a.drawBookShadow("last"),b=function(){1==h&&a.drawBookShadow("std");customEvents.fireEvent(BOOK_FLIPPING_END)}):(2==h&&a.drawBookShadow("first"),b=function(){h==publicationData.pageUserCount&&a.drawBookShadow("std");customEvents.fireEvent(BOOK_FLIPPING_END)});setTimeout(b,this.flipSpeed)};
var c=-1,e=-1,b=this;this.touch=function(){!b.block&&!b.gesture&&!ZOOM_LOCK&&(c=Modernizr.touch?event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){if(!b.block&&!b.gesture&&!ZOOM_LOCK&&(e=Modernizr.touch?event.changedTouches[0].pageX:event.pageX,-1!=c&&-1!=e)){var a=c-e;70<a?pageMediator.right():-70>a&&pageMediator.left();e=c=-1}};this.gesturestart=function(a){b.gestureStartTrigg=!0;customEvents.fireEvent(ZOOM_ANIMATION_START);b.gesture=!0;var a=a.target.id.match(/\d+/i),c=pageTable.getFileIDFromUserID(a);
publicationData.page[c].wide&&0!=a%2&&!publicationData.rtlMode&&(a-=1);publicationData.page[c].wide&&0===a%2&&publicationData.rtlMode&&(a=1*a+1);b.gestureDiv=el.id("pageDiv"+a);b.gesturePage=a;b.maxZoom=!publicationData.page[c].wide?strUtils.getMaxZoom(b.pageWidth,b.pageHeight):strUtils.getMaxZoom(b.bookWidth,b.pageHeight);el.id("mainFrame").appendChild(b.gestureDiv);el.del("shadow"+a);b.gestureDiv.style.webkitTransform="";b.gestureDiv.style.zIndex=1E5;b.gestureDiv.id="exPage"+c;b.gestureDiv.style.top=
b.bookTop+"px";b.gestureDiv.style.webkitTransformOrigin="50% 50%";if(publicationData.page[c].wide)b.gestureDiv.style.width=2*b.pageWidth+"px";if(publicationData.rtlMode&&0===a%2)b.gestureDiv.style.left=b.bookLeft+b.pageWidth+"px";else if(!publicationData.rtlMode&&0===a%2)b.gestureDiv.style.left=b.bookLeft+"px";else if(!publicationData.rtlMode&&0!=a%2)b.gestureDiv.style.left=b.bookLeft+b.pageWidth+"px";else if(publicationData.rtlMode&&0!=a%2)b.gestureDiv.style.left=b.bookLeft+"px"};this.gesturechange=
function(a){if(1<a.scale&&b.maxZoom>=a.scale)b.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+a.scale+","+a.scale+","+a.scale+")"};this.gestureend=function(a){if(b.gestureStartTrigg){b.gestureStartTrigg=!1;var c=1.3;setTimeout(function(){b.gesture=!1},150);var e=pageTable.getFileIDFromUserID(b.gesturePage),l=b.gesturePage,a=a.scale>b.maxZoom?b.maxZoom:a.scale;a<c&&(a=c);var k=b.pageWidth*a/(publicationData.page[e].width||publicationData.page.defaults.width);b.destroyBook();
b.gestureDiv.style.webkitTransitionDuration="300ms";if(publicationData.rtlMode&&0===l%2)var h=-b.pageWidth/2;else!publicationData.rtlMode&&0===l%2?h=b.pageWidth/2:!publicationData.rtlMode&&0!=l%2?h=-b.pageWidth/2:publicationData.rtlMode&&0!=l%2&&(h=b.pageWidth/2);publicationData.page[e].wide&&(h=0);(c=a)?(b.gestureDiv.style.webkitTransitionDuration="300ms",b.gestureDiv.style.webkitTransform="translate3d("+h+"px, 0px, 0px) scale3d("+a+","+a+","+a+")",setTimeout(function(){customEvents.fireEvent(START_ZOOM_PRELOADER);
customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:k,page:e})},310)):(b.gestureDiv.style.webkitTransform="translate3d("+h+"px, 0px, 0px) scale3d("+a+","+a+","+a+")",customEvents.fireEvent(START_ZOOM_PRELOADER),customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:k,page:e}))}};this.destroyBook=function(){el.del("publicationDiv");this.active=!1};this.pageConverter=function(a){publicationData.rtlMode?0!=a%2?(this.currentPage.left=a,this.currentPage.right=a-1):(this.currentPage.left=1*a+1,this.currentPage.right=
a):0!=a%2?(this.currentPage.left=a-1,this.currentPage.right=a):(this.currentPage.left=a,this.currentPage.right=1*a+1);this.currentPage.left*=1;this.currentPage.right*=1};this.pageConverter(a);this.drawBookShadow=function(a){var b=publicationData.pageUserCount+"x"+publicationData.pageUserCount,c=publicationData.pageUserCount-3+"x"+(publicationData.pageUserCount-2);"first"==a?(el.id("3x4")?HTML5lib.boxShadow(el.id("3x4"),"0px 0px 3px #000"):HTML5lib.boxShadow(el.id("1x2"),"0px 0px 3px #000"),HTML5lib.boxShadow(el.id("publicationDiv"),
"0px 0px 0px #000")):"last"==a?(el.id(c)?HTML5lib.boxShadow(el.id(c),"0px 0px 3px #000"):HTML5lib.boxShadow(el.id(b),"0px 0px 3px #000"),HTML5lib.boxShadow(el.id("publicationDiv"),"0px 0px 0px #000")):(HTML5lib.boxShadow(el.id("publicationDiv"),"0px 0px 3px #000"),el.id(c)?HTML5lib.boxShadow(el.id(c),"0px 0px 0px #000"):el.id(b)?HTML5lib.boxShadow(el.id(b),"0px 0px 0px #000"):el.id("pageDiv3")?HTML5lib.boxShadow(el.id("3x4"),"0px 0px 0px #000"):el.id("pageDiv1")&&HTML5lib.boxShadow(el.id("1x2"),"0px 0px 0px #000"))};
this.goToZoom=function(a){if(!this.block&&!ZOOM_LOCK){var b=pageTable.getFileIDFromUserID(a);maxZoom=!publicationData.page[b].wide?strUtils.getMaxZoom(this.pageWidth,this.pageHeight):strUtils.getMaxZoom(this.bookWidth,this.pageHeight);pageMediator.changePage(b);customEvents.fireEvent(ZOOM_ANIMATION_START);publicationData.page[b].wide&&0!=a%2&&!publicationData.rtlMode&&(a-=1);publicationData.page[b].wide&&0==a%2&&publicationData.rtlMode&&(a=1*a+1);var c=el.id("pageDiv"+a);el.id("mainFrame").appendChild(c);
c.style.webkitTransform="";c.style.zIndex=99999;c.id="exPage"+b;c.style.top=this.bookTop+"px";if(publicationData.rtlMode&&0===a%2)c.style.left=this.bookLeft+this.pageWidth+"px";else if(!publicationData.rtlMode&&0===a%2)c.style.left=this.bookLeft+"px";else if(!publicationData.rtlMode&&0!=a%2)c.style.left=this.bookLeft+this.pageWidth+"px";else if(publicationData.rtlMode&&0!=a%2)c.style.left=this.bookLeft+"px";el.del("shadow"+a);if(publicationData.page[b].wide)c.style.width=2*this.pageWidth+"px";var e=
window.innerWidth/(publicationData.page[b].wide?this.bookWidth:this.pageWidth),e=e>maxZoom?maxZoom:e,k=this,h=function(){c.style.webkitTransitionDuration="300ms";c.style.webkitBackfaceVisibility="";if(!publicationData.page[b].wide)c.style.left=k.bookLeft+k.pageWidth/2+"px";c.style.webkitTransformOrigin="50% 50%";c.style.webkitTransform="translate3d(0px,0px,10px) scale3d("+e+","+e+","+e+")";h=null};setTimeout(h,10);var j=k.pageWidth*e/(publicationData.page[b].width||publicationData.page.defaults.width);
setTimeout(function(){k.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:j,page:b})},350)}};this.drawLeftShadow=function(a){ctx=a.getContext("2d");var b=ctx.createLinearGradient(0,0,100,0);b.addColorStop(0,"rgba(0,0,0,0)");b.addColorStop(0.6,"rgba(0,0,0,0.1)");b.addColorStop(0.95,"rgba(0,0,0,0.2)");b.addColorStop(1,"rgba(0,0,0,0.65)");ctx.fillStyle=b;ctx.fillRect(0,0,a.width,a.height)};this.drawRightShadow=function(a){ctx=a.getContext("2d");
var b=ctx.createLinearGradient(this.bookWidth/20,0,0,0);b.addColorStop(0,"rgba(0,0,0,0.0)");b.addColorStop(0.4,"rgba(0,0,0,0.05)");b.addColorStop(0.8,"rgba(0,0,0,0.20)");b.addColorStop(1,"rgba(0,0,0,0.15)");ctx.fillStyle=b;ctx.fillRect(0,0,a.width,a.height)}}
function VerySimpleZoom(a){function b(){var a;getIsAlbum()&&n?(a=getPageContentRect(l,innerWidth,innerHeight),v=a.width,u=a.height):(v=e/(n?2:1),u=d/(n?2:1));j.width=v;j.height=u;n?o.drawImage(r,0,0,e,d,0,0,j.width,j.height):o.drawImage(r,0,0);sizeDiv(k,v,u);p?(k.fbX=innerWidth/2-p.x*v,k.fbY=innerHeight/2-p.y*u):void 0!=a?(k.fbX=a.x,k.fbY=a.y):(k.fbX=getIsPortrait()?0:innerWidth/2-v/2,k.fbY=0);q()}function c(){deleteAllChildren(h);sizeCanvas(m,v,u);highlight.show(l,m);new LinksLayer(m,l);if(f){var a=
parseVectorizedContentToDiv(f,h);scaleAndPositionPageContent(l,a,{x:0,y:0,width:e*(n?0.5:1)})}}var e,d,f,g=function(a){j.getContext("2d").fillStyle=publicationData.getPageProperty(a,"BGColor");j.getContext("2d").fillRect(0,0,j.width,j.height);f=void 0;publicationData.getPageProperty(a,"stub")||(showPreloader(),window.loadManager.addPageToQueue(a.toString(),{quality:!0,onImageLoadComplete:function(a){e=a.width;d=a.height;r=a;b()},onAllIsComplete:function(b,d){f=d;c(a);hidePreloader();s||customEvents.fireEvent(BOOK_FLIPPING_END,
{page:l});s=!1}}))};this.setHighlight=function(a){a?highlight.show(l,m):highlight.hide(l,m)};var l=0,k=createDiv("vsZoomContent",!0),h=createDiv("vectorDiv"),j=createCanvas("cZoomCanvas"),m=createCanvas("cZoomTopCanvas");j.width=1;j.height=1;k.appendChild(j);k.appendChild(h);k.appendChild(m);var o=j.getContext("2d");o.fillStyle="white";o.fillRect(0,0,j.width,j.height);var n=!0,p,q=function(){k.style.webkitTransform=dev_translate(Math.round(k.fbX),Math.round(k.fbY),0)};this.sendMove=function(a,b){k.fbX||
fconsole.log("exception fbX");var c=k.getBoundingClientRect(),a=checkHorizontalMovement(a,c),b=checkVerticalMovement(b,c);k.fbX+=a;k.fbY+=b;q()};this.sendDrag=function(a){var b=k.getBoundingClientRect();0<=b.left&&b.left+b.width<=innerWidth&&flipPage(a)};this.getIsSmallest=function(){return n};this.getIsLargest=function(){return!n};this.set=function(b,c,d){a.appendChild(k);a.style.overflow="";sizeDiv(a,innerWidth,innerHeight);setElementPosition(a,{left:0,top:0});l=b;a.style.position="absolute";r=
null;p=d;B();s=!0};var s;this.clear=function(){a.removeChild(k)};var r,B=function(){r?(b(),c()):g(l)},v,u;this.incZoom=function(){n=!1;p={};p.x=(innerWidth/2-k.fbX)/v;p.y=(innerHeight/2-k.fbY)/u;var a=contentWidth2/contentWidth1;k.fbX2=innerWidth/2-a*innerWidth/2-k.fbX1*a;k.fbY=innerHeight/2-p.y*u;B()};this.resize=function(){sizeDiv(a,innerWidth,innerHeight);l&&(p=null,B())};var w=function(a){l!==a&&(l=a,p=r=null,B())};this.setPosition=w;this.goToPage=function(a){w(a)};this.decZoom=function(){n=!0;
B()}}
var video={inject:function(a,b){for(var c=0;c<publicationData.page[b].videos.length;c++){var e=a.width/(publicationData.page[b].width||publicationData.page.defaults.width),d=(publicationData.page[b].videos[c].width*e).toFixed(0),f=(publicationData.page[b].videos[c].height*e).toFixed(0),g=publicationData.page[b].videos[c].x*e,l=publicationData.page[b].videos[c].y*e,k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABDCAYAAAAoCNNNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RENDMjEyQkZENEQwMTFFMDg0N0M5RkRBMUU2NDQ2RUIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RENDMjEyQzBENEQwMTFFMDg0N0M5RkRBMUU2NDQ2RUIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEQ0MyMTJCREQ0RDAxMUUwODQ3QzlGREExRTY0NDZFQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEQ0MyMTJCRUQ0RDAxMUUwODQ3QzlGREExRTY0NDZFQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PktdS6EAAA9LSURBVHja1FsJUFRXFv0Nza7smwhNUEERl4xLKQpqJEaNuJRLpLQiTjQaFMPIOKkkjqYmExNKJaGME51xNzhqRkl0EHViTJStwkDcAEVBREB2Gmi6gaah5zzmvvbbLkHoRvKqbv3+v7v/f+/8+8499/73JUIXm1ar7exPXWCTYYNhg2DD6TjbmtNnNewGfWbbfFge7BKsSjBCk0gkj+4bCYjRsIWwWaKBd/U62eh0Ij6egGUZC4judFDf+sCiYTlaI7X29vbctra2P9K1hO7YY8AYwCPsYJGwaJjjk37b3NysyM3NLb5z547i5s2bLWlpaa3s2snJyewkkqCgIFN2ysDAQDN/f38LX1/fPgEBAZ5WVlZ9nnJtOQD5QiqV7sBufW+YGsthW4kHHmllZWXFZ86cKT58+HATBtzxF1gbWTuZloz3hZkJmWlwcLDZkiVLbGfNmtXfy8ur3xP6UN3S0vK+paXlvhcCBDrgg80RWKD4uEajaU5KSsqOiYmpS09PF2iwGlgrEaKaPrfS8XYChjVTAkAKMyMzJzODt5hv2LDBJTQ01N8cTe+6GXV1dcucnZ3zegwIgMBI8ABM57atra2qhISEG+vXr2+AJwg0yBY2K2BNZBwEPnityCsEkTdIRKBwMKzILPv162e5fft2lwULFgRYWFhYivqlVCgUb9vZ2R3TdiKkdQsInD+WuEDXUlJSrsF9K4uLiwUaKBt0I0xJQKgJmLYuzkJT8hIGCBu4DbsJmCrWhw4d8n7llVeGin+sUql22djYRDJuNTgQOKk5ecESfqyhoaH6zTffvHr69GktDVQFU5BxD2gTDNtMRR7Sl9mcOXNs9+/fP9rJyclRBMbJ+Pj4ZatWrVIZDAiAwC5+ijRBR7ty5UpOSEhIqVwuF2jQjLkbyAvU5PLGbCYECPMOWwcHB7vz588PGTt27GD+A6VS+UNkZGTogQMHmg0FRBw2UXx/165dyWvWrGkmL2CDr6NtixE8oDMeYsHAgNnHxcV5RkVFTeRfVlVV7Xd1dY3AGNTdAgInWIHNXr6/Y8eOFFxIRYNmAMiJDzQi0uvpJiEOYeTt8OWXX3rDEybxL6Fd/uTn5xeHsWi6BAT+GITNDzwfuHTp0tUpU6ZU0lSoJWt6AV7wLO9g3OF4+fLlkdAgozrid3u7JiMjYz7CbxLG1PZcQOAPMmwyuVAqKioqHDJkSD4UYjMlQTUEglboXY2Nx8ra2topJydn6ktoFN7rvvvuu0lvvPFGDo8mnQWCSUHmEQJicy3kbhbCo5oAqCJS7G0giMdk4+Pj43r16tVQW1tbB4pyV6Ax2JRRMp2hD4TJU3ghiO+Hh4dfAQhtFBlqKUx2CoSNGzcOeQFAsL6pCgsLayIiIi7wgwDkd1lZWVFErk+cV2IQWCz+N8014eLFizc++OCDBgKhioix05yAubp20aJFXgUFBeUwZQ+D0Xbjxo3W6dOnSyC++rODkOBjIcVPvv7667X6N1OiB8RfsNnMPiOZUcK90iCZmQeU07RofU4l+hERlvbChQtZK1asuFBSUtLSg4CYyWQy59u3by+FHGeaQ8jOzt43fPjwaAr5j08NluNTOt3Rjh49mgsQNCKxpOmy+jExkbz22mtj8vLy/rBz586xyJkkPQSE5v79+/Vnz55N4QcQShejLzLKYx73CFZUwSaWWLbF29v7MoBgADwgMJ47THKP0G/l5eXVmzZtOrN37957PRFWMRb7/Pz8lVKptCNJS01N/VtQUNCfSQs95hEr+efExMSbAKGVPEFlaK3g7u7uvGfPnnCQV9ikSZOcjAxEG8K/EoPXeQWi4FwqIkkfAQIgjEY48ecHt23bViPKItXG6uGoUaMGg5AjTp48GeLm5mZuRDDUMTExt/mOvb2956effjqZBwWxRyzmBxAqy9LT09UEQpOxEyhTtPnz5weB0N6NjY0dbaTLtJ87d66xurr6Lj8AnphLOYpE7BEz+Q+QVhdTLqE0pjfoN8R5m+jo6NB79+69HRYW5mkMr/jpp590VXCITga6A08hTJh2wLQYxn9w/PjxBiqoNL+IPALE5oGItSItLW3hsGHD+hiSK+Lj48v4jpOTkycI04dPD+YRU/mXTWjJyclqIki18AIbkqSAzMzMd9H5yQ4ODlJDnPPUqVMqRESFSDUH64DQaDQ6krx+/XoJiabm7ugGQzWIILOlS5dOgSpd9+GHHw41hK6AoLvOdzw9PX2ouCNlU0OXDyDWKkQV596SXgvwCNstW7YsAqH+ft68ef26Mz1KS0sr+I6Hh4eMSn5mJuAHHdK5ublKIspWoRc2X19f2bfffrsKcj10wIABVl05B/KPav7Z1dXVnTzCHOrXxI1/gTnZJDwsuffaFhISMjonJycKynTC88p1kHAj/2xtbc28wZp7hC3/AqGLP3xpE3p5s7S0tEASNw2qcU1UVJRvZ/8HvtEFAYDIUnLLDo4AEDaiYmeb8PAJ1G+iof/marXampKoX/WOyspK3U02MzOzIB1hKn1CHv+bAEKpVGp27Nhx9+OPP2YlxEaa64pOeHP7E2oyEil7VMa9AuShlcvl2t4OAgjzwZo1awqQxTbTwDrNE8hpdL+FJ6lJS5mYtLe36wQGmNikNwPwyy+/1CFbzUBukgsQGqk8UCk8rKP+qicPHjzYVASErkjEBJVuac7o0aMthW4sFTBWq6ioaIYH5KB/WVC+/FkK63cZAcH1z6968/jx43Wc2NjYyMFrl2J+FUDBdSzvGTFiRF/K0U16Q+SA4m/bvXt30ebNm4vQ6VbSOAryhEahC0/XxowZ4yQizmr6v5YBccvOzq7ji4EDB9r1FiCSkpIqkI0W5OXl8SxYSQDwh8xdSgH69+/vLgqlZVxFS8G+uoKFv78/k5wZxKQvRF3eunVLsW7dujyoxzrqg4oqZbxa1qkp8LTm4uLysh4QHXmVCS54mX/B1iy9+uqrVsITnncYu9XW1qrfe++9W7gZGehTDXlAtYgHGujudRmExYsXS6GkdVPjyJEjtzi4JqtXry5TqVT5/MsFCxY4CXoVXmM2kHX7nj17ijAt07dt21ZMHaslAFiCVEd3rdva5q233nIREXA58g45Ad7K7ry6vr4+lf9g9uzZflxtGRuEH3/8sQqR4OdVq1bdqaurU9KgKwiEWuqkwbgqODh4nCj5KiCAO+qyDAhNdnb2NyIykU2ePNlaEFV4Dd2Q0yjheVemTp16HY0/N6kkAPgTNYNyVGhoqCmm/ki+Hx8fn0XEy8DWcM3ggPB0zcbGxovtnDt37tLMmTMzqUNdbvrPNRQKRevWrVvvxsTElGJKaIj9eTjkJQCjyHtkq75Dhw7tWPpUU1NT6ezs/Fd8zIZdg8k5KTbhLv1LlOaO9/DwsDbU9GCP/I4fP14K5Zr+ySef3AcGnAfKyeSCESvmMplMAhKey/fPnz+fKSLjJkEUHVo2bdr0d7ZMkGdlX331lY/wcNF4l1tGRkZFYGBgRlhY2M3q6mouizkP1AhGeICk306cOCHj+RRkddOGDRvSCHw5eaEOCC0SmfLc3Nzj/M8zZswI9vb27lYoxQUTx40blwIw5DQFqkQ80GlZ3J02aNAgCdSkzhvOnj2bWlZWViOS5lpBz/XbwBNFIJWlpqam5lKp1By6vHnfvn1lXVVx6enpCvKqZnLDOuHhmqueStQC7O3tOx4csSf88+bNOwbNworUt6lP7YLe3daASe+mpqb+Q5SgTF65cqVDN7iCr7LhPKDqyVrH+vXrLeDVC/n+4cOH/5Ofn8+88QFxlO6G6GeaTEjJ4DqJ7u7uQ4jpS+FeR5GgqLrgxnyhuVbo4aVG6L9QUlLCvJu9LMMeZRaANHfjYxFzFNh9cYjWn//si6rY2NiP2NIAdqBv37794SWBXdQV+uute6xBn4zjILDF8hBtCUTUxcRRrfplqsdUb1pamtzPz0+LtLxjLZWjo6MM4ec+2Lde6L2LyMSZq9vIkSPD+D5u7D937drFOOEecYNceNbSIXGRGOaTmZn5BSTwdBJH7TjZvrVr15b1ZjAOHDhgv3z58kh+k1NSUi5BWrN1YaUkngoxlubOLjhlx23R/HGiuOHDh+s0ekJCwkHI4/u9EQzmCVDE74jyiZ8ROhOgHapJRbL3ORqetLzwWWU5xh/Obm5uI8ARccgOA/gXpaWlP+ACaeXl5b2i2s2IkXGCi4vLDH6sqKgoBzfwMMi+ngDIZeHyaQtOnyWW2B/kSFdvQhluALpZosQsBJI8PCIiwvpFgxAZGWmB6LBMDAKEYQaBwHQMyzLvsLE86x2OzhRqWUhlD17ZNHl/4sSJU8RfFhYWJk6bNu1KQUFBj3oHU4xI40d4enrO0xNxFydMmJBEmoWtkLnJ1CxAeCRKPI9HiEMqE0Q3g4KCtsTFxe3loZU1Hx+f0Nu3b68DSC+x5MbYALBrYLAydk0xCCxEfv755/sBwllSr3cIhHJ9ELrqEWLPcGU3Y/bs2YE7d+58B53y1ku7GzCFEjdu3Hg3MTHRoIkUqyd89tlnLw0bNmy28P9XLHUNXJW/bNmyb77//vtaCo1sOrCqW+XTQOjuy21MVLFleQyAgQincxGq5lhaWj7GFU1NTdeQbP13+/bt5V0FhQ0eiZs7pP4YCwuLlx/T72p148GDB0+vXr36Ksn5CgKBqcda/Xc0DAkEn07s+YcHmxkQWn5bt24NBU9MFL91p1ePqJTL5Vfv3r37ICcnpz45OVmJxmoUGl5UtbGxkSDe2wQEBNgNGDDAAyJuJDrr9sS52tqqunjx4mUQZTpyBxUpRqYTCimPUBjl5banTCkL8g5W1ZKBK2Rw3RC0Mc7Ozi7G4AeAWQ6CzIiOjs5EeGym4koV5Q3FlEi1GP11Rz0+YCdj6o0VPNjA+1N0cQwPDx+Cu/zy2LFj/bsLChs8Uunsr7/+OvfQoUMPqIijFFW6SwkMpfgNnR4FQnRSRqR9yEPciFRZ+m4Dze+ycOHCgYjrbl5eXo4eHh7OUqnUFAD1F5+vpqamBMzfBt1SAV1QA4FUcezYsZJr164pKV3mHiCnokoFgdHYmahgNCCeQabWxCEMCCfa9qX8xZx+I6VcwFTUB/G74xoyNQGgIABqaKsgnWCwAo+x4r5EePiiqjVNn760tSJQ+OvOJiIly1+b5q9SK0Uld5Xw8MVarTE6bOzG3/U2Fx6+/G4qMjEQbSLj67n4UkejJnn/E2AAVQ3PcVSa0qgAAAAASUVORK5CYII=",e=
publicationData.page[b].videos[c].showImage,h=a.getContext("2d");h.fillStyle=e?"rgba(0,0,0,1)":"rgba(0,0,0,0)";h.fillRect(g,l,d,f);var j=function(a,d,f,e){var g=new Image,f=1*f,l=COMMON_FOLDER+"/pages-content/"+publicationData.page[b].videos[c].imageUri;if(PUBL){var j=new XMLHttpRequest;j.open("GET",l+"?1&"+PS);j.onload=function(){g.src=this.responseText};j.send();delete j}else g.src=l;g.onload=function(){var b=this.width/this.height,c=this.width/f;if(f/e>=b)var l=f,j,l=(l/b-e)/2,l=l*c,b=0;else j=
e,l=0,b=(j*b-f)/2,b*=c;h.drawImage(g,b,l,this.width-2*b,this.height-2*l,a,d,f,e);var m=new Image,o=50<e?50:0.8*e;m.src=k;k=null;m.onload=function(){h.drawImage(m,a+(f/2-o/2),d+(e/2-o/2),o,o);m=null};g=null}};if(e)j(g,l,d,f);else{var m=new Image,o=50<f?50:0.8*f;m.src=k;k=null;m.onload=function(){h.drawImage(m,g+(d/2-o/2),l+(f/2-o/2),o,o);m=null}}}},play:function(a){var b=function(){var a=window.innerWidth/2/1.64,b=(window.innerHeight-a)/2;el.id("videoPlayer").style.height=a+"px";el.id("videoPlayer").style.top=
b+"px"},c=el.add("div");c.id="videoDiv";c.style.width="100%";c.style.height="100%";c.style.zIndex="10000000";c.style.webkitTransform="translate3d(0px,0px,1000px)";c.style.backgroundColor="rgba(0,0,0,0.7)";c.addEventListener("click",function(){el.del("videoDiv");customEvents.removeListener(ROTATE_DEVICE,b);event.preventDefault();event.stopPropagation()});el.id("body").appendChild(c);var e=window.innerWidth/2/1.64,d=(window.innerHeight-e)/2,f=el.add("div");f.id="videoPlayer";f.style.width="50%";f.style.height=
e+"px";f.style.position="absolute";f.style.top=d+"px";f.style.left="25%";f.style.backgroundColor="rgba(0,0,0,1)";f.addEventListener("click",function(){event.preventDefault();event.stopPropagation()});c.appendChild(f);c=el.add("iframe");f.appendChild(c);c.className="youtube-player";c.type="text/html";c.width="100%";c.height="100%";c.frameBorder="0";c.src="http://www.youtube.com/embed/"+a+"?autoplay=1";customEvents.addListener(ROTATE_DEVICE,b)}};
workspace={isInit:!1,flipArea:0.1,flipAreaIOS:0.15,init:function(a){if(!workspace.isInit){this.deleteUnnecessaryHTML();system.platform.ios&&1!=window.IPADVER?a.addEventListener(SINGLE_CLICK,workspace.clickControl):a.addEventListener(SINGLE_CLICK,workspace.clickControlSimple);publicationData.visibility.bookmarks&&bm.loadAllBmFromStorage();with(workspace)storagePage.init(),toolbars.init(),buttons.init(),pager.init(),setPublicationTitle();window.addEventListener&&window.addEventListener("touchmove",
function(a){a.preventDefault()},!0);if(/^3|4$/.test(system.device.version))el.id("body").style.webkitTransformStyle="preserve-3d";PUBL?(a=new XMLHttpRequest,a.open("GET",BACKGROUND_FOLDER+"/flash/"+publicationData.background.src+"?1&"+PS),a.onload=function(){var a=new Background({divID:"bgDiv",color:publicationData.background.color,src:this.responseText,placement:publicationData.background.scale});delete null},a.onerror=function(){},a.send(),delete a):(a=new Background({divID:"bgDiv",color:publicationData.background.color,
src:BACKGROUND_FOLDER+"/flash/"+publicationData.background.src,placement:publicationData.background.scale}),delete null);this.needZoomTolbar()?("mobile"==DEV&&el.del("pagerField"),workspace.slider=new Slider("sliderBar","sliderThumb",!1)):workspace.slider="mobile"==DEV?new Slider("sliderBar","sliderThumb",!0,"pagerField"):new Slider("sliderBar","sliderThumb",!1);if(PUBL)a=new XMLHttpRequest,a.open("GET",ASSETS_FOLDER+"/skin.css?1&"+PS),a.onload=function(){var a=document.createElement("link");a.setAttribute("rel",
"stylesheet");a.setAttribute("type","text/css");a.setAttribute("href",this.responseText);document.getElementsByTagName("head")[0].appendChild(a)},a.onerror=function(){},a.send(),delete a;workspace.popovers.init();window.addEventListener("resize",function(){workspace.handleResize()},!1);this.detectFirstRun()&&window.setTimeout(function(){workspace.toolbars.toggle();"tablet"==DEV&&workspace.publicationTitle.showForAWhile(workspace.publicationTitle.time)},1E3);publicationData.slideshowAutostart&&("object"!=
typeof workspace.buttons.list.slideShowButton&&workspace.slideShow.addSlideShowButton(),window.setTimeout(function(){workspace.slideShow.turnOnOff()},1E3));workspace.isLocal=/((.*\.local$)|(.*localhost.*)|(^192\.168(\.\d+){2})|(127\.0\.0\.1)|(^10(\.\d+){3})|(^172\.(1[6-9]|2\d+|3[0-1])(\.\d+){2}))/i.test(document.location.hostname);workspace.isInit=!0}},toolbars:{isHide:!0,list:{},init:function(){for(var a=0,b=document.getElementsByClassName("toolbar");a<b.length;)this.list[b[a].id]=new Toolbar({divID:b[a].id}),
a++;this.list.topToolbar.isActive=!0;this.list.pagerToolbar.isActive=!0;if(workspace.needZoomTolbar()){this.list.zoomToolbar=Toolbar.create({divID:"zoomToolbar",isActive:!0,position:"bottom"});workspace.createElement({id:"zoomOutField",cssClassName:"buttonsField horizontalField zoomField zoomOutField",parent:this.list.zoomToolbar.div});workspace.createElement({id:"zoomInField",cssClassName:"buttonsField horizontalField zoomField zoomInField",parent:this.list.zoomToolbar.div});workspace.createElement({type:"span",
id:"zoomFont",text:LOCALS.ZOOM+": ",cssClassName:"zoomFont",parent:this.list.zoomToolbar.div});if("mobile"==DEV)this.list.zoomToolbar.zoomPager=PagerLite.create({parent:this.list.zoomToolbar.div,insertBefore:this.list.zoomToolbar.div.firstChild,connectSlider:!0});"tablet"==DEV&&workspace.addCssClass(this.list.zoomToolbar.div,"tablet")}"tablet"==DEV&&(workspace.addCssClass(this.list.topToolbar.div,"tablet"),workspace.addCssClass(this.list.pagerToolbar.div,"tablet"));"mobile"==DEV&&workspace.addCssClass(this.list.pagerToolbar.div,
"mobile");if(publicationData.visibility.search)a=el.id("resultField"),"mobile"==DEV&&workspace.addCssClass(a,"twoLines"),this.list.searchToolbar.currentResultNumber=workspace.createElement({id:"currentResultNumber",cssClassName:"currentResultNumber",parent:a}),a.innerHTML+=" / ",this.list.searchToolbar.resultCount=workspace.createElement({id:"resultCount",cssClassName:"resultCount",parent:a}),a.innerHTML+=" "+LOCALS.COINCEDENCES.toLowerCase(),delete a,"tablet"==DEV&&(delete PagerLite.create({parent:this.list.searchToolbar.div,
insertBefore:this.list.searchToolbar.div.firstChild,connectSlider:!1}),workspace.addCssClass(this.list.searchToolbar.div,"tablet"))},toggle:function(){workspace.pager.isEdit&&pager.inputField.blur();for(var a in this.list)this.list[a].isActive&&this.list[a].toggle();workspace.toolbars.isHide=workspace.toolbars.isHide?!1:!0}},buttons:{list:{},init:function(){if(publicationData.visibility.toc||publicationData.visibility.bookmarks)this.list.listButton=new Button({id:"listButton",field:"listField",fontImage:!0,
pressing:!0,able:!0,event:UP_EVENT});if(publicationData.visibility.bookmarks&&(this.list.addButton=new Button({id:"addButton",field:"addField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT}),customEvents.addListener(ADD_BM,function(){workspace.buttons.addBmButtonCheckState()}),customEvents.addListener(REMOVE_BM,function(){workspace.buttons.addBmButtonCheckState()}),!publicationData.visibility.toc)){var a=this.list.listButton;bm.isEmpty()&&a.makeDisable();customEvents.addListener(ADD_BM,function(){a.makeAble()});
customEvents.addListener(REMOVE_BM,function(){bm.isEmpty()&&a.makeDisable()})}if(publicationData.visibility.search)this.list.searchButton=new Button({id:"searchButton",field:"searchField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT}),this.list.closeResultButton=new Button({id:"closeResultButton",field:"closeResultField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT}),this.list.prevResultButton=new Button({id:"prevResultButton",field:"prevResultField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT}),
this.list.nextResultButton=new Button({id:"nextResultButton",field:"nextResultField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT});this.list.infoButton=new Button({id:"infoButton",field:"infoField",fontImage:!0,pressing:!0,able:!0,event:UP_EVENT});with(publicationData.visibility){if("tablet"==DEV){if(downloads)this.list.downloadButton=new Button({id:"downloadButton",field:"downloadField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK});if(share)this.list.shareButton=new Button({id:"shareButton",
field:"shareField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK});if(slideshow)this.list.slideShowButton=new Button({id:"slideShowButton",field:"navigationField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK}),customEvents.addListener(ZOOM_ANIMATION_START,function(){workspace.slideShow.stop()})}if("mobile"==DEV)if(1<downloads+share+slideshow)this.list.moreButton=new Button({id:"moreButton",field:"moreField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK});else if(1==downloads+share+
slideshow){if(downloads)this.list.downloadButton=new Button({id:"downloadButton",field:"moreField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK});if(share)this.list.shareButton=new Button({id:"shareButton",field:"moreField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK});if(slideshow)this.list.slideShowButton=new Button({id:"slideShowButton",field:"moreField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK}),customEvents.addListener(ZOOM_ANIMATION_START,function(){workspace.slideShow.stop()})}}if("undefined"!=
typeof workspace.toolbars.list.zoomToolbar)this.list.zoomInButton=Button.create({id:"zoomInButton",field:"zoomInField",fontImage:!0,pressing:!0,able:!0,event:SINGLE_CLICK}),this.list.zoomOutButton=Button.create({id:"zoomOutButton",field:"zoomOutField",fontImage:!0,pressing:!0,able:!1,event:SINGLE_CLICK}),customEvents.addListener(ZOOM_LEVEL_CHANGED_FOR_WORKSPACE,function(a){a=a.data;with(workspace.buttons.list)a.isLargest?zoomInButton.makeDisable():zoomInButton.makeAble(),a.isSmallest?zoomOutButton.makeDisable():
zoomOutButton.makeAble()});this.pageTurnHandler(pageMediator.page)},pageTurnHandler:function(){publicationData.visibility.bookmarks&&this.addBmButtonCheckState()},addBmButtonCheckState:function(){bm.isBookmark(pageMediator.page)?workspace.addCssClass(workspace.buttons.list.addButton.div,"remButton"):workspace.delCssClass(workspace.buttons.list.addButton.div,"remButton")}},popovers:{oneOfPopoversIsVisible:0,init:function(){this.tocPopover=new Popover({id:"tocOver",parent:"body",horisontalPosition:"left",
state:"toc"});with(this.tocPopover){if(publicationData.visibility.toc!=publicationData.visibility.bookmarks){if(publicationData.visibility.bookmarks)this.tocPopover.state="bm";addLabel({twoTabs:!1,text:{toc:LOCALS.TOC,bm:LOCALS.BOOKMARKS}[state]})}else addLabel({twoTabs:!0});addContent();customEvents.addListener(ADD_BM,function(){(state="bm")&&redrawContent()});customEvents.addListener(REMOVE_BM,function(){(state="bm")&&redrawContent()})}this.searchPopover=new Popover({id:"searchOver",parent:"body",
horisontalPosition:"left",state:"search"});customEvents.addListener(START_SEARCH,function(a){popoverContent.search.handleSearchStart(a.data)});customEvents.addListener(SHOW_SEARCH_RESULTS,function(a){popoverContent.search.handleSearchResults(a.data)});with(this.searchPopover)addLabel({text:LOCALS.SEARCH,back:!1}),addContent()}},slideShow:{isActive:!1,time:3E3,startTimer:function(a){pageMediator.isLast()?!0==publicationData.slideShowLoop?this.timeout=window.setTimeout(function(){pageMediator.goToPage(1)},
a):this.turnOnOff():this.timeout=window.setTimeout(function(){publicationData.rtlMode?pageMediator.left():pageMediator.right()},a)},stopTimer:function(){window.clearTimeout(this.timeout)},animationEndHandler:function(){this.isActive&&(this.stopTimer(),this.startTimer("undefined"!=typeof publicationData.page[pageMediator.page].slideDelay?publicationData.page[pageMediator.page].slideDelay:publicationData.page.defaults.slideDelay))},animationStartHandler:function(){this.isActive&&this.stopTimer()},start:function(){this.isActive||
this.turnOnOff()},stop:function(){this.isActive&&this.turnOnOff()},turnOnOff:function(){function a(){c.animationStartHandler.call(c)}this.isActive=!this.isActive;for(var b in workspace.buttons.list)"slideShowButton"!=b&&(this.isActive?workspace.buttons.list[b].makeDisable():workspace.buttons.list[b].makeAble());"undefined"!=typeof workspace.buttons.list.slideShowButton&&(workspace.changeCssClass(workspace.buttons.list.slideShowButton.div,"slideShowPauseButton"),workspace.changeCssClass(workspace.buttons.list.slideShowButton.div,
"slideShowButton"));var c=this;b=function(){c.animationEndHandler.call(c,event)};this.isActive?(customEvents.addListener(BOOK_FLIPPING_END,b),this.pageEventNumber=pageMediator.addListener(a,!0),c.startTimer("undefined"!=typeof publicationData.page[pageMediator.page].slideDelay?publicationData.page[pageMediator.page].slideDelay:publicationData.page.defaults.slideDelay)):(customEvents.removeListener(BOOK_FLIPPING_END,b),pageMediator.removeListener(a),c.stopTimer())},addSlideShowButton:function(){var a=
workspace.createElement({id:"slideShowField",cssClassName:"buttonsField horizontalField leftField slideShowField",parent:workspace.toolbars.list.pagerToolbar.div,insertBefore:workspace.toolbars.list.pagerToolbar.div.firstChild});workspace.buttons.list.slideShowButton=Button.create({id:"slideShowButton",fontImage:!0,field:a.id,pressing:!0,able:!0,event:SINGLE_CLICK});customEvents.addListener(ZOOM_ANIMATION_START,function(){workspace.slideShow.stop()});workspace.slider.handleResize();delete null},delSlideShowButton:function(){el.del(workspace.buttons.list.slideShowButton.field.id);
workspace.buttons.list.slideShowButton=null;delete workspace.buttons.list.slideShowButton;workspace.slider.handleResize()}},preloader:{add:function(a){"undefined"!=typeof a?workspace.createElement({type:"div",id:a.id+"Preloader",cssClassName:"preloader",parent:a}):workspace.createElement({type:"div",id:"bodyPreloader",cssClassName:"preloader",parent:el.id("body")})},del:function(a){"undefined"!=typeof a?el.del(a.id+"Preloader"):el.del("bodyPreloader")}},pager:{isEdit:!1,init:function(){this.pagerDiv=
el.id("pagerField");if("undefined"==typeof this.pagerDiv)return!1;var a="medium";switch((publicationData.pageUserCount+"").length){case 1:a="small";break;case 3:a="large";break;case 4:a="larger"}workspace.addCssClass(this.pagerDiv,a);this.labelField=el.id("pagerCurrentPage");this.inputField=el.id("inputPage");this.inputField.type=system.platform.ios?"number":"text";el.id("pagerCurrentPage").innerHTML=pageTable.getCaption(pageMediator.page);var b=this,a=function(){if("undefined"!=typeof b.labelField)b.labelField.innerHTML=
pageTable.getCaption(pageMediator.page)};customEvents.addListener(ROTATE_DEVICE,a);customEvents.addListener(CHANGE_BOOK_TYPE,a);el.id("lastPage").innerHTML="/ "+publicationData.pageUserCount;b=this;setClickEvents(b.pagerDiv,!1);this.pagerDiv.addEventListener(SINGLE_CLICK,function(){b.handleClick.call(b)});system.platform.ios?this.inputField.addEventListener("keydown",function(){b.handleKeydown.call(b,event)}):this.inputField.addEventListener("keypress",function(){b.handleKeydown.call(b,event)});this.inputField.addEventListener("blur",
function(){b.changeEditableState.call(b)});pageMediator.addListener(function(a){workspace.pager.changeLabel.call(b,a)});customEvents.addListener(SLIDER_TO_PAGER_CHANGE_LABEL,function(a){b.changeLabel(a.data.page)})},handleKeydown:function(a){a.target=a.target?a.target:a.srcElement;if(13==a.keyCode){a=parseInt(a.target.value);if(!isNaN(a)){if(a>publicationData.pageUserCount)a=publicationData.pageUserCount;a=pageTable.getFileIDFromUserID(a);pageMediator.goToPage(a)}this.inputField.blur()}else system.platform.ios&&
PUBL&&(this.inputField.value+=String.fromCharCode(a.keyCode))},changeLabel:function(a){this.labelField.firstChild.data=pageTable.getCaption(a)},changeEditableState:function(){var a=this.labelField;workspace.changeCssClass(this.inputField,"invisible");workspace.changeCssClass(a,"invisible");this.isEdit=workspace.pager.isEdit?!1:!0;if(workspace.pager.isEdit)this.inputField.select(),this.inputField.focus(),this.inputField.value=""},handleClick:function(){this.isEdit||this.changeEditableState()}},notification:function(a){arguments.callee.count=
arguments.callee.count||0;arguments.callee.count++;var b=new Popover({parent:"body",id:"notifyOver"+arguments.callee.count,horisontalPosition:"center",state:"notify",deleteAfterClose:!0,noCloseButton:!0});with(b)a.tip||addLabel({text:a.name,back:!1});this.addCssClass(b.div,"notify");this.addCssClass(b.contentDiv,"notificationText");b.contentDiv.innerHTML=a.text;b.reposition();window.setTimeout(function(){b.show()},0);"undefined"!=typeof a.time&&window.setTimeout(function(){b.hide()},a.time);return b},
setPublicationTitle:function(){document.title=publicationData.name;if("tablet"==DEV)this.publicationTitle=new Popover({parent:"body",id:"publicationTitle",horisontalPosition:"center",state:"notify",deleteAfterClose:!1,noCloseButton:!0}),this.publicationTitle.time=1500,this.addCssClass(this.publicationTitle.div,"notify"),this.addCssClass(this.publicationTitle.contentDiv,"notificationText"),this.publicationTitle.contentDiv.innerHTML=publicationData.name,this.publicationTitle.reposition()},detectFirstRun:function(){var a=
publicationData.ident+"PreviouslyOpened",b;for(b in window.localStorage)if(b==a)return!1;window.localStorage.setItem(publicationData.ident+"PreviouslyOpened","true");return!0},clickControl:function(a){a.x<system.device.width*workspace.flipAreaIOS?pageMediator.left():a.x>system.device.width*(1-workspace.flipAreaIOS)?pageMediator.right():(workspace.toolbars.toggle(),"tablet"==DEV&&!workspace.toolbars.isHide&&workspace.publicationTitle.showForAWhile(workspace.publicationTitle.time))},clickControlSimple:function(a){var b=
mainFrame.getBoundingClientRect();a.x-b.left<b.width*workspace.flipArea?pageMediator.left():a.x-b.left>b.width*(1-workspace.flipArea)?pageMediator.right():(workspace.toolbars.toggle(),"tablet"==DEV&&!workspace.toolbars.isHide&&workspace.publicationTitle.showForAWhile(workspace.publicationTitle.time));delete null},storagePage:{init:function(){var a=this;this.number=publicationData.restoreSession?window.localStorage.getItem(publicationData.ident+"currentPage")||pageMediator.page:pageMediator.page;pageMediator.addListener(function(b){a.set(b)});
window.setTimeout(function(){pageMediator.goToPage(a.number)},0)},set:function(a){window.localStorage.removeItem(publicationData.ident+"currentPage");window.localStorage.setItem(publicationData.ident+"currentPage",a)}},handleResize:function(){for(var a in workspace.popovers)if("undefined"!=typeof workspace.popovers[a].isVisible){"center"==workspace.popovers[a].horisontalPosition&&workspace.popovers[a].reposition();var b=workspace.popovers[a].submenuList,c;for(c in b)"undefined"!=typeof b[c].scroll&&
b[c].scroll.refresh()}this.slider.handleResize();"undefined"!=typeof workspace.publicationTitle&&workspace.publicationTitle.reposition();this.slideShow.isActive&&this.slideShow.turnOnOff()},changeCssClass:function(a,b){a.className=-1==a.className.indexOf(b)?a.className+" "+b:a.className.replace(" "+b,"")},addCssClass:function(a,b){("undefined"==a||null==a)&&console.log("element for CSS class "+b+" doesnt exist");if(null!=a.className){if(-1==a.className.indexOf(b))a.className=a.className+" "+b}else a.className=
b},delCssClass:function(a,b){if(-1!=a.className.indexOf(b))a.className=a.className.replace(" "+b,"")},createElement:function(a){a.type=a.type||"div";var b=el.add(a.type);"undefined"==typeof a.id?console.log("ERROR while adding child to "+a.parent.id):b.setAttribute("id",a.id);if("undefined"!=typeof a.cssClassName)b.className=a.cssClassName;"undefined"==typeof a.insertBefore?a.parent.appendChild(b):a.parent.insertBefore(b,a.insertBefore);"undefined"!=typeof a.text&&b.appendChild(document.createTextNode(a.text));
return el.id(b.id)},setText:function(a,b){for(var c=el.id(a);c.lastChild;)c.removeChild(c.lastChild);"undefined"!=typeof b&&c.appendChild(document.createTextNode(b));delete null},existInDOM:function(a){a=el.id(a);return"undefined"!=typeof a&&null!=a?!0:!1},deleteUnnecessaryHTML:function(){with(publicationData.visibility){!toc&&!bookmarks&&workspace.existInDOM("listField")&&el.del("listField");!bookmarks&&workspace.existInDOM("addField")&&el.del("addField");(!downloads||"mobile"==DEV)&&workspace.existInDOM("downloadField")&&
el.del("downloadField");search||(workspace.existInDOM("searchField")&&el.del("searchField"),workspace.existInDOM("searchToolbar")&&el.del("searchToolbar"));(!slideshow||"mobile"==DEV)&&workspace.existInDOM("slideShowField")&&el.del("slideShowField");(!share||"mobile"==DEV)&&workspace.existInDOM("shareField")&&el.del("shareField");if((!downloads&&!share&&!slideshow||"tablet"==DEV)&&workspace.existInDOM("moreField"))el.del("moreField");else if(1==downloads+share+slideshow&&workspace.existInDOM("moreField")){var a=
el.id("moreButton"),b=(downloads?"download":share?"share":"slideShow")+"Button";a.setAttribute("id",b);workspace.delCssClass(a,"moreButton");workspace.addCssClass(a,b)}switch(DEV){case "tablet":var c=el.id("sliderThumb");break;case "mobile":c=el.id("pagerToolbar")}for(var e in c.childNodes)"pagerField"==c.childNodes[e].id&&c.removeChild(c.childNodes[e]);delete c}},needZoomTolbar:function(){return browser.publisher.isOn?"android"==browser.publisher.deviceName:"undefined"!=typeof WORKSPACE_ZOOM?WORKSPACE_ZOOM:
!1}};
function ZoomIOSPublication(a){this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.pageShift=20;this.active=this.block=!1;this.currentPage=a||1;this.pageBuff=0;this.flipSpeed=500;this.loadBuffers={};this.gesture=!1;this.zoomFactor=this.translateScrollY=this.translateScrollX=0;this.zoomIOSpeed=500;this.scrollbars=this.block=this.active=!1;this.scrolls={};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active){highlight.show(a.currentPage);for(var b=
a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.show(b)}});customEvents.addListener(CANCEL_SEARCH,function(){if(a.active){highlight.hide(a.currentPage);for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.hide(b)}});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});customEvents.addListener(ROTATE_DEVICE,function(){a.active&&a.rotate()});
customEvents.addListener(IOS_LOAD_PAGE_START,function(a){if(3===a.data.type){var a=a.data.page,b=el.add("div");b.id="preloader"+a;b.style.position="absolute";b.style.left=window.innerWidth/2+"px";b.style.top=window.innerHeight/2+"px";b.style.width="10em";b.style.height="10em";b.style.margin="-3em 0 0 -5em";workspace.preloader.add(b);el.id("page"+a).appendChild(b)}});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){3===a.data.type&&el.del("preloader"+a.data.page)});customEvents.addListener(IOS_LOAD_VECTOR_END,
function(){})};this.initSizes=function(a,b){this.zoomFactor=a=a||this.zoomFactor;var b=b||this.currentPage,c=publicationData.size.width/publicationData.size.height;this.pageWidth=(publicationData.page[b].width||publicationData.page.defaults.width)*a;this.pageHeight=this.pageWidth/c;this.pageLeft=(window.innerWidth-this.pageWidth)/2;this.pageTop=(window.innerHeight-this.pageHeight)/2;this.widePageWidth=2*this.pageWidth;this.widePageLeft=(window.innerWidth-this.widePageWidth)/2};this.drawBook=function(a,
b){b=b||!1;this.active=!0;this.currentPage=a;this.init();var c=el.add("div");c.id="zoomBook";c.style.width="100%";c.style.height="100%";c.style.position="absolute";el.id("mainFrame").appendChild(c);for(c=this.currentPage-this.pageBuff;c<=1*this.currentPage+this.pageBuff;c++)0<c&&c<=publicationData.pageCount&&this.drawPage(c,b)};this.drawPage=function(a,b){var c=publicationData.page[a].wide,b=c?b||{x:this.widePageLeft,y:this.pageTop}:b||{x:this.pageLeft,y:this.pageTop},e=el.add("div");e.id="pageMask"+
a;e.style.position="absolute";e.style.width="100%";e.style.height="100%";e.style.webkitTransform="translate3d("+(publicationData.rtlMode?(this.currentPage-a)*window.innerWidth:(a-this.currentPage)*window.innerWidth)+"px,0px,0px)";var k=el.add("div");k.id="page"+a;k.style.position="absolute";k.style.overflow="hidden";k.style.width=c?this.widePageWidth+"px":this.pageWidth+"px";k.style.height=this.pageHeight+"px";HTML5lib.boxShadow(k,"0px 0px 3px #000");if("photo_album"!=publicationData.type&&"document"!=
publicationData.type)k.style.backgroundColor=publicationData.page[a].BGColor||publicationData.page.defaults.BGColor;if(0<this.pageTop)k.style.top=this.pageTop+"px";if(c){if(0<this.widePageLeft)k.style.left=this.widePageLeft+"px"}else if(0<this.pageLeft)k.style.left=this.pageLeft+"px";e.appendChild(k);el.id("zoomBook").appendChild(e);this.injectCanvas(k,a);k=null;this.scrolls[a]=new iScroll("pageMask"+a,{hScrollbar:this.scrollbars,vScrollbar:this.scrollbars,zoom:!1});this.scrolls[a].scrollTo(b.x,b.y,
0);var h=this,j=c?this.widePageWidth:this.pageWidth;this.slideMode=j>window.innerWidth?!0:!1;var m=function(){if(h.slideMode)if(150<h.scrolls[a].x&&(1!=h.currentPage&&!publicationData.rtlMode||h.currentPage!=publicationData.pageCount&&publicationData.rtlMode))pageMediator.left(),el.id("pageMask"+a).removeEventListener("touchmove",m),h.scrolls[a].destroy();else if(h.scrolls[a].x<window.innerWidth-j-150&&(h.currentPage!=publicationData.pageCount&&!publicationData.rtlMode||1!=h.currentPage&&publicationData.rtlMode))pageMediator.right(),
el.id("pageMask"+a).removeEventListener("touchmove",m),h.scrolls[a].destroy()};e.addEventListener("touchmove",m);e=null};this.injectCanvas=function(a,b){var c=publicationData.page[b].wide,e=this.pageHeight,k=publicationData.page[b].width||publicationData.page.defaults.width,h=publicationData.page[b].height||publicationData.page.defaults.height,j=k/h,m=c?this.widePageWidth:this.pageWidth;if((c?this.widePageWidth/e:this.pageWidth/e)>j)var c=e,o=c*j,j=(m-o)/2,e=0;else o=m,c=o/j,j=0,e=(e-c)/2;var e=e.toFixed(0),
m=(c/3).toFixed(0),n=el.add("canvas");n.id="1substraitCanvas"+b;n.width=o;n.height=m;n.style.position="absolute";n.style.left=j+"px";n.style.top=e+"px";n.style.webkitTransform="translate3d(0,0,0)";a.appendChild(n);n=el.add("canvas");n.id="2substraitCanvas"+b;n.width=o;n.height=m;n.style.position="absolute";n.style.left=j+"px";n.style.top=1*e+1*m-0.1+"px";n.style.webkitTransform="translate3d(0,0,0)";a.appendChild(n);n=el.add("canvas");n.id="3substraitCanvas"+b;n.width=o;n.height=c-2*m;n.style.position=
"absolute";n.style.left=j+"px";n.style.top=1*e+2*m-1.1+"px";n.style.webkitTransform="translate3d(0,0,0)";a.appendChild(n);publicationData.page[b].stub?ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+b)},150)):(customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:b,type:3}),this.loadImage(c,m,b));m=o/(2*k);n=publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===n||"js+png"===n)n=el.add("div"),n.id="contentDiv"+
b,n.style.width=2*k+"px",n.style.height=2*h+"px",n.style.position="absolute",n.style.left=j+"px",n.style.top=e+"px",n.style.webkitTransformOrigin="0% 0%",n.style.webkitTransform="scale("+m+")",a.appendChild(n);var p=el.add("canvas");p.id="highlightCanvas"+b;p.width=o;p.height=c;p.style.position="absolute";p.style.left=j+"px";p.style.top=e+"px";p.style.opacity=0;a.appendChild(p);customEvents.addListener(IOS_LOAD_BITMAP_END,function(){p.style.opacity=1});new LinksLayer(p,b);highlight.show(b,p)};this.loadImage=
function(a,b,c){var e=el.id("1substraitCanvas"+c),k=e.getContext("2d");k.fillStyle="rgb(255,255,255)";var e=el.id("2substraitCanvas"+c),h=e.getContext("2d");h.fillStyle="rgb(255,255,255)";var e=el.id("3substraitCanvas"+c),j=e.getContext("2d");j.fillStyle="rgb(255,255,255)";var m=publicationData.page[c].proportions||publicationData.page.defaults.proportions,o=publicationData.size.proportions,e=e.width,n=new Image,p=publicationData.page[c].format||publicationData.page.defaults.format;if(PUBL)"js+jpg"===
p?(q=COMMON_FOLDER+"/page-substrates/page"+this.getName(c)+".jpg?1&"+PS,this.loadContent(c,e)):"js+png"===p?(q=COMMON_FOLDER+"/page-substrates/page"+this.getName(c)+".png?1&"+PS,this.loadContent(c,e)):"jpg"===p?q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.jpg?1&"+PS:"png"===p&&(q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.png?1&"+PS),p=new XMLHttpRequest,p.open("GET",q),p.onload=function(){n.src=this.responseText},p.onerror=function(){},p.send(),delete p;else{if("js+jpg"===p){var q=COMMON_FOLDER+
"/page-substrates/page"+this.getName(c)+".jpg";this.loadContent(c,e)}else"js+png"===p?(q=COMMON_FOLDER+"/page-substrates/page"+this.getName(c)+".png",this.loadContent(c,e)):"jpg"===p?q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.jpg":"png"===p&&(q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.png");n.src=q}if(m>=o)var s=e,m=(s/m).toFixed(0),r=0,m=(a-m)/2;else s=(a*m).toFixed(0),r=(e-s)/2,m=0;var B=m>b?b:m,v=m>2*b?2*b:B-b,B=m,v=B-b,u=B+v-b;n.onload=function(){customEvents.fireEvent(IOS_LOAD_BITMAP_END,
{page:c,type:3});k.drawImage(n,r,B,s,a);h.drawImage(n,r,v,s,a);j.drawImage(n,r,u,s,a);setTimeout(function(){ZOOM_LOCK&&el.id("exPage"+c)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+c)},150))},300)}};this.loadContent=function(a){var a=ASSETS_FOLDER+"/pages/ios/page"+this.getName(a)+".js",b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.id="formPrinter";c.type="text/javascript";c.src=a;b.appendChild(c);window.fakeLoadComplete=function(a){window.loadBuffers[a]=
window.loadBuffer;for(i in window.loadBuffers[a]){var b=el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*window.loadBuffers[a][i][4]+"px";b.style.left=2*window.loadBuffers[a][i][5]+"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var c=document.createTextNode(window.loadBuffers[a][i][0]);b.appendChild(c);
el.id("contentDiv"+a).appendChild(b);customEvents.fireEvent(IOS_LOAD_VECTOR_END,{page:a,type:3})}}};this.rotate=function(){this.initSizes();0<this.pageLeft?el.id("page"+this.currentPage).style.left=this.pageLeft+"px":el.id("page"+this.currentPage).style.left="0px";0<this.pageTop?el.id("page"+this.currentPage).style.top=this.pageTop+"px":el.id("page"+this.currentPage).style.top="0px"};this.slideLeft=function(a){var b=el.id("pageMask"+this.currentPage),a=publicationData.rtlMode?el.id("pageMask"+a):
el.id("pageMask"+a);b.style.webkitTransitionDuration="300ms";a.style.webkitTransitionDuration="300ms";b.style.webkitTransform="translate3d("+-window.innerWidth+"px,0px,0px)";a.style.webkitTransform="translate3d(0px,0px,0px)";setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END)},300)};this.slideRight=function(a){var b=el.id("pageMask"+this.currentPage),a=publicationData.rtlMode?el.id("pageMask"+a):el.id("pageMask"+a);b.style.webkitTransitionDuration="300ms";a.style.webkitTransitionDuration=
"300ms";b.style.webkitTransform="translate3d("+window.innerWidth+"px,0px,0px)";a.style.webkitTransform="translate3d(0px,0px,0px)";setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END)},300)};this.goToPage=function(a){if(this.currentPage<a){this.drawPage(a,{x:0,y:0});publicationData.rtlMode?this.slideRight(a):this.slideLeft(a);var b=this.currentPage;this.currentPage=a;var c=this;setTimeout(function(){c.destroyPage(b)},300)}else if(this.currentPage>a)this.drawPage(a,{x:0,y:0}),publicationData.rtlMode?
this.slideLeft(a):this.slideRight(a),b=this.currentPage,this.currentPage=a,c=this,setTimeout(function(){c.destroyPage(b)},300)};this.destroyPage=function(a){this.scrolls[a].destroy();delete this.scrolls[a];el.del("page"+a);el.del("pageMask"+a)};this.destroyBook=function(){el.del("zoomBook");this.active=!1};this.goToOnePage=function(){if(!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);if(el.id("videoDiv"+a))el.id("videoDiv"+a).style.opacity=0;var a=this.currentPage,b=publicationData.page[a].wide,
c=this;this.scrolls[a].destroy();delete this.scrolls[a];var e=publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>e?oneBookHeight=window.innerHeight-20:(oneBookWidth=window.innerWidth-20,oneBookHeight=oneBookWidth/e);b&&(oneBookHeight/=2);var k=oneBookHeight/this.pageHeight,h=el.id("page"+a);h.style.webkitTransformOrigin="50% 50%";el.id("mainFrame").appendChild(h);h.style.webkitTransform="";h.id="exPage"+a;h.style.zIndex="100000";h.style.webkitBoxShadow="";
setTimeout(function(){h.style.webkitTransitionDuration="300ms";h.style.top=c.pageTop+"px";h.style.left=b?c.widePageLeft+"px":c.pageLeft+"px";HTML5lib.changeOnlyScale(h,k,k,k)},20);setTimeout(function(){c.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END_TO_ONE,{page:a})},320)}};this.goToTwoPage=function(){if(!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);if(el.id("videoDiv"+a))el.id("videoDiv"+a).style.opacity=0;var a=this.currentPage,b=
publicationData.page[a].wide,c=this,e=pageTable.getUserIDFromFileID(a);this.scrolls[a].destroy();this.scrolls[a]=null;var k=2*publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>k?(twoBookHeight=window.innerHeight-60,twoBookWidth=twoBookHeight*k):(twoBookWidth=window.innerWidth-60,twoBookHeight=twoBookWidth/k);var h=0;publicationData.rtlMode&&0===e%2?h=twoBookWidth/4:publicationData.rtlMode&&0!=e%2?h=-twoBookWidth/4:!publicationData.rtlMode&&0===e%2?h=-twoBookWidth/
4:!publicationData.rtlMode&&0!=e%2&&(h=twoBookWidth/4);var j=twoBookHeight/this.pageHeight,m=el.id("page"+a);m.style.webkitTransformOrigin="50% 50%";el.id("mainFrame").appendChild(m);m.style.webkitTransform="";m.id="exPage"+a;m.style.zIndex="100000";m.style.webkitBoxShadow="";b&&(h=0);setTimeout(function(){m.style.webkitTransitionDuration="300ms";m.style.top=c.pageTop+"px";m.style.left=b?c.widePageLeft+"px":c.pageLeft+"px";m.style.webkitTransform="translate3d("+h+"px,0,0) scale3d("+j+","+j+","+j+
")";customEvents.fireEvent(START_ZOOM_PRELOADER,{shift:h})},20);setTimeout(function(){c.destroyBook();customEvents.fireEvent(ZOOM_ANIMATION_END_TO_TWO,{page:e})},320)}};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};var b=this;this.gesturestart=function(a){customEvents.fireEvent(ZOOM_ANIMATION_START);if(el.id("videoDiv"+page))el.id("videoDiv"+page).style.opacity=0;b.gesture=!0;b.zoomPage=b.currentPage;b.x=b.scrolls[b.zoomPage].x;b.y=b.scrolls[b.zoomPage].y;
b.scrolls[b.zoomPage].destroy();b.scrolls[b.zoomPage]=null;b.zoomDiv=el.id("page"+b.zoomPage);b.maxZoom=strUtils.getMaxZoom(publicationData.page[b.zoomPage].wide?2*b.pageWidth:b.pageWidth,b.pageHeight);if(1===orientationObserver.getType()){var c=window.innerWidth/window.innerHeight,e=publicationData.size.width/publicationData.size.height;c>e?oneBookHeight=window.innerHeight-20:(oneBookWidth=window.innerWidth-20,oneBookHeight=oneBookWidth/e);b.minZoom=oneBookHeight/b.pageHeight;if(publicationData.page[b.zoomPage].wide)b.minZoom=
oneBookHeight/2/b.pageHeight}else c=window.innerWidth/window.innerHeight,e=2*publicationData.size.width/publicationData.size.height,c>e?(twoBookHeight=window.innerHeight-60,b.twoBookWidth=twoBookHeight*e):(b.twoBookWidth=window.innerWidth-60,twoBookHeight=b.twoBookWidth/e),b.minZoom=twoBookHeight/b.pageHeight;for(i in b.zoomDiv.getElementsByTagName("*"))b.zoomDiv.getElementsByTagName("*")[i].id="";el.id("mainFrame").appendChild(b.zoomDiv);b.zoomDiv.id="exPage"+b.zoomPage;b.zoomDiv.style.zIndex="100000";
0>=b.pageTop?(b.zoomDiv.style.top=b.y+"px",c=(-b.y+a.pageY).toFixed(0)):c=(a.pageY-b.pageTop).toFixed(0);e=!publicationData.page[b.zoomPage].wide?b.pageLeft:b.widePageLeft;0>=e?(b.zoomDiv.style.left=b.x+"px",a=(-b.x+a.pageX).toFixed(0)):a=(a.pageX-e).toFixed(0);b.zoomDiv.style.webkitTransformOrigin=a+"px "+c+"px";b.destroyBook()};this.gesturechange=function(a){if(b.minZoom<=a.scale&&b.maxZoom>=a.scale)b.zoomDiv.style.webkitTransform="scale3d("+a.scale+","+a.scale+","+a.scale+")"};this.gestureend=
function(a){setTimeout(function(){b.gesture=!1},150);var c=a.scale>b.maxZoom?b.maxZoom:a.scale<b.minZoom?b.minZoom:a.scale;b.zoomDiv.style.webkitTransform="scale3d("+c+","+c+","+c+")";var e=b.pageHeight*c,l=publicationData.page[b.zoomPage].wide?2*b.pageWidth*c:b.pageWidth*c,a=publicationData.page[b.zoomPage].width||publicationData.page.defaults.width;publicationData.page[b.zoomPage].wide&&(a*=2);var k=l/a,h=0>=b.zoomDiv.getBoundingClientRect().left?b.zoomDiv.getBoundingClientRect().left:0,j=0>=b.zoomDiv.getBoundingClientRect().top?
b.zoomDiv.getBoundingClientRect().top:0,m=b.zoomDiv.getBoundingClientRect().top,o=window.innerHeight-b.zoomDiv.getBoundingClientRect().bottom,n=b.zoomDiv.getBoundingClientRect().left,p=window.innerWidth-b.zoomDiv.getBoundingClientRect().right,q=a=0;b.zoomDiv.style.webkitTransitionDuration="100ms";e<=window.innerHeight?q=(window.innerHeight-e)/2-m:e>window.innerHeight&&0<m?q=-m:e>window.innerHeight&&0<o&&(q=o);l<=window.innerWidth?a=(window.innerWidth-l)/2-n:l>window.innerWidth&&0<p?a=0:l>window.innerWidth&&
0<n&&(a=-n);var s={x:h,y:j},e=0;c<=b.minZoom&&2===orientationObserver.getType()?(l=pageTable.getUserIDFromFileID(b.zoomPage),!publicationData.rtlMode&&0===l%2?e=b.twoBookWidth/4:!publicationData.rtlMode&&0!=l%2?e=-b.twoBookWidth/4:publicationData.rtlMode&&0===l%2?e=-b.twoBookWidth/4:publicationData.rtlMode&&0!=l%2&&(e=b.twoBookWidth/4),publicationData.page[b.zoomPage].wide&&(e=0),b.zoomDiv.style.webkitTransform="translate3d("+(a-e)+"px,"+q+"px,0px) scale3d("+c+","+c+","+c+")"):b.zoomDiv.style.webkitTransform=
"translate3d("+a+"px,"+q+"px,0px) scale3d("+c+","+c+","+c+")";b.zoomDiv.style.webkitBoxShadow="";customEvents.fireEvent(START_ZOOM_PRELOADER,{shift:-e});setTimeout(function(){c>b.minZoom?customEvents.fireEvent(ZOOM_ZOOM_ANIMATION_END,{zoomFactor:k,page:b.zoomPage,startPos:s}):1===orientationObserver.getType()?customEvents.fireEvent(ZOOM_ANIMATION_END_TO_ONE,{page:b.zoomPage}):customEvents.fireEvent(ZOOM_ANIMATION_END_TO_TWO,{page:pageTable.getUserIDFromFileID(b.zoomPage)})},180)};var c=-1,e=-1,b=
this;this.touch=function(){this.slideMode=(publicationData.page[b.currentPage].wide?this.widePageWidth:this.pageWidth)>window.innerWidth?!0:!1;!b.block&&!b.gesture&&!ZOOM_LOCK&&!b.slideMode&&(c=Modernizr.touch?event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){this.slideMode=(publicationData.page[b.currentPage].wide?this.widePageWidth:this.pageWidth)>window.innerWidth?!0:!1;if(!b.block&&!b.gesture&&!ZOOM_LOCK&&!b.slideMode&&(e=Modernizr.touch?event.changedTouches[0].pageX:event.pageX,
-1!=c&&-1!=e)){var a=c-e;70<a?pageMediator.right():-70>a&&pageMediator.left();e=c=-1}}};

